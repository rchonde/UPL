{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/grid_core/ui.grid_core.virtual_scrolling_core.js)\r\n * Version: 22.2.4\r\n * Build date: Thu Jan 19 2023\r\n *\r\n * Copyright (c) 2012 - 2023 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../../core/renderer\";\nimport { getWindow } from \"../../core/utils/window\";\nimport eventsEngine from \"../../events/core/events_engine\";\nimport browser from \"../../core/utils/browser\";\nimport positionUtils from \"../../animation/position\";\nimport { each } from \"../../core/utils/iterator\";\nimport Class from \"../../core/class\";\nimport { Deferred } from \"../../core/utils/deferred\";\nimport Callbacks from \"../../core/utils/callbacks\";\nimport { VirtualDataLoader } from \"./ui.grid.core.virtual_data_loader\";\nimport { isDefined } from \"../../core/utils/type\";\nimport gridCoreUtils from \"./ui.grid_core.utils\";\nvar SCROLLING_MODE_INFINITE = \"infinite\";\nvar SCROLLING_MODE_VIRTUAL = \"virtual\";\nvar LEGACY_SCROLLING_MODE = \"scrolling.legacyMode\";\n\nvar _isVirtualMode = that => that.option(\"scrolling.mode\") === SCROLLING_MODE_VIRTUAL || that._isVirtual;\n\nvar _isAppendMode = that => that.option(\"scrolling.mode\") === SCROLLING_MODE_INFINITE && !that._isVirtual;\n\nexport function subscribeToExternalScrollers($element, scrollChangedHandler, $targetElement) {\n  var $scrollElement;\n  var scrollableArray = [];\n  var scrollToArray = [];\n  var disposeArray = [];\n  $targetElement = $targetElement || $element;\n\n  function getElementOffset(scrollable) {\n    var $scrollableElement = scrollable.element ? scrollable.$element() : scrollable;\n    var scrollableOffset = positionUtils.offset($scrollableElement);\n\n    if (!scrollableOffset) {\n      return $element.offset().top;\n    }\n\n    return scrollable.scrollTop() - (scrollableOffset.top - $element.offset().top);\n  }\n\n  var widgetScrollStrategy = {\n    on: function (scrollable, eventName, handler) {\n      scrollable.on(\"scroll\", handler);\n    },\n    off: function (scrollable, eventName, handler) {\n      scrollable.off(\"scroll\", handler);\n    }\n  };\n\n  function subscribeToScrollEvents($scrollElement) {\n    var isDocument = \"#document\" === $scrollElement.get(0).nodeName;\n    var isElement = $scrollElement.get(0).nodeType === getWindow().Node.ELEMENT_NODE;\n    var scrollable = $scrollElement.data(\"dxScrollable\");\n    var eventsStrategy = widgetScrollStrategy;\n\n    if (!scrollable) {\n      scrollable = isDocument && $(getWindow()) || isElement && \"auto\" === $scrollElement.css(\"overflowY\") && $scrollElement;\n      eventsStrategy = eventsEngine;\n\n      if (!scrollable) {\n        return;\n      }\n    }\n\n    var handler = function (scrollable) {\n      return function () {\n        var scrollTop = scrollable.scrollTop() - getElementOffset(scrollable);\n        scrollTop = scrollTop > 0 ? scrollTop : 0;\n        scrollChangedHandler(scrollTop);\n      };\n    }(scrollable);\n\n    eventsStrategy.on(scrollable, \"scroll\", handler);\n    scrollToArray.push(function (pos) {\n      var topOffset = getElementOffset(scrollable);\n      var scrollMethod = scrollable.scrollTo ? \"scrollTo\" : \"scrollTop\";\n\n      if (pos - topOffset >= 0) {\n        scrollable[scrollMethod](pos + topOffset);\n      }\n    });\n    scrollableArray.push(scrollable);\n    disposeArray.push(function () {\n      eventsStrategy.off(scrollable, \"scroll\", handler);\n    });\n  }\n\n  var getScrollElementParent = $element => {\n    var _$element$get$parentN;\n\n    return $(null !== (_$element$get$parentN = $element.get(0).parentNode) && void 0 !== _$element$get$parentN ? _$element$get$parentN : $element.get(0).host);\n  };\n\n  for ($scrollElement = $targetElement.parent(); $scrollElement.length; $scrollElement = getScrollElementParent($scrollElement)) {\n    subscribeToScrollEvents($scrollElement);\n  }\n\n  return {\n    scrollTo: function (pos) {\n      each(scrollToArray, function (_, scrollTo) {\n        scrollTo(pos);\n      });\n    },\n    dispose: function () {\n      each(disposeArray, function (_, dispose) {\n        dispose();\n      });\n    }\n  };\n}\nexport var VirtualScrollController = Class.inherit(function () {\n  var members = {\n    ctor: function (component, dataOptions, isVirtual) {\n      this._dataOptions = dataOptions;\n      this.component = component;\n      this._viewportSize = false === component.option(LEGACY_SCROLLING_MODE) ? 15 : 0;\n      this._viewportItemSize = 20;\n      this._viewportItemIndex = 0;\n      this._position = 0;\n      this._isScrollingBack = false;\n      this._contentSize = 0;\n      this._itemSizes = {};\n      this._sizeRatio = 1;\n      this._isVirtual = isVirtual;\n      this.positionChanged = Callbacks();\n      this._dataLoader = new VirtualDataLoader(this, this._dataOptions);\n    },\n    getItemSizes: function () {\n      return this._itemSizes;\n    },\n    option: function () {\n      return this.component.option.apply(this.component, arguments);\n    },\n    isVirtual: function () {\n      return this._isVirtual;\n    },\n    virtualItemsCount: function () {\n      if (_isVirtualMode(this)) {\n        var dataOptions = this._dataOptions;\n        var totalItemsCount = dataOptions.totalItemsCount();\n\n        if (false === this.option(LEGACY_SCROLLING_MODE) && -1 !== totalItemsCount) {\n          var viewportParams = this.getViewportParams();\n          var loadedOffset = dataOptions.loadedOffset();\n          var loadedItemCount = dataOptions.loadedItemCount();\n          var skip = Math.max(viewportParams.skip, loadedOffset);\n          var take = Math.min(viewportParams.take, loadedItemCount);\n          var endItemsCount = Math.max(totalItemsCount - (skip + take), 0);\n          return {\n            begin: skip,\n            end: endItemsCount\n          };\n        }\n\n        return this._dataLoader.virtualItemsCount.apply(this._dataLoader, arguments);\n      }\n    },\n    getScrollingTimeout: function () {\n      var renderAsync = this.option(\"scrolling.renderAsync\");\n      var scrollingTimeout = 0;\n\n      if (!isDefined(renderAsync)) {\n        scrollingTimeout = Math.min(this.option(\"scrolling.timeout\") || 0, this._dataOptions.changingDuration());\n\n        if (scrollingTimeout < this.option(\"scrolling.renderingThreshold\")) {\n          scrollingTimeout = this.option(\"scrolling.minTimeout\") || 0;\n        }\n      } else if (renderAsync) {\n        var _this$option;\n\n        scrollingTimeout = null !== (_this$option = this.option(\"scrolling.timeout\")) && void 0 !== _this$option ? _this$option : 0;\n      }\n\n      return scrollingTimeout;\n    },\n    setViewportPosition: function (position) {\n      var result = new Deferred();\n      var scrollingTimeout = this.getScrollingTimeout();\n      clearTimeout(this._scrollTimeoutID);\n\n      if (scrollingTimeout > 0) {\n        this._scrollTimeoutID = setTimeout(() => {\n          this._setViewportPositionCore(position);\n\n          result.resolve();\n        }, scrollingTimeout);\n      } else {\n        this._setViewportPositionCore(position);\n\n        result.resolve();\n      }\n\n      return result.promise();\n    },\n    getViewportPosition: function () {\n      return this._position;\n    },\n    getItemIndexByPosition: function (position, viewportItemIndex, height) {\n      var _position;\n\n      position = null !== (_position = position) && void 0 !== _position ? _position : this._position;\n      var defaultItemSize = this.getItemSize();\n      var offset = 0;\n      var itemOffset = 0;\n      var itemOffsetsWithSize = Object.keys(this._itemSizes).concat(-1);\n\n      for (var i = 0; i < itemOffsetsWithSize.length && offset < position; i++) {\n        var itemOffsetWithSize = parseInt(itemOffsetsWithSize[i]);\n        var itemOffsetDiff = (position - offset) / defaultItemSize;\n\n        if (itemOffsetWithSize < 0 || itemOffset + itemOffsetDiff < itemOffsetWithSize) {\n          itemOffset += itemOffsetDiff;\n\n          if (this._sizeRatio < 1 && isDefined(viewportItemIndex)) {\n            itemOffset = viewportItemIndex + height / this._viewportItemSize;\n          }\n\n          break;\n        } else {\n          itemOffsetDiff = itemOffsetWithSize - itemOffset;\n          offset += itemOffsetDiff * defaultItemSize;\n          itemOffset += itemOffsetDiff;\n        }\n\n        var itemSize = this._itemSizes[itemOffsetWithSize];\n        offset += itemSize;\n        itemOffset += offset < position ? 1 : (position - offset + itemSize) / itemSize;\n      }\n\n      return Math.round(50 * itemOffset) / 50;\n    },\n    isScrollingBack: function () {\n      return this._isScrollingBack;\n    },\n    _setViewportPositionCore: function (position) {\n      var prevPosition = this._position || 0;\n      this._position = position;\n\n      if (prevPosition !== this._position) {\n        this._isScrollingBack = this._position < prevPosition;\n      }\n\n      var itemIndex = this.getItemIndexByPosition();\n      var result = this.setViewportItemIndex(itemIndex);\n      this.positionChanged.fire();\n      return result;\n    },\n    setContentItemSizes: function (sizes) {\n      var virtualItemsCount = this.virtualItemsCount();\n      this._contentSize = sizes.reduce((a, b) => a + b, 0);\n\n      if (virtualItemsCount) {\n        sizes.forEach((size, index) => {\n          this._itemSizes[virtualItemsCount.begin + index] = size;\n        });\n\n        var virtualContentSize = (virtualItemsCount.begin + virtualItemsCount.end + this.itemsCount()) * this._viewportItemSize;\n\n        var contentHeightLimit = gridCoreUtils.getContentHeightLimit(browser);\n\n        if (virtualContentSize > contentHeightLimit) {\n          this._sizeRatio = contentHeightLimit / virtualContentSize;\n        } else {\n          this._sizeRatio = 1;\n        }\n      }\n    },\n    getItemSize: function () {\n      return this._viewportItemSize * this._sizeRatio;\n    },\n    getItemOffset: function (itemIndex, isEnd) {\n      var virtualItemsCount = this.virtualItemsCount();\n      var itemCount = itemIndex;\n\n      if (!virtualItemsCount) {\n        return 0;\n      }\n\n      var offset = 0;\n\n      var totalItemsCount = this._dataOptions.totalItemsCount();\n\n      Object.keys(this._itemSizes).forEach(currentItemIndex => {\n        if (!itemCount) {\n          return;\n        }\n\n        if (isEnd ? currentItemIndex >= totalItemsCount - itemIndex : currentItemIndex < itemIndex) {\n          offset += this._itemSizes[currentItemIndex];\n          itemCount--;\n        }\n      });\n      return Math.floor(offset + itemCount * this._viewportItemSize * this._sizeRatio);\n    },\n    getContentOffset: function (type) {\n      var isEnd = \"end\" === type;\n      var virtualItemsCount = this.virtualItemsCount();\n\n      if (!virtualItemsCount) {\n        return 0;\n      }\n\n      return this.getItemOffset(isEnd ? virtualItemsCount.end : virtualItemsCount.begin, isEnd);\n    },\n    getVirtualContentSize: function () {\n      var virtualItemsCount = this.virtualItemsCount();\n      return virtualItemsCount ? this.getContentOffset(\"begin\") + this.getContentOffset(\"end\") + this._contentSize : 0;\n    },\n    getViewportItemIndex: function () {\n      return this._viewportItemIndex;\n    },\n    setViewportItemIndex: function (itemIndex) {\n      this._viewportItemIndex = itemIndex;\n\n      if (false === this.option(LEGACY_SCROLLING_MODE)) {\n        return;\n      }\n\n      return this._dataLoader.viewportItemIndexChanged.apply(this._dataLoader, arguments);\n    },\n    viewportItemSize: function (size) {\n      if (void 0 !== size) {\n        this._viewportItemSize = size;\n      }\n\n      return this._viewportItemSize;\n    },\n    viewportSize: function (size) {\n      if (void 0 !== size) {\n        this._viewportSize = size;\n      }\n\n      return this._viewportSize;\n    },\n    viewportHeight: function (height, scrollTop) {\n      var position = null !== scrollTop && void 0 !== scrollTop ? scrollTop : this._position;\n      var begin = this.getItemIndexByPosition(position);\n      var end = this.getItemIndexByPosition(position + height, begin, height);\n      this.viewportSize(Math.ceil(end - begin));\n\n      if (!isDefined(scrollTop) && this._viewportItemIndex !== begin) {\n        this._setViewportPositionCore(position);\n      }\n    },\n    reset: function (isRefresh) {\n      this._dataLoader.reset();\n\n      if (!isRefresh) {\n        this._itemSizes = {};\n      }\n    },\n    subscribeToWindowScrollEvents: function ($element) {\n      this._windowScroll = this._windowScroll || subscribeToExternalScrollers($element, scrollTop => {\n        if (this.viewportItemSize()) {\n          this.setViewportPosition(scrollTop);\n        }\n      });\n    },\n    dispose: function () {\n      clearTimeout(this._scrollTimeoutID);\n      this._windowScroll && this._windowScroll.dispose();\n      this._windowScroll = null;\n    },\n    scrollTo: function (pos) {\n      this._windowScroll && this._windowScroll.scrollTo(pos);\n    },\n    isVirtualMode: function () {\n      return _isVirtualMode(this);\n    },\n    isAppendMode: function () {\n      return _isAppendMode(this);\n    },\n    getViewportParams: function () {\n      var _this$option2;\n\n      var virtualMode = this.option(\"scrolling.mode\") === SCROLLING_MODE_VIRTUAL;\n\n      var totalItemsCount = this._dataOptions.totalItemsCount();\n\n      var hasKnownLastPage = this._dataOptions.hasKnownLastPage();\n\n      var topIndex = hasKnownLastPage && this._viewportItemIndex > totalItemsCount ? totalItemsCount : this._viewportItemIndex;\n      var bottomIndex = this._viewportSize + topIndex;\n      var maxGap = this.option(\"scrolling.prerenderedRowChunkSize\") || 1;\n      var isScrollingBack = this.isScrollingBack();\n      var minGap = null !== (_this$option2 = this.option(\"scrolling.prerenderedRowCount\")) && void 0 !== _this$option2 ? _this$option2 : 1;\n      var topMinGap = isScrollingBack ? minGap : 0;\n      var bottomMinGap = isScrollingBack ? 0 : minGap;\n      var skip = Math.floor(Math.max(0, topIndex - topMinGap) / maxGap) * maxGap;\n      var take = Math.ceil((bottomIndex + bottomMinGap - skip) / maxGap) * maxGap;\n\n      if (virtualMode) {\n        var remainedItems = Math.max(0, totalItemsCount - skip);\n        take = Math.min(take, remainedItems);\n      }\n\n      return {\n        skip: skip,\n        take: take\n      };\n    },\n    itemsCount: function () {\n      var result = 0;\n\n      if (this.option(LEGACY_SCROLLING_MODE)) {\n        result = this._dataLoader.itemsCount.apply(this._dataLoader, arguments);\n      } else {\n        result = this._dataOptions.itemsCount();\n      }\n\n      return result;\n    }\n  };\n  [\"pageIndex\", \"beginPageIndex\", \"endPageIndex\", \"pageSize\", \"load\", \"loadIfNeed\", \"handleDataChanged\", \"getDelayDeferred\"].forEach(function (name) {\n    members[name] = function () {\n      return this._dataLoader[name].apply(this._dataLoader, arguments);\n    };\n  });\n  return members;\n}());","map":{"version":3,"names":["$","getWindow","eventsEngine","browser","positionUtils","each","Class","Deferred","Callbacks","VirtualDataLoader","isDefined","gridCoreUtils","SCROLLING_MODE_INFINITE","SCROLLING_MODE_VIRTUAL","LEGACY_SCROLLING_MODE","_isVirtualMode","that","option","_isVirtual","_isAppendMode","subscribeToExternalScrollers","$element","scrollChangedHandler","$targetElement","$scrollElement","scrollableArray","scrollToArray","disposeArray","getElementOffset","scrollable","$scrollableElement","element","scrollableOffset","offset","top","scrollTop","widgetScrollStrategy","on","eventName","handler","off","subscribeToScrollEvents","isDocument","get","nodeName","isElement","nodeType","Node","ELEMENT_NODE","data","eventsStrategy","css","push","pos","topOffset","scrollMethod","scrollTo","getScrollElementParent","_$element$get$parentN","parentNode","host","parent","length","_","dispose","VirtualScrollController","inherit","members","ctor","component","dataOptions","isVirtual","_dataOptions","_viewportSize","_viewportItemSize","_viewportItemIndex","_position","_isScrollingBack","_contentSize","_itemSizes","_sizeRatio","positionChanged","_dataLoader","getItemSizes","apply","arguments","virtualItemsCount","totalItemsCount","viewportParams","getViewportParams","loadedOffset","loadedItemCount","skip","Math","max","take","min","endItemsCount","begin","end","getScrollingTimeout","renderAsync","scrollingTimeout","changingDuration","_this$option","setViewportPosition","position","result","clearTimeout","_scrollTimeoutID","setTimeout","_setViewportPositionCore","resolve","promise","getViewportPosition","getItemIndexByPosition","viewportItemIndex","height","defaultItemSize","getItemSize","itemOffset","itemOffsetsWithSize","Object","keys","concat","i","itemOffsetWithSize","parseInt","itemOffsetDiff","itemSize","round","isScrollingBack","prevPosition","itemIndex","setViewportItemIndex","fire","setContentItemSizes","sizes","reduce","a","b","forEach","size","index","virtualContentSize","itemsCount","contentHeightLimit","getContentHeightLimit","getItemOffset","isEnd","itemCount","currentItemIndex","floor","getContentOffset","type","getVirtualContentSize","getViewportItemIndex","viewportItemIndexChanged","viewportItemSize","viewportSize","viewportHeight","ceil","reset","isRefresh","subscribeToWindowScrollEvents","_windowScroll","isVirtualMode","isAppendMode","_this$option2","virtualMode","hasKnownLastPage","topIndex","bottomIndex","maxGap","minGap","topMinGap","bottomMinGap","remainedItems","name"],"sources":["D:/APPLICATION/UI/UPL/NEW/node_modules/devextreme/esm/ui/grid_core/ui.grid_core.virtual_scrolling_core.js"],"sourcesContent":["/**\r\n * DevExtreme (esm/ui/grid_core/ui.grid_core.virtual_scrolling_core.js)\r\n * Version: 22.2.4\r\n * Build date: Thu Jan 19 2023\r\n *\r\n * Copyright (c) 2012 - 2023 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport $ from \"../../core/renderer\";\r\nimport {\r\n    getWindow\r\n} from \"../../core/utils/window\";\r\nimport eventsEngine from \"../../events/core/events_engine\";\r\nimport browser from \"../../core/utils/browser\";\r\nimport positionUtils from \"../../animation/position\";\r\nimport {\r\n    each\r\n} from \"../../core/utils/iterator\";\r\nimport Class from \"../../core/class\";\r\nimport {\r\n    Deferred\r\n} from \"../../core/utils/deferred\";\r\nimport Callbacks from \"../../core/utils/callbacks\";\r\nimport {\r\n    VirtualDataLoader\r\n} from \"./ui.grid.core.virtual_data_loader\";\r\nimport {\r\n    isDefined\r\n} from \"../../core/utils/type\";\r\nimport gridCoreUtils from \"./ui.grid_core.utils\";\r\nvar SCROLLING_MODE_INFINITE = \"infinite\";\r\nvar SCROLLING_MODE_VIRTUAL = \"virtual\";\r\nvar LEGACY_SCROLLING_MODE = \"scrolling.legacyMode\";\r\nvar _isVirtualMode = that => that.option(\"scrolling.mode\") === SCROLLING_MODE_VIRTUAL || that._isVirtual;\r\nvar _isAppendMode = that => that.option(\"scrolling.mode\") === SCROLLING_MODE_INFINITE && !that._isVirtual;\r\nexport function subscribeToExternalScrollers($element, scrollChangedHandler, $targetElement) {\r\n    var $scrollElement;\r\n    var scrollableArray = [];\r\n    var scrollToArray = [];\r\n    var disposeArray = [];\r\n    $targetElement = $targetElement || $element;\r\n\r\n    function getElementOffset(scrollable) {\r\n        var $scrollableElement = scrollable.element ? scrollable.$element() : scrollable;\r\n        var scrollableOffset = positionUtils.offset($scrollableElement);\r\n        if (!scrollableOffset) {\r\n            return $element.offset().top\r\n        }\r\n        return scrollable.scrollTop() - (scrollableOffset.top - $element.offset().top)\r\n    }\r\n    var widgetScrollStrategy = {\r\n        on: function(scrollable, eventName, handler) {\r\n            scrollable.on(\"scroll\", handler)\r\n        },\r\n        off: function(scrollable, eventName, handler) {\r\n            scrollable.off(\"scroll\", handler)\r\n        }\r\n    };\r\n\r\n    function subscribeToScrollEvents($scrollElement) {\r\n        var isDocument = \"#document\" === $scrollElement.get(0).nodeName;\r\n        var isElement = $scrollElement.get(0).nodeType === getWindow().Node.ELEMENT_NODE;\r\n        var scrollable = $scrollElement.data(\"dxScrollable\");\r\n        var eventsStrategy = widgetScrollStrategy;\r\n        if (!scrollable) {\r\n            scrollable = isDocument && $(getWindow()) || isElement && \"auto\" === $scrollElement.css(\"overflowY\") && $scrollElement;\r\n            eventsStrategy = eventsEngine;\r\n            if (!scrollable) {\r\n                return\r\n            }\r\n        }\r\n        var handler = function(scrollable) {\r\n            return function() {\r\n                var scrollTop = scrollable.scrollTop() - getElementOffset(scrollable);\r\n                scrollTop = scrollTop > 0 ? scrollTop : 0;\r\n                scrollChangedHandler(scrollTop)\r\n            }\r\n        }(scrollable);\r\n        eventsStrategy.on(scrollable, \"scroll\", handler);\r\n        scrollToArray.push((function(pos) {\r\n            var topOffset = getElementOffset(scrollable);\r\n            var scrollMethod = scrollable.scrollTo ? \"scrollTo\" : \"scrollTop\";\r\n            if (pos - topOffset >= 0) {\r\n                scrollable[scrollMethod](pos + topOffset)\r\n            }\r\n        }));\r\n        scrollableArray.push(scrollable);\r\n        disposeArray.push((function() {\r\n            eventsStrategy.off(scrollable, \"scroll\", handler)\r\n        }))\r\n    }\r\n    var getScrollElementParent = $element => {\r\n        var _$element$get$parentN;\r\n        return $(null !== (_$element$get$parentN = $element.get(0).parentNode) && void 0 !== _$element$get$parentN ? _$element$get$parentN : $element.get(0).host)\r\n    };\r\n    for ($scrollElement = $targetElement.parent(); $scrollElement.length; $scrollElement = getScrollElementParent($scrollElement)) {\r\n        subscribeToScrollEvents($scrollElement)\r\n    }\r\n    return {\r\n        scrollTo: function(pos) {\r\n            each(scrollToArray, (function(_, scrollTo) {\r\n                scrollTo(pos)\r\n            }))\r\n        },\r\n        dispose: function() {\r\n            each(disposeArray, (function(_, dispose) {\r\n                dispose()\r\n            }))\r\n        }\r\n    }\r\n}\r\nexport var VirtualScrollController = Class.inherit(function() {\r\n    var members = {\r\n        ctor: function(component, dataOptions, isVirtual) {\r\n            this._dataOptions = dataOptions;\r\n            this.component = component;\r\n            this._viewportSize = false === component.option(LEGACY_SCROLLING_MODE) ? 15 : 0;\r\n            this._viewportItemSize = 20;\r\n            this._viewportItemIndex = 0;\r\n            this._position = 0;\r\n            this._isScrollingBack = false;\r\n            this._contentSize = 0;\r\n            this._itemSizes = {};\r\n            this._sizeRatio = 1;\r\n            this._isVirtual = isVirtual;\r\n            this.positionChanged = Callbacks();\r\n            this._dataLoader = new VirtualDataLoader(this, this._dataOptions)\r\n        },\r\n        getItemSizes: function() {\r\n            return this._itemSizes\r\n        },\r\n        option: function() {\r\n            return this.component.option.apply(this.component, arguments)\r\n        },\r\n        isVirtual: function() {\r\n            return this._isVirtual\r\n        },\r\n        virtualItemsCount: function() {\r\n            if (_isVirtualMode(this)) {\r\n                var dataOptions = this._dataOptions;\r\n                var totalItemsCount = dataOptions.totalItemsCount();\r\n                if (false === this.option(LEGACY_SCROLLING_MODE) && -1 !== totalItemsCount) {\r\n                    var viewportParams = this.getViewportParams();\r\n                    var loadedOffset = dataOptions.loadedOffset();\r\n                    var loadedItemCount = dataOptions.loadedItemCount();\r\n                    var skip = Math.max(viewportParams.skip, loadedOffset);\r\n                    var take = Math.min(viewportParams.take, loadedItemCount);\r\n                    var endItemsCount = Math.max(totalItemsCount - (skip + take), 0);\r\n                    return {\r\n                        begin: skip,\r\n                        end: endItemsCount\r\n                    }\r\n                }\r\n                return this._dataLoader.virtualItemsCount.apply(this._dataLoader, arguments)\r\n            }\r\n        },\r\n        getScrollingTimeout: function() {\r\n            var renderAsync = this.option(\"scrolling.renderAsync\");\r\n            var scrollingTimeout = 0;\r\n            if (!isDefined(renderAsync)) {\r\n                scrollingTimeout = Math.min(this.option(\"scrolling.timeout\") || 0, this._dataOptions.changingDuration());\r\n                if (scrollingTimeout < this.option(\"scrolling.renderingThreshold\")) {\r\n                    scrollingTimeout = this.option(\"scrolling.minTimeout\") || 0\r\n                }\r\n            } else if (renderAsync) {\r\n                var _this$option;\r\n                scrollingTimeout = null !== (_this$option = this.option(\"scrolling.timeout\")) && void 0 !== _this$option ? _this$option : 0\r\n            }\r\n            return scrollingTimeout\r\n        },\r\n        setViewportPosition: function(position) {\r\n            var result = new Deferred;\r\n            var scrollingTimeout = this.getScrollingTimeout();\r\n            clearTimeout(this._scrollTimeoutID);\r\n            if (scrollingTimeout > 0) {\r\n                this._scrollTimeoutID = setTimeout(() => {\r\n                    this._setViewportPositionCore(position);\r\n                    result.resolve()\r\n                }, scrollingTimeout)\r\n            } else {\r\n                this._setViewportPositionCore(position);\r\n                result.resolve()\r\n            }\r\n            return result.promise()\r\n        },\r\n        getViewportPosition: function() {\r\n            return this._position\r\n        },\r\n        getItemIndexByPosition: function(position, viewportItemIndex, height) {\r\n            var _position;\r\n            position = null !== (_position = position) && void 0 !== _position ? _position : this._position;\r\n            var defaultItemSize = this.getItemSize();\r\n            var offset = 0;\r\n            var itemOffset = 0;\r\n            var itemOffsetsWithSize = Object.keys(this._itemSizes).concat(-1);\r\n            for (var i = 0; i < itemOffsetsWithSize.length && offset < position; i++) {\r\n                var itemOffsetWithSize = parseInt(itemOffsetsWithSize[i]);\r\n                var itemOffsetDiff = (position - offset) / defaultItemSize;\r\n                if (itemOffsetWithSize < 0 || itemOffset + itemOffsetDiff < itemOffsetWithSize) {\r\n                    itemOffset += itemOffsetDiff;\r\n                    if (this._sizeRatio < 1 && isDefined(viewportItemIndex)) {\r\n                        itemOffset = viewportItemIndex + height / this._viewportItemSize\r\n                    }\r\n                    break\r\n                } else {\r\n                    itemOffsetDiff = itemOffsetWithSize - itemOffset;\r\n                    offset += itemOffsetDiff * defaultItemSize;\r\n                    itemOffset += itemOffsetDiff\r\n                }\r\n                var itemSize = this._itemSizes[itemOffsetWithSize];\r\n                offset += itemSize;\r\n                itemOffset += offset < position ? 1 : (position - offset + itemSize) / itemSize\r\n            }\r\n            return Math.round(50 * itemOffset) / 50\r\n        },\r\n        isScrollingBack: function() {\r\n            return this._isScrollingBack\r\n        },\r\n        _setViewportPositionCore: function(position) {\r\n            var prevPosition = this._position || 0;\r\n            this._position = position;\r\n            if (prevPosition !== this._position) {\r\n                this._isScrollingBack = this._position < prevPosition\r\n            }\r\n            var itemIndex = this.getItemIndexByPosition();\r\n            var result = this.setViewportItemIndex(itemIndex);\r\n            this.positionChanged.fire();\r\n            return result\r\n        },\r\n        setContentItemSizes: function(sizes) {\r\n            var virtualItemsCount = this.virtualItemsCount();\r\n            this._contentSize = sizes.reduce((a, b) => a + b, 0);\r\n            if (virtualItemsCount) {\r\n                sizes.forEach((size, index) => {\r\n                    this._itemSizes[virtualItemsCount.begin + index] = size\r\n                });\r\n                var virtualContentSize = (virtualItemsCount.begin + virtualItemsCount.end + this.itemsCount()) * this._viewportItemSize;\r\n                var contentHeightLimit = gridCoreUtils.getContentHeightLimit(browser);\r\n                if (virtualContentSize > contentHeightLimit) {\r\n                    this._sizeRatio = contentHeightLimit / virtualContentSize\r\n                } else {\r\n                    this._sizeRatio = 1\r\n                }\r\n            }\r\n        },\r\n        getItemSize: function() {\r\n            return this._viewportItemSize * this._sizeRatio\r\n        },\r\n        getItemOffset: function(itemIndex, isEnd) {\r\n            var virtualItemsCount = this.virtualItemsCount();\r\n            var itemCount = itemIndex;\r\n            if (!virtualItemsCount) {\r\n                return 0\r\n            }\r\n            var offset = 0;\r\n            var totalItemsCount = this._dataOptions.totalItemsCount();\r\n            Object.keys(this._itemSizes).forEach(currentItemIndex => {\r\n                if (!itemCount) {\r\n                    return\r\n                }\r\n                if (isEnd ? currentItemIndex >= totalItemsCount - itemIndex : currentItemIndex < itemIndex) {\r\n                    offset += this._itemSizes[currentItemIndex];\r\n                    itemCount--\r\n                }\r\n            });\r\n            return Math.floor(offset + itemCount * this._viewportItemSize * this._sizeRatio)\r\n        },\r\n        getContentOffset: function(type) {\r\n            var isEnd = \"end\" === type;\r\n            var virtualItemsCount = this.virtualItemsCount();\r\n            if (!virtualItemsCount) {\r\n                return 0\r\n            }\r\n            return this.getItemOffset(isEnd ? virtualItemsCount.end : virtualItemsCount.begin, isEnd)\r\n        },\r\n        getVirtualContentSize: function() {\r\n            var virtualItemsCount = this.virtualItemsCount();\r\n            return virtualItemsCount ? this.getContentOffset(\"begin\") + this.getContentOffset(\"end\") + this._contentSize : 0\r\n        },\r\n        getViewportItemIndex: function() {\r\n            return this._viewportItemIndex\r\n        },\r\n        setViewportItemIndex: function(itemIndex) {\r\n            this._viewportItemIndex = itemIndex;\r\n            if (false === this.option(LEGACY_SCROLLING_MODE)) {\r\n                return\r\n            }\r\n            return this._dataLoader.viewportItemIndexChanged.apply(this._dataLoader, arguments)\r\n        },\r\n        viewportItemSize: function(size) {\r\n            if (void 0 !== size) {\r\n                this._viewportItemSize = size\r\n            }\r\n            return this._viewportItemSize\r\n        },\r\n        viewportSize: function(size) {\r\n            if (void 0 !== size) {\r\n                this._viewportSize = size\r\n            }\r\n            return this._viewportSize\r\n        },\r\n        viewportHeight: function(height, scrollTop) {\r\n            var position = null !== scrollTop && void 0 !== scrollTop ? scrollTop : this._position;\r\n            var begin = this.getItemIndexByPosition(position);\r\n            var end = this.getItemIndexByPosition(position + height, begin, height);\r\n            this.viewportSize(Math.ceil(end - begin));\r\n            if (!isDefined(scrollTop) && this._viewportItemIndex !== begin) {\r\n                this._setViewportPositionCore(position)\r\n            }\r\n        },\r\n        reset: function(isRefresh) {\r\n            this._dataLoader.reset();\r\n            if (!isRefresh) {\r\n                this._itemSizes = {}\r\n            }\r\n        },\r\n        subscribeToWindowScrollEvents: function($element) {\r\n            this._windowScroll = this._windowScroll || subscribeToExternalScrollers($element, scrollTop => {\r\n                if (this.viewportItemSize()) {\r\n                    this.setViewportPosition(scrollTop)\r\n                }\r\n            })\r\n        },\r\n        dispose: function() {\r\n            clearTimeout(this._scrollTimeoutID);\r\n            this._windowScroll && this._windowScroll.dispose();\r\n            this._windowScroll = null\r\n        },\r\n        scrollTo: function(pos) {\r\n            this._windowScroll && this._windowScroll.scrollTo(pos)\r\n        },\r\n        isVirtualMode: function() {\r\n            return _isVirtualMode(this)\r\n        },\r\n        isAppendMode: function() {\r\n            return _isAppendMode(this)\r\n        },\r\n        getViewportParams: function() {\r\n            var _this$option2;\r\n            var virtualMode = this.option(\"scrolling.mode\") === SCROLLING_MODE_VIRTUAL;\r\n            var totalItemsCount = this._dataOptions.totalItemsCount();\r\n            var hasKnownLastPage = this._dataOptions.hasKnownLastPage();\r\n            var topIndex = hasKnownLastPage && this._viewportItemIndex > totalItemsCount ? totalItemsCount : this._viewportItemIndex;\r\n            var bottomIndex = this._viewportSize + topIndex;\r\n            var maxGap = this.option(\"scrolling.prerenderedRowChunkSize\") || 1;\r\n            var isScrollingBack = this.isScrollingBack();\r\n            var minGap = null !== (_this$option2 = this.option(\"scrolling.prerenderedRowCount\")) && void 0 !== _this$option2 ? _this$option2 : 1;\r\n            var topMinGap = isScrollingBack ? minGap : 0;\r\n            var bottomMinGap = isScrollingBack ? 0 : minGap;\r\n            var skip = Math.floor(Math.max(0, topIndex - topMinGap) / maxGap) * maxGap;\r\n            var take = Math.ceil((bottomIndex + bottomMinGap - skip) / maxGap) * maxGap;\r\n            if (virtualMode) {\r\n                var remainedItems = Math.max(0, totalItemsCount - skip);\r\n                take = Math.min(take, remainedItems)\r\n            }\r\n            return {\r\n                skip: skip,\r\n                take: take\r\n            }\r\n        },\r\n        itemsCount: function() {\r\n            var result = 0;\r\n            if (this.option(LEGACY_SCROLLING_MODE)) {\r\n                result = this._dataLoader.itemsCount.apply(this._dataLoader, arguments)\r\n            } else {\r\n                result = this._dataOptions.itemsCount()\r\n            }\r\n            return result\r\n        }\r\n    };\r\n    [\"pageIndex\", \"beginPageIndex\", \"endPageIndex\", \"pageSize\", \"load\", \"loadIfNeed\", \"handleDataChanged\", \"getDelayDeferred\"].forEach((function(name) {\r\n        members[name] = function() {\r\n            return this._dataLoader[name].apply(this._dataLoader, arguments)\r\n        }\r\n    }));\r\n    return members\r\n}());\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}
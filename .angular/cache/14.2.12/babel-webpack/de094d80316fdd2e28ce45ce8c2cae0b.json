{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/pivot_grid/ui.pivot_grid.field_chooser.js)\r\n * Version: 22.2.4\r\n * Build date: Thu Jan 19 2023\r\n *\r\n * Copyright (c) 2012 - 2023 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../../core/renderer\";\nimport { getImageContainer } from \"../../core/utils/icon\";\nimport { hasWindow as hasWindowFn } from \"../../core/utils/window\";\nimport { isDefined } from \"../../core/utils/type\";\nimport { extend } from \"../../core/utils/extend\";\nimport { each } from \"../../core/utils/iterator\";\nimport localizationMessage from \"../../localization/message\";\nimport registerComponent from \"../../core/component_registrator\";\nimport { getCompareFunction, foreachDataLevel } from \"./ui.pivot_grid.utils\";\nimport TreeView from \"../tree_view\";\nimport ContextMenu from \"../context_menu\";\nimport BaseFieldChooser from \"./ui.pivot_grid.field_chooser_base\";\nvar DIV = \"<div>\";\nvar hasWindow = hasWindowFn();\nimport \"./data_source\";\nimport { SortableConst } from \"./sortable/index\";\nvar FIELDCHOOSER_CLASS = \"dx-pivotgridfieldchooser\";\nvar FIELDCHOOSER_CONTAINER_CLASS = \"dx-pivotgridfieldchooser-container\";\nvar FIELDS_CONTAINER_CLASS = \"dx-pivotgrid-fields-container\";\nvar AREA_DRAG_CLASS = \"dx-pivotgrid-drag-action\";\n\nfunction getDimensionFields(item, fields) {\n  var result = [];\n\n  if (item.items) {\n    for (var i = 0; i < item.items.length; i++) {\n      result.push.apply(result, getDimensionFields(item.items[i], fields));\n    }\n  } else if (isDefined(item.index)) {\n    result.push(fields[item.index]);\n  }\n\n  return result;\n}\n\nfunction getFirstItem(item, condition) {\n  if (item.items) {\n    for (var i = 0; i < item.items.length; i++) {\n      var childrenItem = getFirstItem(item.items[i], condition);\n\n      if (childrenItem) {\n        return childrenItem;\n      }\n    }\n  }\n\n  if (condition(item)) {\n    return item;\n  }\n}\n\nvar compareOrder = [function (a, b) {\n  var aValue = -!!a.isMeasure;\n  var bValue = +!!b.isMeasure;\n  return aValue + bValue;\n}, function (a, b) {\n  var aValue = -!!(a.items && a.items.length);\n  var bValue = +!!(b.items && b.items.length);\n  return aValue + bValue;\n}, function (a, b) {\n  var aValue = +!!(false === a.isMeasure && a.field && a.field.levels && a.field.levels.length);\n  var bValue = -!!(false === b.isMeasure && b.field && b.field.levels && b.field.levels.length);\n  return aValue + bValue;\n}, getCompareFunction(function (item) {\n  return item.text;\n})];\n\nfunction compareItems(a, b) {\n  var result = 0;\n  var i = 0;\n\n  while (!result && compareOrder[i]) {\n    result = compareOrder[i++](a, b);\n  }\n\n  return result;\n}\n\nfunction getScrollable(container) {\n  return container.find(\".dx-scrollable\").dxScrollable(\"instance\");\n}\n\nvar FieldChooser = BaseFieldChooser.inherit({\n  _getDefaultOptions: function () {\n    return extend(this.callBase(), {\n      height: 400,\n      layout: 0,\n      dataSource: null,\n      encodeHtml: true,\n      onContextMenuPreparing: null,\n      allowSearch: false,\n      searchTimeout: 500,\n      texts: {\n        columnFields: localizationMessage.format(\"dxPivotGrid-columnFields\"),\n        rowFields: localizationMessage.format(\"dxPivotGrid-rowFields\"),\n        dataFields: localizationMessage.format(\"dxPivotGrid-dataFields\"),\n        filterFields: localizationMessage.format(\"dxPivotGrid-filterFields\"),\n        allFields: localizationMessage.format(\"dxPivotGrid-allFields\")\n      }\n    });\n  },\n  _refreshDataSource: function () {\n    var that = this;\n    that._expandedPaths = [];\n\n    that._changedHandler = that._changedHandler || function () {\n      each(that._dataChangedHandlers, function (_, func) {\n        func();\n      });\n\n      that._fireContentReadyAction();\n\n      that._skipStateChange = true;\n      that.option(\"state\", that._dataSource.state());\n      that._skipStateChange = false;\n    };\n\n    that._disposeDataSource();\n\n    that.callBase();\n    that._dataSource && that._dataSource.on(\"changed\", that._changedHandler);\n  },\n  _disposeDataSource: function () {\n    var dataSource = this._dataSource;\n\n    if (dataSource) {\n      dataSource.off(\"changed\", this._changedHandler);\n      this._dataSource = void 0;\n    }\n  },\n  _dispose: function () {\n    this._disposeDataSource();\n\n    this.callBase.apply(this, arguments);\n  },\n  _init: function () {\n    this.callBase();\n\n    this._refreshDataSource();\n\n    this._dataChangedHandlers = [];\n\n    this._initActions();\n  },\n  _initActions: function () {\n    this._actions = {\n      onContextMenuPreparing: this._createActionByOption(\"onContextMenuPreparing\")\n    };\n  },\n  _trigger: function (eventName, eventArg) {\n    this._actions[eventName](eventArg);\n  },\n  _setOptionsByReference: function () {\n    this.callBase();\n    extend(this._optionsByReference, {\n      dataSource: true\n    });\n  },\n  _optionChanged: function (args) {\n    switch (args.name) {\n      case \"dataSource\":\n        this._refreshDataSource();\n\n        this._invalidate();\n\n        break;\n\n      case \"layout\":\n      case \"texts\":\n      case \"allowSearch\":\n      case \"searchTimeout\":\n      case \"encodeHtml\":\n        this._invalidate();\n\n        break;\n\n      case \"onContextMenuPreparing\":\n        this._actions[args.name] = this._createActionByOption(args.name);\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  },\n  _clean: function (skipStateSetting) {\n    !skipStateSetting && this._dataSource && this.option(\"state\", this._dataSource.state());\n    this.$element().children(\".\" + FIELDCHOOSER_CONTAINER_CLASS).remove();\n  },\n  _renderLayout0: function ($container) {\n    $container.addClass(\"dx-layout-0\");\n    var $row1 = $(DIV).addClass(\"dx-row\").appendTo($container);\n    var $row2 = $(DIV).addClass(\"dx-row\").appendTo($container);\n    var $col1 = $(DIV).addClass(\"dx-col\").appendTo($row1);\n    var $col2 = $(DIV).addClass(\"dx-col\").appendTo($row1);\n    var $col3 = $(DIV).addClass(\"dx-col\").appendTo($row2);\n    var $col4 = $(DIV).addClass(\"dx-col\").appendTo($row2);\n\n    this._renderArea($col1, \"all\");\n\n    this._renderArea($col2, \"row\");\n\n    this._renderArea($col2, \"column\");\n\n    this._renderArea($col3, \"filter\");\n\n    this._renderArea($col4, \"data\");\n  },\n  _renderLayout1: function ($container) {\n    var $col1 = $(DIV).addClass(\"dx-col\").appendTo($container);\n    var $col2 = $(DIV).addClass(\"dx-col\").appendTo($container);\n\n    this._renderArea($col1, \"all\");\n\n    this._renderArea($col2, \"filter\");\n\n    this._renderArea($col2, \"row\");\n\n    this._renderArea($col2, \"column\");\n\n    this._renderArea($col2, \"data\");\n  },\n  _renderLayout2: function ($container) {\n    $container.addClass(\"dx-layout-2\");\n    var $row1 = $(DIV).addClass(\"dx-row\").appendTo($container);\n\n    this._renderArea($row1, \"all\");\n\n    var $row2 = $(DIV).addClass(\"dx-row\").appendTo($container);\n    var $col1 = $(DIV).addClass(\"dx-col\").appendTo($row2);\n    var $col2 = $(DIV).addClass(\"dx-col\").appendTo($row2);\n\n    this._renderArea($col1, \"filter\");\n\n    this._renderArea($col1, \"row\");\n\n    this._renderArea($col2, \"column\");\n\n    this._renderArea($col2, \"data\");\n  },\n  _initMarkup: function () {\n    var $element = this.$element();\n    var $container = $(DIV).addClass(FIELDCHOOSER_CONTAINER_CLASS).appendTo($element);\n    var layout = this.option(\"layout\");\n    this.callBase();\n    $element.addClass(FIELDCHOOSER_CLASS).addClass(FIELDS_CONTAINER_CLASS);\n    this._dataChangedHandlers = [];\n    var dataSource = this._dataSource;\n    var currentState = \"instantly\" !== this.option(\"applyChangesMode\") && dataSource && dataSource.state();\n    currentState && this.option(\"state\") && dataSource.state(this.option(\"state\"), true);\n\n    if (0 === layout) {\n      this._renderLayout0($container);\n    } else if (1 === layout) {\n      this._renderLayout1($container);\n    } else {\n      this._renderLayout2($container);\n    }\n\n    currentState && dataSource.state(currentState, true);\n  },\n  _renderContentImpl: function () {\n    this.callBase();\n    this.renderSortable();\n\n    this._renderContextMenu();\n\n    this.updateDimensions();\n  },\n  _fireContentReadyAction: function () {\n    if (!this._dataSource || !this._dataSource.isLoading()) {\n      this.callBase();\n    }\n  },\n  _getContextMenuArgs: function (dxEvent) {\n    var targetFieldElement = $(dxEvent.target).closest(\".dx-area-field\");\n    var targetGroupElement = $(dxEvent.target).closest(\".dx-area-fields\");\n    var field;\n    var area;\n\n    if (targetFieldElement.length) {\n      var fieldCopy = targetFieldElement.data(\"field\");\n\n      if (fieldCopy) {\n        field = this.getDataSource().field(fieldCopy.index) || fieldCopy;\n      }\n    }\n\n    if (targetGroupElement.length) {\n      area = targetGroupElement.attr(\"group\");\n    }\n\n    return {\n      event: dxEvent,\n      field: field,\n      area: area,\n      items: []\n    };\n  },\n  _renderContextMenu: function () {\n    var that = this;\n    var $container = that.$element();\n\n    if (that._contextMenu) {\n      that._contextMenu.$element().remove();\n    }\n\n    that._contextMenu = that._createComponent($(DIV).appendTo($container), ContextMenu, {\n      onPositioning: function (actionArgs) {\n        var event = actionArgs.event;\n\n        if (!event) {\n          return;\n        }\n\n        var args = that._getContextMenuArgs(event);\n\n        that._trigger(\"onContextMenuPreparing\", args);\n\n        if (args.items && args.items.length) {\n          actionArgs.component.option(\"items\", args.items);\n        } else {\n          actionArgs.cancel = true;\n        }\n      },\n      target: $container,\n      onItemClick: function (params) {\n        params.itemData.onItemClick && params.itemData.onItemClick(params);\n      },\n      cssClass: \"dx-pivotgridfieldchooser-context-menu\"\n    });\n  },\n  _createTreeItems: function (fields, groupFieldNames, path) {\n    var that = this;\n    var isMeasure;\n    var resultItems = [];\n    var groupedItems = [];\n    var groupFieldName = groupFieldNames[0];\n    var fieldsByGroup = {};\n\n    if (!groupFieldName) {\n      each(fields, function (index, field) {\n        var icon;\n\n        if (true === field.isMeasure) {\n          icon = \"measure\";\n        }\n\n        if (false === field.isMeasure) {\n          icon = field.groupName ? \"hierarchy\" : \"dimension\";\n        }\n\n        resultItems.push({\n          index: field.index,\n          field: field,\n          key: field.dataField,\n          selected: isDefined(field.area),\n          text: field.caption || field.dataField,\n          icon: icon,\n          isMeasure: field.isMeasure,\n          isDefault: field.isDefault\n        });\n      });\n    } else {\n      each(fields, function (index, field) {\n        var groupName = field[groupFieldName] || \"\";\n        fieldsByGroup[groupName] = fieldsByGroup[groupName] || [];\n        fieldsByGroup[groupName].push(field);\n\n        if (void 0 === isMeasure) {\n          isMeasure = true;\n        }\n\n        isMeasure = isMeasure && true === field.isMeasure;\n      });\n      each(fieldsByGroup, function (groupName, fields) {\n        var currentPath = path ? path + \".\" + groupName : groupName;\n\n        var items = that._createTreeItems(fields, groupFieldNames.slice(1), currentPath);\n\n        if (groupName) {\n          groupedItems.push({\n            key: groupName,\n            text: groupName,\n            path: currentPath,\n            isMeasure: items.isMeasure,\n            expanded: that._expandedPaths.includes(currentPath),\n            items: items\n          });\n        } else {\n          resultItems = items;\n        }\n      });\n      resultItems = groupedItems.concat(resultItems);\n      resultItems.isMeasure = isMeasure;\n    }\n\n    return resultItems;\n  },\n  _createFieldsDataSource: function (dataSource) {\n    var fields = dataSource && dataSource.fields() || [];\n    fields = fields.filter(field => false !== field.visible && !isDefined(field.groupIndex));\n\n    var treeItems = this._createTreeItems(fields, [\"dimension\", \"displayFolder\"]);\n\n    foreachDataLevel(treeItems, function (items) {\n      items.sort(compareItems);\n    }, 0, \"items\");\n    return treeItems;\n  },\n  _renderFieldsTreeView: function (container) {\n    var that = this;\n    var dataSource = that._dataSource;\n\n    var treeView = that._createComponent(container, TreeView, {\n      dataSource: that._createFieldsDataSource(dataSource),\n      showCheckBoxesMode: \"normal\",\n      expandNodesRecursive: false,\n      searchEnabled: that.option(\"allowSearch\"),\n      searchTimeout: that.option(\"searchTimeout\"),\n      useNativeScrolling: false,\n      itemTemplate: function (itemData, itemIndex, itemElement) {\n        var $item = $(\"<div>\").toggleClass(\"dx-area-field\", !itemData.items).attr(SortableConst.attrs.treeViewItem, true).data(\"field\", itemData.field).appendTo(itemElement);\n\n        if (itemData.icon) {\n          getImageContainer(itemData.icon).appendTo($item);\n        }\n\n        $(\"<span>\").text(itemData.text).appendTo($item);\n      },\n      onItemCollapsed: function (e) {\n        var index = that._expandedPaths.indexOf(e.itemData.path);\n\n        if (index >= 0) {\n          that._expandedPaths.splice(index, 1);\n        }\n      },\n      onItemExpanded: function (e) {\n        var index = that._expandedPaths.indexOf(e.itemData.path);\n\n        if (index < 0) {\n          that._expandedPaths.push(e.itemData.path);\n        }\n      },\n      onItemSelectionChanged: function (e) {\n        var data = e.itemData;\n        var field;\n        var fields;\n        var needSelectDefaultItem = true;\n        var area;\n\n        if (data.items) {\n          if (data.selected) {\n            treeView.unselectItem(data);\n            return;\n          }\n\n          that._processDemandState(() => {\n            fields = getDimensionFields(data, dataSource.fields());\n\n            for (var i = 0; i < fields.length; i++) {\n              if (fields[i].area) {\n                needSelectDefaultItem = false;\n                break;\n              }\n            }\n          });\n\n          if (needSelectDefaultItem) {\n            var item = getFirstItem(data, function (item) {\n              return item.isDefault;\n            }) || getFirstItem(data, function (item) {\n              return isDefined(item.index);\n            });\n            item && treeView.selectItem(item);\n            return;\n          }\n        } else {\n          field = dataSource.fields()[data.index];\n\n          if (data.selected) {\n            area = field.isMeasure ? \"data\" : \"column\";\n          }\n\n          if (field) {\n            fields = [field];\n          }\n        }\n\n        that._applyChanges(fields, {\n          area: area,\n          areaIndex: void 0\n        });\n      }\n    });\n\n    that._dataChangedHandlers.push(function () {\n      var scrollable = getScrollable(container);\n      var scrollTop = scrollable ? scrollable.scrollTop() : 0;\n      treeView.option({\n        dataSource: that._createFieldsDataSource(dataSource)\n      });\n      scrollable = getScrollable(container);\n\n      if (scrollable) {\n        scrollable.scrollTo({\n          y: scrollTop\n        });\n        scrollable.update();\n      }\n    });\n  },\n  _renderAreaFields: function ($container, area) {\n    var that = this;\n    var dataSource = that._dataSource;\n    var fields = dataSource ? extend(true, [], dataSource.getAreaFields(area, true)) : [];\n    $container.empty();\n    each(fields, function (_, field) {\n      if (false !== field.visible) {\n        that.renderField(field, true).appendTo($container);\n      }\n    });\n  },\n  _renderArea: function (container, area) {\n    var that = this;\n    var $areaContainer = $(DIV).addClass(\"dx-area\").appendTo(container);\n    var $fieldsHeaderContainer = $(DIV).addClass(\"dx-area-fields-header\").appendTo($areaContainer);\n    var caption = that.option(\"texts.\" + area + \"Fields\");\n    var $fieldsContent;\n    var render;\n    $(\"<span>\").addClass(\"dx-area-icon\").addClass(\"dx-area-icon-\" + area).appendTo($fieldsHeaderContainer);\n    $(\"<span>\").html(\"&nbsp;\").appendTo($fieldsHeaderContainer);\n    $(\"<span>\").addClass(\"dx-area-caption\").text(caption).appendTo($fieldsHeaderContainer);\n    var $fieldsContainer = $(DIV).addClass(\"dx-area-fields\").addClass(AREA_DRAG_CLASS).appendTo($areaContainer);\n\n    if (\"all\" !== area) {\n      $fieldsContainer.attr(\"group\", area).attr(\"allow-scrolling\", true);\n      $fieldsContent = $(DIV).addClass(\"dx-area-field-container\").appendTo($fieldsContainer);\n\n      render = function () {\n        that._renderAreaFields($fieldsContent, area);\n      };\n\n      that._dataChangedHandlers.push(render);\n\n      render();\n      $fieldsContainer.dxScrollable({\n        useNative: false\n      });\n    } else {\n      $areaContainer.addClass(\"dx-all-fields\");\n      $fieldsContainer.addClass(\"dx-treeview-border-visible\");\n\n      that._renderFieldsTreeView($fieldsContainer);\n    }\n  },\n  _getSortableOptions: function () {\n    return {};\n  },\n  _adjustSortableOnChangedArgs: function () {},\n  resetTreeView: function () {\n    var treeView = this.$element().find(\".dx-treeview\").dxTreeView(\"instance\");\n\n    if (treeView) {\n      treeView.option(\"searchValue\", \"\");\n      treeView.collapseAll();\n    }\n  },\n  applyChanges: function () {\n    var state = this.option(\"state\");\n\n    if (isDefined(state)) {\n      this._dataSource.state(state);\n    }\n  },\n  cancelChanges: function () {\n    var dataSource = this._dataSource;\n\n    if (!dataSource.isLoading()) {\n      this.option(\"state\", dataSource.state());\n      return true;\n    }\n\n    return false;\n  },\n  getDataSource: function () {\n    return this._dataSource;\n  },\n  updateDimensions: function () {\n    var $scrollableElements = this.$element().find(\".dx-area .dx-scrollable\");\n    $scrollableElements.dxScrollable(\"update\");\n  },\n  _visibilityChanged: function (visible) {\n    if (visible && hasWindow) {\n      this.updateDimensions();\n    }\n  }\n});\nregisterComponent(\"dxPivotGridFieldChooser\", FieldChooser);\nexport default FieldChooser;","map":{"version":3,"names":["$","getImageContainer","hasWindow","hasWindowFn","isDefined","extend","each","localizationMessage","registerComponent","getCompareFunction","foreachDataLevel","TreeView","ContextMenu","BaseFieldChooser","DIV","SortableConst","FIELDCHOOSER_CLASS","FIELDCHOOSER_CONTAINER_CLASS","FIELDS_CONTAINER_CLASS","AREA_DRAG_CLASS","getDimensionFields","item","fields","result","items","i","length","push","apply","index","getFirstItem","condition","childrenItem","compareOrder","a","b","aValue","isMeasure","bValue","field","levels","text","compareItems","getScrollable","container","find","dxScrollable","FieldChooser","inherit","_getDefaultOptions","callBase","height","layout","dataSource","encodeHtml","onContextMenuPreparing","allowSearch","searchTimeout","texts","columnFields","format","rowFields","dataFields","filterFields","allFields","_refreshDataSource","that","_expandedPaths","_changedHandler","_dataChangedHandlers","_","func","_fireContentReadyAction","_skipStateChange","option","_dataSource","state","_disposeDataSource","on","off","_dispose","arguments","_init","_initActions","_actions","_createActionByOption","_trigger","eventName","eventArg","_setOptionsByReference","_optionsByReference","_optionChanged","args","name","_invalidate","_clean","skipStateSetting","$element","children","remove","_renderLayout0","$container","addClass","$row1","appendTo","$row2","$col1","$col2","$col3","$col4","_renderArea","_renderLayout1","_renderLayout2","_initMarkup","currentState","_renderContentImpl","renderSortable","_renderContextMenu","updateDimensions","isLoading","_getContextMenuArgs","dxEvent","targetFieldElement","target","closest","targetGroupElement","area","fieldCopy","data","getDataSource","attr","event","_contextMenu","_createComponent","onPositioning","actionArgs","component","cancel","onItemClick","params","itemData","cssClass","_createTreeItems","groupFieldNames","path","resultItems","groupedItems","groupFieldName","fieldsByGroup","icon","groupName","key","dataField","selected","caption","isDefault","currentPath","slice","expanded","includes","concat","_createFieldsDataSource","filter","visible","groupIndex","treeItems","sort","_renderFieldsTreeView","treeView","showCheckBoxesMode","expandNodesRecursive","searchEnabled","useNativeScrolling","itemTemplate","itemIndex","itemElement","$item","toggleClass","attrs","treeViewItem","onItemCollapsed","e","indexOf","splice","onItemExpanded","onItemSelectionChanged","needSelectDefaultItem","unselectItem","_processDemandState","selectItem","_applyChanges","areaIndex","scrollable","scrollTop","scrollTo","y","update","_renderAreaFields","getAreaFields","empty","renderField","$areaContainer","$fieldsHeaderContainer","$fieldsContent","render","html","$fieldsContainer","useNative","_getSortableOptions","_adjustSortableOnChangedArgs","resetTreeView","dxTreeView","collapseAll","applyChanges","cancelChanges","$scrollableElements","_visibilityChanged"],"sources":["D:/APPLICATION/UI/UPL/NEW/node_modules/devextreme/esm/ui/pivot_grid/ui.pivot_grid.field_chooser.js"],"sourcesContent":["/**\r\n * DevExtreme (esm/ui/pivot_grid/ui.pivot_grid.field_chooser.js)\r\n * Version: 22.2.4\r\n * Build date: Thu Jan 19 2023\r\n *\r\n * Copyright (c) 2012 - 2023 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport $ from \"../../core/renderer\";\r\nimport {\r\n    getImageContainer\r\n} from \"../../core/utils/icon\";\r\nimport {\r\n    hasWindow as hasWindowFn\r\n} from \"../../core/utils/window\";\r\nimport {\r\n    isDefined\r\n} from \"../../core/utils/type\";\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    each\r\n} from \"../../core/utils/iterator\";\r\nimport localizationMessage from \"../../localization/message\";\r\nimport registerComponent from \"../../core/component_registrator\";\r\nimport {\r\n    getCompareFunction,\r\n    foreachDataLevel\r\n} from \"./ui.pivot_grid.utils\";\r\nimport TreeView from \"../tree_view\";\r\nimport ContextMenu from \"../context_menu\";\r\nimport BaseFieldChooser from \"./ui.pivot_grid.field_chooser_base\";\r\nvar DIV = \"<div>\";\r\nvar hasWindow = hasWindowFn();\r\nimport \"./data_source\";\r\nimport {\r\n    SortableConst\r\n} from \"./sortable/index\";\r\nvar FIELDCHOOSER_CLASS = \"dx-pivotgridfieldchooser\";\r\nvar FIELDCHOOSER_CONTAINER_CLASS = \"dx-pivotgridfieldchooser-container\";\r\nvar FIELDS_CONTAINER_CLASS = \"dx-pivotgrid-fields-container\";\r\nvar AREA_DRAG_CLASS = \"dx-pivotgrid-drag-action\";\r\n\r\nfunction getDimensionFields(item, fields) {\r\n    var result = [];\r\n    if (item.items) {\r\n        for (var i = 0; i < item.items.length; i++) {\r\n            result.push.apply(result, getDimensionFields(item.items[i], fields))\r\n        }\r\n    } else if (isDefined(item.index)) {\r\n        result.push(fields[item.index])\r\n    }\r\n    return result\r\n}\r\n\r\nfunction getFirstItem(item, condition) {\r\n    if (item.items) {\r\n        for (var i = 0; i < item.items.length; i++) {\r\n            var childrenItem = getFirstItem(item.items[i], condition);\r\n            if (childrenItem) {\r\n                return childrenItem\r\n            }\r\n        }\r\n    }\r\n    if (condition(item)) {\r\n        return item\r\n    }\r\n}\r\nvar compareOrder = [function(a, b) {\r\n    var aValue = -!!a.isMeasure;\r\n    var bValue = +!!b.isMeasure;\r\n    return aValue + bValue\r\n}, function(a, b) {\r\n    var aValue = -!!(a.items && a.items.length);\r\n    var bValue = +!!(b.items && b.items.length);\r\n    return aValue + bValue\r\n}, function(a, b) {\r\n    var aValue = +!!(false === a.isMeasure && a.field && a.field.levels && a.field.levels.length);\r\n    var bValue = -!!(false === b.isMeasure && b.field && b.field.levels && b.field.levels.length);\r\n    return aValue + bValue\r\n}, getCompareFunction((function(item) {\r\n    return item.text\r\n}))];\r\n\r\nfunction compareItems(a, b) {\r\n    var result = 0;\r\n    var i = 0;\r\n    while (!result && compareOrder[i]) {\r\n        result = compareOrder[i++](a, b)\r\n    }\r\n    return result\r\n}\r\n\r\nfunction getScrollable(container) {\r\n    return container.find(\".dx-scrollable\").dxScrollable(\"instance\")\r\n}\r\nvar FieldChooser = BaseFieldChooser.inherit({\r\n    _getDefaultOptions: function() {\r\n        return extend(this.callBase(), {\r\n            height: 400,\r\n            layout: 0,\r\n            dataSource: null,\r\n            encodeHtml: true,\r\n            onContextMenuPreparing: null,\r\n            allowSearch: false,\r\n            searchTimeout: 500,\r\n            texts: {\r\n                columnFields: localizationMessage.format(\"dxPivotGrid-columnFields\"),\r\n                rowFields: localizationMessage.format(\"dxPivotGrid-rowFields\"),\r\n                dataFields: localizationMessage.format(\"dxPivotGrid-dataFields\"),\r\n                filterFields: localizationMessage.format(\"dxPivotGrid-filterFields\"),\r\n                allFields: localizationMessage.format(\"dxPivotGrid-allFields\")\r\n            }\r\n        })\r\n    },\r\n    _refreshDataSource: function() {\r\n        var that = this;\r\n        that._expandedPaths = [];\r\n        that._changedHandler = that._changedHandler || function() {\r\n            each(that._dataChangedHandlers, (function(_, func) {\r\n                func()\r\n            }));\r\n            that._fireContentReadyAction();\r\n            that._skipStateChange = true;\r\n            that.option(\"state\", that._dataSource.state());\r\n            that._skipStateChange = false\r\n        };\r\n        that._disposeDataSource();\r\n        that.callBase();\r\n        that._dataSource && that._dataSource.on(\"changed\", that._changedHandler)\r\n    },\r\n    _disposeDataSource: function() {\r\n        var dataSource = this._dataSource;\r\n        if (dataSource) {\r\n            dataSource.off(\"changed\", this._changedHandler);\r\n            this._dataSource = void 0\r\n        }\r\n    },\r\n    _dispose: function() {\r\n        this._disposeDataSource();\r\n        this.callBase.apply(this, arguments)\r\n    },\r\n    _init: function() {\r\n        this.callBase();\r\n        this._refreshDataSource();\r\n        this._dataChangedHandlers = [];\r\n        this._initActions()\r\n    },\r\n    _initActions: function() {\r\n        this._actions = {\r\n            onContextMenuPreparing: this._createActionByOption(\"onContextMenuPreparing\")\r\n        }\r\n    },\r\n    _trigger: function(eventName, eventArg) {\r\n        this._actions[eventName](eventArg)\r\n    },\r\n    _setOptionsByReference: function() {\r\n        this.callBase();\r\n        extend(this._optionsByReference, {\r\n            dataSource: true\r\n        })\r\n    },\r\n    _optionChanged: function(args) {\r\n        switch (args.name) {\r\n            case \"dataSource\":\r\n                this._refreshDataSource();\r\n                this._invalidate();\r\n                break;\r\n            case \"layout\":\r\n            case \"texts\":\r\n            case \"allowSearch\":\r\n            case \"searchTimeout\":\r\n            case \"encodeHtml\":\r\n                this._invalidate();\r\n                break;\r\n            case \"onContextMenuPreparing\":\r\n                this._actions[args.name] = this._createActionByOption(args.name);\r\n                break;\r\n            default:\r\n                this.callBase(args)\r\n        }\r\n    },\r\n    _clean: function(skipStateSetting) {\r\n        !skipStateSetting && this._dataSource && this.option(\"state\", this._dataSource.state());\r\n        this.$element().children(\".\" + FIELDCHOOSER_CONTAINER_CLASS).remove()\r\n    },\r\n    _renderLayout0: function($container) {\r\n        $container.addClass(\"dx-layout-0\");\r\n        var $row1 = $(DIV).addClass(\"dx-row\").appendTo($container);\r\n        var $row2 = $(DIV).addClass(\"dx-row\").appendTo($container);\r\n        var $col1 = $(DIV).addClass(\"dx-col\").appendTo($row1);\r\n        var $col2 = $(DIV).addClass(\"dx-col\").appendTo($row1);\r\n        var $col3 = $(DIV).addClass(\"dx-col\").appendTo($row2);\r\n        var $col4 = $(DIV).addClass(\"dx-col\").appendTo($row2);\r\n        this._renderArea($col1, \"all\");\r\n        this._renderArea($col2, \"row\");\r\n        this._renderArea($col2, \"column\");\r\n        this._renderArea($col3, \"filter\");\r\n        this._renderArea($col4, \"data\")\r\n    },\r\n    _renderLayout1: function($container) {\r\n        var $col1 = $(DIV).addClass(\"dx-col\").appendTo($container);\r\n        var $col2 = $(DIV).addClass(\"dx-col\").appendTo($container);\r\n        this._renderArea($col1, \"all\");\r\n        this._renderArea($col2, \"filter\");\r\n        this._renderArea($col2, \"row\");\r\n        this._renderArea($col2, \"column\");\r\n        this._renderArea($col2, \"data\")\r\n    },\r\n    _renderLayout2: function($container) {\r\n        $container.addClass(\"dx-layout-2\");\r\n        var $row1 = $(DIV).addClass(\"dx-row\").appendTo($container);\r\n        this._renderArea($row1, \"all\");\r\n        var $row2 = $(DIV).addClass(\"dx-row\").appendTo($container);\r\n        var $col1 = $(DIV).addClass(\"dx-col\").appendTo($row2);\r\n        var $col2 = $(DIV).addClass(\"dx-col\").appendTo($row2);\r\n        this._renderArea($col1, \"filter\");\r\n        this._renderArea($col1, \"row\");\r\n        this._renderArea($col2, \"column\");\r\n        this._renderArea($col2, \"data\")\r\n    },\r\n    _initMarkup: function() {\r\n        var $element = this.$element();\r\n        var $container = $(DIV).addClass(FIELDCHOOSER_CONTAINER_CLASS).appendTo($element);\r\n        var layout = this.option(\"layout\");\r\n        this.callBase();\r\n        $element.addClass(FIELDCHOOSER_CLASS).addClass(FIELDS_CONTAINER_CLASS);\r\n        this._dataChangedHandlers = [];\r\n        var dataSource = this._dataSource;\r\n        var currentState = \"instantly\" !== this.option(\"applyChangesMode\") && dataSource && dataSource.state();\r\n        currentState && this.option(\"state\") && dataSource.state(this.option(\"state\"), true);\r\n        if (0 === layout) {\r\n            this._renderLayout0($container)\r\n        } else if (1 === layout) {\r\n            this._renderLayout1($container)\r\n        } else {\r\n            this._renderLayout2($container)\r\n        }\r\n        currentState && dataSource.state(currentState, true)\r\n    },\r\n    _renderContentImpl: function() {\r\n        this.callBase();\r\n        this.renderSortable();\r\n        this._renderContextMenu();\r\n        this.updateDimensions()\r\n    },\r\n    _fireContentReadyAction: function() {\r\n        if (!this._dataSource || !this._dataSource.isLoading()) {\r\n            this.callBase()\r\n        }\r\n    },\r\n    _getContextMenuArgs: function(dxEvent) {\r\n        var targetFieldElement = $(dxEvent.target).closest(\".dx-area-field\");\r\n        var targetGroupElement = $(dxEvent.target).closest(\".dx-area-fields\");\r\n        var field;\r\n        var area;\r\n        if (targetFieldElement.length) {\r\n            var fieldCopy = targetFieldElement.data(\"field\");\r\n            if (fieldCopy) {\r\n                field = this.getDataSource().field(fieldCopy.index) || fieldCopy\r\n            }\r\n        }\r\n        if (targetGroupElement.length) {\r\n            area = targetGroupElement.attr(\"group\")\r\n        }\r\n        return {\r\n            event: dxEvent,\r\n            field: field,\r\n            area: area,\r\n            items: []\r\n        }\r\n    },\r\n    _renderContextMenu: function() {\r\n        var that = this;\r\n        var $container = that.$element();\r\n        if (that._contextMenu) {\r\n            that._contextMenu.$element().remove()\r\n        }\r\n        that._contextMenu = that._createComponent($(DIV).appendTo($container), ContextMenu, {\r\n            onPositioning: function(actionArgs) {\r\n                var event = actionArgs.event;\r\n                if (!event) {\r\n                    return\r\n                }\r\n                var args = that._getContextMenuArgs(event);\r\n                that._trigger(\"onContextMenuPreparing\", args);\r\n                if (args.items && args.items.length) {\r\n                    actionArgs.component.option(\"items\", args.items)\r\n                } else {\r\n                    actionArgs.cancel = true\r\n                }\r\n            },\r\n            target: $container,\r\n            onItemClick: function(params) {\r\n                params.itemData.onItemClick && params.itemData.onItemClick(params)\r\n            },\r\n            cssClass: \"dx-pivotgridfieldchooser-context-menu\"\r\n        })\r\n    },\r\n    _createTreeItems: function(fields, groupFieldNames, path) {\r\n        var that = this;\r\n        var isMeasure;\r\n        var resultItems = [];\r\n        var groupedItems = [];\r\n        var groupFieldName = groupFieldNames[0];\r\n        var fieldsByGroup = {};\r\n        if (!groupFieldName) {\r\n            each(fields, (function(index, field) {\r\n                var icon;\r\n                if (true === field.isMeasure) {\r\n                    icon = \"measure\"\r\n                }\r\n                if (false === field.isMeasure) {\r\n                    icon = field.groupName ? \"hierarchy\" : \"dimension\"\r\n                }\r\n                resultItems.push({\r\n                    index: field.index,\r\n                    field: field,\r\n                    key: field.dataField,\r\n                    selected: isDefined(field.area),\r\n                    text: field.caption || field.dataField,\r\n                    icon: icon,\r\n                    isMeasure: field.isMeasure,\r\n                    isDefault: field.isDefault\r\n                })\r\n            }))\r\n        } else {\r\n            each(fields, (function(index, field) {\r\n                var groupName = field[groupFieldName] || \"\";\r\n                fieldsByGroup[groupName] = fieldsByGroup[groupName] || [];\r\n                fieldsByGroup[groupName].push(field);\r\n                if (void 0 === isMeasure) {\r\n                    isMeasure = true\r\n                }\r\n                isMeasure = isMeasure && true === field.isMeasure\r\n            }));\r\n            each(fieldsByGroup, (function(groupName, fields) {\r\n                var currentPath = path ? path + \".\" + groupName : groupName;\r\n                var items = that._createTreeItems(fields, groupFieldNames.slice(1), currentPath);\r\n                if (groupName) {\r\n                    groupedItems.push({\r\n                        key: groupName,\r\n                        text: groupName,\r\n                        path: currentPath,\r\n                        isMeasure: items.isMeasure,\r\n                        expanded: that._expandedPaths.includes(currentPath),\r\n                        items: items\r\n                    })\r\n                } else {\r\n                    resultItems = items\r\n                }\r\n            }));\r\n            resultItems = groupedItems.concat(resultItems);\r\n            resultItems.isMeasure = isMeasure\r\n        }\r\n        return resultItems\r\n    },\r\n    _createFieldsDataSource: function(dataSource) {\r\n        var fields = dataSource && dataSource.fields() || [];\r\n        fields = fields.filter(field => false !== field.visible && !isDefined(field.groupIndex));\r\n        var treeItems = this._createTreeItems(fields, [\"dimension\", \"displayFolder\"]);\r\n        foreachDataLevel(treeItems, (function(items) {\r\n            items.sort(compareItems)\r\n        }), 0, \"items\");\r\n        return treeItems\r\n    },\r\n    _renderFieldsTreeView: function(container) {\r\n        var that = this;\r\n        var dataSource = that._dataSource;\r\n        var treeView = that._createComponent(container, TreeView, {\r\n            dataSource: that._createFieldsDataSource(dataSource),\r\n            showCheckBoxesMode: \"normal\",\r\n            expandNodesRecursive: false,\r\n            searchEnabled: that.option(\"allowSearch\"),\r\n            searchTimeout: that.option(\"searchTimeout\"),\r\n            useNativeScrolling: false,\r\n            itemTemplate: function(itemData, itemIndex, itemElement) {\r\n                var $item = $(\"<div>\").toggleClass(\"dx-area-field\", !itemData.items).attr(SortableConst.attrs.treeViewItem, true).data(\"field\", itemData.field).appendTo(itemElement);\r\n                if (itemData.icon) {\r\n                    getImageContainer(itemData.icon).appendTo($item)\r\n                }\r\n                $(\"<span>\").text(itemData.text).appendTo($item)\r\n            },\r\n            onItemCollapsed: function(e) {\r\n                var index = that._expandedPaths.indexOf(e.itemData.path);\r\n                if (index >= 0) {\r\n                    that._expandedPaths.splice(index, 1)\r\n                }\r\n            },\r\n            onItemExpanded: function(e) {\r\n                var index = that._expandedPaths.indexOf(e.itemData.path);\r\n                if (index < 0) {\r\n                    that._expandedPaths.push(e.itemData.path)\r\n                }\r\n            },\r\n            onItemSelectionChanged: function(e) {\r\n                var data = e.itemData;\r\n                var field;\r\n                var fields;\r\n                var needSelectDefaultItem = true;\r\n                var area;\r\n                if (data.items) {\r\n                    if (data.selected) {\r\n                        treeView.unselectItem(data);\r\n                        return\r\n                    }\r\n                    that._processDemandState(() => {\r\n                        fields = getDimensionFields(data, dataSource.fields());\r\n                        for (var i = 0; i < fields.length; i++) {\r\n                            if (fields[i].area) {\r\n                                needSelectDefaultItem = false;\r\n                                break\r\n                            }\r\n                        }\r\n                    });\r\n                    if (needSelectDefaultItem) {\r\n                        var item = getFirstItem(data, (function(item) {\r\n                            return item.isDefault\r\n                        })) || getFirstItem(data, (function(item) {\r\n                            return isDefined(item.index)\r\n                        }));\r\n                        item && treeView.selectItem(item);\r\n                        return\r\n                    }\r\n                } else {\r\n                    field = dataSource.fields()[data.index];\r\n                    if (data.selected) {\r\n                        area = field.isMeasure ? \"data\" : \"column\"\r\n                    }\r\n                    if (field) {\r\n                        fields = [field]\r\n                    }\r\n                }\r\n                that._applyChanges(fields, {\r\n                    area: area,\r\n                    areaIndex: void 0\r\n                })\r\n            }\r\n        });\r\n        that._dataChangedHandlers.push((function() {\r\n            var scrollable = getScrollable(container);\r\n            var scrollTop = scrollable ? scrollable.scrollTop() : 0;\r\n            treeView.option({\r\n                dataSource: that._createFieldsDataSource(dataSource)\r\n            });\r\n            scrollable = getScrollable(container);\r\n            if (scrollable) {\r\n                scrollable.scrollTo({\r\n                    y: scrollTop\r\n                });\r\n                scrollable.update()\r\n            }\r\n        }))\r\n    },\r\n    _renderAreaFields: function($container, area) {\r\n        var that = this;\r\n        var dataSource = that._dataSource;\r\n        var fields = dataSource ? extend(true, [], dataSource.getAreaFields(area, true)) : [];\r\n        $container.empty();\r\n        each(fields, (function(_, field) {\r\n            if (false !== field.visible) {\r\n                that.renderField(field, true).appendTo($container)\r\n            }\r\n        }))\r\n    },\r\n    _renderArea: function(container, area) {\r\n        var that = this;\r\n        var $areaContainer = $(DIV).addClass(\"dx-area\").appendTo(container);\r\n        var $fieldsHeaderContainer = $(DIV).addClass(\"dx-area-fields-header\").appendTo($areaContainer);\r\n        var caption = that.option(\"texts.\" + area + \"Fields\");\r\n        var $fieldsContent;\r\n        var render;\r\n        $(\"<span>\").addClass(\"dx-area-icon\").addClass(\"dx-area-icon-\" + area).appendTo($fieldsHeaderContainer);\r\n        $(\"<span>\").html(\"&nbsp;\").appendTo($fieldsHeaderContainer);\r\n        $(\"<span>\").addClass(\"dx-area-caption\").text(caption).appendTo($fieldsHeaderContainer);\r\n        var $fieldsContainer = $(DIV).addClass(\"dx-area-fields\").addClass(AREA_DRAG_CLASS).appendTo($areaContainer);\r\n        if (\"all\" !== area) {\r\n            $fieldsContainer.attr(\"group\", area).attr(\"allow-scrolling\", true);\r\n            $fieldsContent = $(DIV).addClass(\"dx-area-field-container\").appendTo($fieldsContainer);\r\n            render = function() {\r\n                that._renderAreaFields($fieldsContent, area)\r\n            };\r\n            that._dataChangedHandlers.push(render);\r\n            render();\r\n            $fieldsContainer.dxScrollable({\r\n                useNative: false\r\n            })\r\n        } else {\r\n            $areaContainer.addClass(\"dx-all-fields\");\r\n            $fieldsContainer.addClass(\"dx-treeview-border-visible\");\r\n            that._renderFieldsTreeView($fieldsContainer)\r\n        }\r\n    },\r\n    _getSortableOptions: function() {\r\n        return {}\r\n    },\r\n    _adjustSortableOnChangedArgs: function() {},\r\n    resetTreeView: function() {\r\n        var treeView = this.$element().find(\".dx-treeview\").dxTreeView(\"instance\");\r\n        if (treeView) {\r\n            treeView.option(\"searchValue\", \"\");\r\n            treeView.collapseAll()\r\n        }\r\n    },\r\n    applyChanges: function() {\r\n        var state = this.option(\"state\");\r\n        if (isDefined(state)) {\r\n            this._dataSource.state(state)\r\n        }\r\n    },\r\n    cancelChanges: function() {\r\n        var dataSource = this._dataSource;\r\n        if (!dataSource.isLoading()) {\r\n            this.option(\"state\", dataSource.state());\r\n            return true\r\n        }\r\n        return false\r\n    },\r\n    getDataSource: function() {\r\n        return this._dataSource\r\n    },\r\n    updateDimensions: function() {\r\n        var $scrollableElements = this.$element().find(\".dx-area .dx-scrollable\");\r\n        $scrollableElements.dxScrollable(\"update\")\r\n    },\r\n    _visibilityChanged: function(visible) {\r\n        if (visible && hasWindow) {\r\n            this.updateDimensions()\r\n        }\r\n    }\r\n});\r\nregisterComponent(\"dxPivotGridFieldChooser\", FieldChooser);\r\nexport default FieldChooser;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}
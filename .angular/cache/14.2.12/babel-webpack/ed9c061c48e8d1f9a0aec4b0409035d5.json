{"ast":null,"code":"/**\r\n * DevExtreme (esm/viz/core/renderers/renderer.js)\r\n * Version: 22.2.4\r\n * Build date: Thu Jan 19 2023\r\n *\r\n * Copyright (c) 2012 - 2023 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../../../core/renderer\";\nimport domAdapter from \"../../../core/dom_adapter\";\nimport { getWindow } from \"../../../core/utils/window\";\nimport callOnce from \"../../../core/utils/call_once\";\nimport eventsEngine from \"../../../events/core/events_engine\";\nimport { getSvgMarkup } from \"../../../core/utils/svg\";\nimport { AnimationController } from \"./animation\";\nimport { normalizeBBox, rotateBBox, normalizeEnum } from \"../utils\";\nimport { isDefined } from \"../../../core/utils/type\";\nvar window = getWindow();\nvar {\n  max: max,\n  min: min,\n  floor: floor,\n  round: round,\n  sin: sin,\n  cos: cos,\n  abs: abs,\n  PI: PI\n} = Math;\nvar PI_DIV_180 = PI / 180;\nvar SHARPING_CORRECTION = .5;\nvar ARC_COORD_PREC = 5;\nvar pxAddingExceptions = {\n  \"column-count\": true,\n  \"fill-opacity\": true,\n  \"flex-grow\": true,\n  \"flex-shrink\": true,\n  \"font-weight\": true,\n  \"line-height\": true,\n  opacity: true,\n  order: true,\n  orphans: true,\n  widows: true,\n  \"z-index\": true,\n  zoom: true\n};\nvar KEY_TEXT = \"text\";\nvar KEY_STROKE = \"stroke\";\nvar KEY_STROKE_WIDTH = \"stroke-width\";\nvar KEY_STROKE_OPACITY = \"stroke-opacity\";\nvar KEY_FONT_SIZE = \"font-size\";\nvar KEY_FONT_STYLE = \"font-style\";\nvar KEY_FONT_WEIGHT = \"font-weight\";\nvar KEY_TEXT_DECORATION = \"text-decoration\";\nvar KEY_TEXTS_ALIGNMENT = \"textsAlignment\";\nvar NONE = \"none\";\nvar DEFAULT_FONT_SIZE = 12;\nvar ELLIPSIS = \"...\";\n\nvar objectCreate = function () {\n  if (!Object.create) {\n    return function (proto) {\n      var F = function () {};\n\n      F.prototype = proto;\n      return new F();\n    };\n  } else {\n    return function (proto) {\n      return Object.create(proto);\n    };\n  }\n}();\n\nvar DEFAULTS = {\n  scaleX: 1,\n  scaleY: 1,\n  \"pointer-events\": null\n};\nvar getBackup = callOnce(function () {\n  var backupContainer = domAdapter.createElement(\"div\");\n  backupContainer.style.left = \"-9999px\";\n  backupContainer.style.position = \"absolute\";\n  return {\n    backupContainer: backupContainer,\n    backupCounter: 0\n  };\n});\n\nfunction backupRoot(root) {\n  if (0 === getBackup().backupCounter) {\n    domAdapter.getBody().appendChild(getBackup().backupContainer);\n  }\n\n  ++getBackup().backupCounter;\n  root.append({\n    element: getBackup().backupContainer\n  });\n}\n\nfunction restoreRoot(root, container) {\n  root.append({\n    element: container\n  });\n  --getBackup().backupCounter;\n\n  if (0 === getBackup().backupCounter) {\n    domAdapter.getBody().removeChild(getBackup().backupContainer);\n  }\n}\n\nvar getNextDefsSvgId = function () {\n  var numDefsSvgElements = 1;\n  return function () {\n    return \"DevExpress_\" + numDefsSvgElements++;\n  };\n}();\n\nfunction isObjectArgument(value) {\n  return value && \"string\" !== typeof value;\n}\n\nfunction createElement(tagName) {\n  return domAdapter.createElementNS(\"http://www.w3.org/2000/svg\", tagName);\n}\n\nexport function getFuncIri(id, pathModified) {\n  return null !== id ? \"url(\" + (pathModified ? window.location.href.split(\"#\")[0] : \"\") + \"#\" + id + \")\" : id;\n}\n\nfunction extend(target, source) {\n  var key;\n\n  for (key in source) {\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction roundValue(value, exp) {\n  value = value.toString().split(\"e\");\n  value = round(+(value[0] + \"e\" + (value[1] ? +value[1] + exp : exp)));\n  value = value.toString().split(\"e\");\n  return +(value[0] + \"e\" + (value[1] ? +value[1] - exp : -exp));\n}\n\nvar preserveAspectRatioMap = {\n  full: NONE,\n  lefttop: \"xMinYMin\",\n  leftcenter: \"xMinYMid\",\n  leftbottom: \"xMinYMax\",\n  centertop: \"xMidYMin\",\n  center: \"xMidYMid\",\n  centerbottom: \"xMidYMax\",\n  righttop: \"xMaxYMin\",\n  rightcenter: \"xMaxYMid\",\n  rightbottom: \"xMaxYMax\"\n};\nexport function processHatchingAttrs(element, attrs) {\n  if (attrs.hatching && \"none\" !== normalizeEnum(attrs.hatching.direction)) {\n    attrs = extend({}, attrs);\n    attrs.fill = element._hatching = element.renderer.lockHatching(attrs.fill, attrs.hatching, element._hatching);\n    delete attrs.hatching;\n  } else if (element._hatching) {\n    element.renderer.releaseHatching(element._hatching);\n    element._hatching = null;\n  }\n\n  return attrs;\n}\n\nfunction normalizeArcParams(x, y, innerR, outerR, startAngle, endAngle) {\n  var isCircle;\n  var noArc = true;\n  var angleDiff = roundValue(endAngle, 3) - roundValue(startAngle, 3);\n\n  if (angleDiff) {\n    if (abs(angleDiff) % 360 === 0) {\n      startAngle = 0;\n      endAngle = 360;\n      isCircle = true;\n      endAngle -= .01;\n    }\n\n    if (startAngle > 360) {\n      startAngle %= 360;\n    }\n\n    if (endAngle > 360) {\n      endAngle %= 360;\n    }\n\n    if (startAngle > endAngle) {\n      startAngle -= 360;\n    }\n\n    noArc = false;\n  }\n\n  startAngle *= PI_DIV_180;\n  endAngle *= PI_DIV_180;\n  return [x, y, min(outerR, innerR), max(outerR, innerR), cos(startAngle), sin(startAngle), cos(endAngle), sin(endAngle), isCircle, floor(abs(endAngle - startAngle) / PI) % 2 ? \"1\" : \"0\", noArc];\n}\n\nvar buildArcPath = function (x, y, innerR, outerR, startAngleCos, startAngleSin, endAngleCos, endAngleSin, isCircle, longFlag) {\n  return [\"M\", (x + outerR * startAngleCos).toFixed(ARC_COORD_PREC), (y - outerR * startAngleSin).toFixed(ARC_COORD_PREC), \"A\", outerR.toFixed(ARC_COORD_PREC), outerR.toFixed(ARC_COORD_PREC), 0, longFlag, 0, (x + outerR * endAngleCos).toFixed(ARC_COORD_PREC), (y - outerR * endAngleSin).toFixed(ARC_COORD_PREC), isCircle ? \"M\" : \"L\", (x + innerR * endAngleCos).toFixed(5), (y - innerR * endAngleSin).toFixed(ARC_COORD_PREC), \"A\", innerR.toFixed(ARC_COORD_PREC), innerR.toFixed(ARC_COORD_PREC), 0, longFlag, 1, (x + innerR * startAngleCos).toFixed(ARC_COORD_PREC), (y - innerR * startAngleSin).toFixed(ARC_COORD_PREC), \"Z\"].join(\" \");\n};\n\nfunction buildPathSegments(points, type) {\n  var list = [[\"M\", 0, 0]];\n\n  switch (type) {\n    case \"line\":\n      list = buildLineSegments(points);\n      break;\n\n    case \"area\":\n      list = buildLineSegments(points, true);\n      break;\n\n    case \"bezier\":\n      list = buildCurveSegments(points);\n      break;\n\n    case \"bezierarea\":\n      list = buildCurveSegments(points, true);\n  }\n\n  return list;\n}\n\nfunction buildLineSegments(points, close) {\n  return buildSegments(points, buildSimpleLineSegment, close);\n}\n\nfunction buildCurveSegments(points, close) {\n  return buildSegments(points, buildSimpleCurveSegment, close);\n}\n\nfunction buildSegments(points, buildSimpleSegment, close) {\n  var _points$;\n\n  var i;\n  var ii;\n  var list = [];\n\n  if (null !== (_points$ = points[0]) && void 0 !== _points$ && _points$.length) {\n    for (i = 0, ii = points.length; i < ii; ++i) {\n      buildSimpleSegment(points[i], close, list);\n    }\n  } else {\n    buildSimpleSegment(points, close, list);\n  }\n\n  return list;\n}\n\nfunction buildSimpleLineSegment(points, close, list) {\n  var i = 0;\n  var k0 = list.length;\n  var k = k0;\n  var ii = (points || []).length;\n\n  if (ii) {\n    if (void 0 !== points[0].x) {\n      for (; i < ii;) {\n        list[k++] = [\"L\", points[i].x, points[i++].y];\n      }\n    } else {\n      for (; i < ii;) {\n        list[k++] = [\"L\", points[i++], points[i++]];\n      }\n    }\n\n    list[k0][0] = \"M\";\n  } else {\n    list[k] = [\"M\", 0, 0];\n  }\n\n  close && list.push([\"Z\"]);\n  return list;\n}\n\nfunction buildSimpleCurveSegment(points, close, list) {\n  var i;\n  var k = list.length;\n  var ii = (points || []).length;\n\n  if (ii) {\n    if (void 0 !== points[0].x) {\n      list[k++] = [\"M\", points[0].x, points[0].y];\n\n      for (i = 1; i < ii;) {\n        list[k++] = [\"C\", points[i].x, points[i++].y, points[i].x, points[i++].y, points[i].x, points[i++].y];\n      }\n    } else {\n      list[k++] = [\"M\", points[0], points[1]];\n\n      for (i = 2; i < ii;) {\n        list[k++] = [\"C\", points[i++], points[i++], points[i++], points[i++], points[i++], points[i++]];\n      }\n    }\n  } else {\n    list[k] = [\"M\", 0, 0];\n  }\n\n  close && list.push([\"Z\"]);\n  return list;\n}\n\nfunction combinePathParam(segments) {\n  var d = [];\n  var k = 0;\n  var i;\n  var ii = segments.length;\n  var segment;\n  var j;\n  var jj;\n\n  for (i = 0; i < ii; ++i) {\n    segment = segments[i];\n\n    for (j = 0, jj = segment.length; j < jj; ++j) {\n      d[k++] = segment[j];\n    }\n  }\n\n  return d.join(\" \");\n}\n\nfunction compensateSegments(oldSegments, newSegments, type) {\n  var oldLength = oldSegments.length;\n  var newLength = newSegments.length;\n  var i;\n  var originalNewSegments;\n  var makeEqualSegments = -1 !== type.indexOf(\"area\") ? makeEqualAreaSegments : makeEqualLineSegments;\n\n  if (0 === oldLength) {\n    for (i = 0; i < newLength; i++) {\n      oldSegments.push(newSegments[i].slice(0));\n    }\n  } else if (oldLength < newLength) {\n    makeEqualSegments(oldSegments, newSegments, type);\n  } else if (oldLength > newLength) {\n    originalNewSegments = newSegments.slice(0);\n    makeEqualSegments(newSegments, oldSegments, type);\n  }\n\n  return originalNewSegments;\n}\n\nfunction prepareConstSegment(constSeg, type) {\n  var x = constSeg[constSeg.length - 2];\n  var y = constSeg[constSeg.length - 1];\n\n  switch (type) {\n    case \"line\":\n    case \"area\":\n      constSeg[0] = \"L\";\n      break;\n\n    case \"bezier\":\n    case \"bezierarea\":\n      constSeg[0] = \"C\";\n      constSeg[1] = constSeg[3] = constSeg[5] = x;\n      constSeg[2] = constSeg[4] = constSeg[6] = y;\n  }\n}\n\nfunction makeEqualLineSegments(short, long, type) {\n  var constSeg = short[short.length - 1].slice();\n  var i = short.length;\n  prepareConstSegment(constSeg, type);\n\n  for (; i < long.length; i++) {\n    short[i] = constSeg.slice(0);\n  }\n}\n\nfunction makeEqualAreaSegments(short, long, type) {\n  var i;\n  var head;\n  var shortLength = short.length;\n  var longLength = long.length;\n  var constsSeg1;\n  var constsSeg2;\n\n  if ((shortLength - 1) % 2 === 0 && (longLength - 1) % 2 === 0) {\n    i = (shortLength - 1) / 2 - 1;\n    head = short.slice(0, i + 1);\n    constsSeg1 = head[head.length - 1].slice(0);\n    constsSeg2 = short.slice(i + 1)[0].slice(0);\n    prepareConstSegment(constsSeg1, type);\n    prepareConstSegment(constsSeg2, type);\n\n    for (var j = i; j < (longLength - 1) / 2 - 1; j++) {\n      short.splice(j + 1, 0, constsSeg1);\n      short.splice(j + 3, 0, constsSeg2);\n    }\n  }\n}\n\nfunction baseCss(that, styles) {\n  var elemStyles = that._styles;\n  var key;\n  var value;\n  styles = styles || {};\n\n  for (key in styles) {\n    value = styles[key];\n\n    if (isDefined(value)) {\n      value += \"number\" === typeof value && !pxAddingExceptions[key] ? \"px\" : \"\";\n      elemStyles[key] = \"\" !== value ? value : null;\n    }\n  }\n\n  for (key in elemStyles) {\n    value = elemStyles[key];\n\n    if (value) {\n      that.element.style[key] = value;\n    } else if (null === value) {\n      that.element.style[key] = \"\";\n    }\n  }\n\n  return that;\n}\n\nfunction fixFuncIri(wrapper, attribute) {\n  var element = wrapper.element;\n  var id = wrapper.attr(attribute);\n\n  if (id && -1 !== id.indexOf(\"DevExpress\")) {\n    element.removeAttribute(attribute);\n    element.setAttribute(attribute, getFuncIri(id, wrapper.renderer.pathModified));\n  }\n}\n\nfunction baseAttr(that, attrs) {\n  attrs = attrs || {};\n  var settings = that._settings;\n  var attributes = {};\n  var key;\n  var value;\n  var elem = that.element;\n  var renderer = that.renderer;\n  var rtl = renderer.rtl;\n  var hasTransformations;\n  var recalculateDashStyle;\n  var sw;\n  var i;\n\n  if (!isObjectArgument(attrs)) {\n    if (attrs in settings) {\n      return settings[attrs];\n    }\n\n    if (attrs in DEFAULTS) {\n      return DEFAULTS[attrs];\n    }\n\n    return 0;\n  }\n\n  extend(attributes, attrs);\n\n  for (key in attributes) {\n    value = attributes[key];\n\n    if (void 0 === value) {\n      continue;\n    }\n\n    settings[key] = value;\n\n    if (\"align\" === key) {\n      key = \"text-anchor\";\n      value = {\n        left: rtl ? \"end\" : \"start\",\n        center: \"middle\",\n        right: rtl ? \"start\" : \"end\"\n      }[value] || null;\n    } else if (\"dashStyle\" === key) {\n      recalculateDashStyle = true;\n      continue;\n    } else if (key === KEY_STROKE_WIDTH) {\n      recalculateDashStyle = true;\n    } else if (value && (\"fill\" === key || \"clip-path\" === key || \"filter\" === key) && 0 === value.indexOf(\"DevExpress\")) {\n      that._addFixIRICallback();\n\n      value = getFuncIri(value, renderer.pathModified);\n    } else if (/^(translate(X|Y)|rotate[XY]?|scale(X|Y)|sharp|sharpDirection)$/i.test(key)) {\n      hasTransformations = true;\n      continue;\n    } else if (/^(x|y|d)$/i.test(key)) {\n      hasTransformations = true;\n    }\n\n    if (null === value) {\n      elem.removeAttribute(key);\n    } else {\n      elem.setAttribute(key, value);\n    }\n  }\n\n  if (recalculateDashStyle && \"dashStyle\" in settings) {\n    value = settings.dashStyle;\n    sw = (\"_originalSW\" in that ? that._originalSW : settings[KEY_STROKE_WIDTH]) || 1;\n    key = \"stroke-dasharray\";\n    value = null === value ? \"\" : normalizeEnum(value);\n\n    if (\"\" === value || \"solid\" === value || value === NONE) {\n      that.element.removeAttribute(key);\n    } else {\n      value = value.replace(/longdash/g, \"8,3,\").replace(/dash/g, \"4,3,\").replace(/dot/g, \"1,3,\").replace(/,$/, \"\").split(\",\");\n      i = value.length;\n\n      while (i--) {\n        value[i] = parseInt(value[i]) * sw;\n      }\n\n      that.element.setAttribute(key, value.join(\",\"));\n    }\n  }\n\n  if (hasTransformations) {\n    that._applyTransformation();\n  }\n\n  return that;\n}\n\nfunction pathAttr(attrs) {\n  var segments;\n\n  if (isObjectArgument(attrs)) {\n    attrs = extend({}, attrs);\n    segments = attrs.segments;\n\n    if (\"points\" in attrs) {\n      segments = buildPathSegments(attrs.points, this.type);\n      delete attrs.points;\n    }\n\n    if (segments) {\n      attrs.d = combinePathParam(segments);\n      this.segments = segments;\n      delete attrs.segments;\n    }\n  }\n\n  return baseAttr(this, attrs);\n}\n\nfunction arcAttr(attrs) {\n  var settings = this._settings;\n  var x;\n  var y;\n  var innerRadius;\n  var outerRadius;\n  var startAngle;\n  var endAngle;\n\n  if (isObjectArgument(attrs)) {\n    attrs = extend({}, attrs);\n\n    if (\"x\" in attrs || \"y\" in attrs || \"innerRadius\" in attrs || \"outerRadius\" in attrs || \"startAngle\" in attrs || \"endAngle\" in attrs) {\n      settings.x = x = \"x\" in attrs ? attrs.x : settings.x;\n      delete attrs.x;\n      settings.y = y = \"y\" in attrs ? attrs.y : settings.y;\n      delete attrs.y;\n      settings.innerRadius = innerRadius = \"innerRadius\" in attrs ? attrs.innerRadius : settings.innerRadius;\n      delete attrs.innerRadius;\n      settings.outerRadius = outerRadius = \"outerRadius\" in attrs ? attrs.outerRadius : settings.outerRadius;\n      delete attrs.outerRadius;\n      settings.startAngle = startAngle = \"startAngle\" in attrs ? attrs.startAngle : settings.startAngle;\n      delete attrs.startAngle;\n      settings.endAngle = endAngle = \"endAngle\" in attrs ? attrs.endAngle : settings.endAngle;\n      delete attrs.endAngle;\n      attrs.d = buildArcPath.apply(null, normalizeArcParams(x, y, innerRadius, outerRadius, startAngle, endAngle));\n    }\n  }\n\n  return baseAttr(this, attrs);\n}\n\nfunction rectAttr(attrs) {\n  var x;\n  var y;\n  var width;\n  var height;\n  var sw;\n  var maxSW;\n  var newSW;\n\n  if (isObjectArgument(attrs)) {\n    attrs = extend({}, attrs);\n\n    if (void 0 !== attrs.x || void 0 !== attrs.y || void 0 !== attrs.width || void 0 !== attrs.height || void 0 !== attrs[KEY_STROKE_WIDTH]) {\n      void 0 !== attrs.x ? x = this._originalX = attrs.x : x = this._originalX || 0;\n      void 0 !== attrs.y ? y = this._originalY = attrs.y : y = this._originalY || 0;\n      void 0 !== attrs.width ? width = this._originalWidth = attrs.width : width = this._originalWidth || 0;\n      void 0 !== attrs.height ? height = this._originalHeight = attrs.height : height = this._originalHeight || 0;\n      void 0 !== attrs[KEY_STROKE_WIDTH] ? sw = this._originalSW = attrs[KEY_STROKE_WIDTH] : sw = this._originalSW;\n      maxSW = ~~((width < height ? width : height) / 2);\n      newSW = (sw || 0) < maxSW ? sw || 0 : maxSW;\n      attrs.x = x + newSW / 2;\n      attrs.y = y + newSW / 2;\n      attrs.width = width - newSW;\n      attrs.height = height - newSW;\n      ((sw || 0) !== newSW || !(0 === newSW && void 0 === sw)) && (attrs[KEY_STROKE_WIDTH] = newSW);\n    }\n\n    if (\"sharp\" in attrs) {\n      delete attrs.sharp;\n    }\n  }\n\n  return baseAttr(this, attrs);\n}\n\nfunction textAttr(attrs) {\n  var isResetRequired;\n\n  if (!isObjectArgument(attrs)) {\n    return baseAttr(this, attrs);\n  }\n\n  attrs = extend({}, attrs);\n  var settings = this._settings;\n  var wasStroked = isDefined(settings[KEY_STROKE]) && isDefined(settings[KEY_STROKE_WIDTH]);\n\n  if (void 0 !== attrs[KEY_TEXT]) {\n    settings[KEY_TEXT] = attrs[KEY_TEXT];\n    delete attrs[KEY_TEXT];\n    isResetRequired = true;\n  }\n\n  if (void 0 !== attrs[KEY_STROKE]) {\n    settings[KEY_STROKE] = attrs[KEY_STROKE];\n    delete attrs[KEY_STROKE];\n  }\n\n  if (void 0 !== attrs[KEY_STROKE_WIDTH]) {\n    settings[KEY_STROKE_WIDTH] = attrs[KEY_STROKE_WIDTH];\n    delete attrs[KEY_STROKE_WIDTH];\n  }\n\n  if (void 0 !== attrs[KEY_STROKE_OPACITY]) {\n    settings[KEY_STROKE_OPACITY] = attrs[KEY_STROKE_OPACITY];\n    delete attrs[KEY_STROKE_OPACITY];\n  }\n\n  if (void 0 !== attrs[KEY_TEXTS_ALIGNMENT]) {\n    alignTextNodes(this, attrs[KEY_TEXTS_ALIGNMENT]);\n    delete attrs[KEY_TEXTS_ALIGNMENT];\n  }\n\n  var isStroked = isDefined(settings[KEY_STROKE]) && isDefined(settings[KEY_STROKE_WIDTH]);\n  baseAttr(this, attrs);\n  isResetRequired = isResetRequired || isStroked !== wasStroked && settings[KEY_TEXT];\n\n  if (isResetRequired) {\n    createTextNodes(this, settings.text, isStroked);\n    this._hasEllipsis = false;\n  }\n\n  if (isResetRequired || void 0 !== attrs.x || void 0 !== attrs.y) {\n    locateTextNodes(this);\n  }\n\n  if (isStroked) {\n    strokeTextNodes(this);\n  }\n\n  return this;\n}\n\nfunction textCss(styles) {\n  styles = styles || {};\n  baseCss(this, styles);\n\n  if (KEY_FONT_SIZE in styles) {\n    locateTextNodes(this);\n  }\n\n  return this;\n}\n\nfunction orderHtmlTree(list, line, node, parentStyle, parentClassName) {\n  var style;\n  var realStyle;\n  var i;\n  var ii;\n  var nodes;\n\n  if (void 0 !== node.wholeText) {\n    list.push({\n      value: node.wholeText,\n      style: parentStyle,\n      className: parentClassName,\n      line: line,\n      height: parentStyle[KEY_FONT_SIZE] || 0\n    });\n  } else if (\"BR\" === node.tagName) {\n    ++line;\n  } else if (domAdapter.isElementNode(node)) {\n    extend(style = {}, parentStyle);\n\n    switch (node.tagName) {\n      case \"B\":\n      case \"STRONG\":\n        style[KEY_FONT_WEIGHT] = \"bold\";\n        break;\n\n      case \"I\":\n      case \"EM\":\n        style[KEY_FONT_STYLE] = \"italic\";\n        break;\n\n      case \"U\":\n        style[KEY_TEXT_DECORATION] = \"underline\";\n    }\n\n    realStyle = node.style;\n    realStyle.color && (style.fill = realStyle.color);\n    realStyle.fontSize && (style[KEY_FONT_SIZE] = realStyle.fontSize);\n    realStyle.fontStyle && (style[KEY_FONT_STYLE] = realStyle.fontStyle);\n    realStyle.fontWeight && (style[KEY_FONT_WEIGHT] = realStyle.fontWeight);\n    realStyle.textDecoration && (style[KEY_TEXT_DECORATION] = realStyle.textDecoration);\n\n    for (i = 0, nodes = node.childNodes, ii = nodes.length; i < ii; ++i) {\n      line = orderHtmlTree(list, line, nodes[i], style, node.className || parentClassName);\n    }\n  }\n\n  return line;\n}\n\nfunction adjustLineHeights(items) {\n  var i;\n  var ii;\n  var currentItem = items[0];\n  var item;\n\n  for (i = 1, ii = items.length; i < ii; ++i) {\n    item = items[i];\n\n    if (item.line === currentItem.line) {\n      currentItem.height = maxLengthFontSize(currentItem.height, item.height);\n      currentItem.inherits = currentItem.inherits || 0 === parseFloat(item.height);\n      item.height = NaN;\n    } else {\n      currentItem = item;\n    }\n  }\n}\n\nfunction removeExtraAttrs(html) {\n  var findStyleAndClassAttrs = /(style|class)\\s*=\\s*([\"'])(?:(?!\\2).)*\\2\\s?/gi;\n  return html.replace(/(?:(<[a-z0-9]+\\s*))([\\s\\S]*?)(>|\\/>)/gi, function (allTagAttrs, p1, p2, p3) {\n    p2 = (p2 && p2.match(findStyleAndClassAttrs) || []).map(function (str) {\n      return str;\n    }).join(\" \");\n    return p1 + p2 + p3;\n  });\n}\n\nfunction parseHTML(text) {\n  var items = [];\n  var div = domAdapter.createElement(\"div\");\n  div.innerHTML = text.replace(/\\r/g, \"\").replace(/\\n/g, \"<br/>\");\n  orderHtmlTree(items, 0, div, {}, \"\");\n  adjustLineHeights(items);\n  return items;\n}\n\nfunction parseMultiline(text) {\n  var texts = text.replace(/\\r/g, \"\").split(/\\n/g);\n  var i = 0;\n  var items = [];\n\n  for (; i < texts.length; i++) {\n    items.push({\n      value: texts[i].trim(),\n      height: 0,\n      line: i\n    });\n  }\n\n  return items;\n}\n\nfunction createTspans(items, element, fieldName) {\n  var i;\n  var ii;\n  var item;\n\n  for (i = 0, ii = items.length; i < ii; ++i) {\n    item = items[i];\n    item[fieldName] = createElement(\"tspan\");\n    item[fieldName].appendChild(domAdapter.createTextNode(item.value));\n    item.style && baseCss({\n      element: item[fieldName],\n      _styles: {}\n    }, item.style);\n    item.className && item[fieldName].setAttribute(\"class\", item.className);\n    element.appendChild(item[fieldName]);\n  }\n}\n\nfunction restoreText() {\n  if (this._hasEllipsis) {\n    this.attr({\n      text: this._settings.text\n    });\n  }\n}\n\nfunction applyEllipsis(maxWidth) {\n  var lines;\n  var hasEllipsis = false;\n  var i;\n  var ii;\n  var lineParts;\n  var j;\n  var jj;\n  var text;\n  restoreText.call(this);\n  var ellipsis = this.renderer.text(ELLIPSIS).attr(this._styles).append(this.renderer.root);\n  var ellipsisWidth = ellipsis.getBBox().width;\n\n  if (this._getElementBBox().width > maxWidth) {\n    if (maxWidth - ellipsisWidth < 0) {\n      maxWidth = 0;\n    } else {\n      maxWidth -= ellipsisWidth;\n    }\n\n    lines = prepareLines(this.element, this._texts, maxWidth);\n\n    for (i = 0, ii = lines.length; i < ii; ++i) {\n      lineParts = lines[i].parts;\n\n      if (1 === lines[i].commonLength) {\n        continue;\n      }\n\n      for (j = 0, jj = lineParts.length; j < jj; ++j) {\n        text = lineParts[j];\n\n        if (isDefined(text.endIndex)) {\n          setNewText(text, text.endIndex);\n          hasEllipsis = true;\n        } else if (text.startBox > maxWidth) {\n          removeTextSpan(text);\n        }\n      }\n    }\n  }\n\n  ellipsis.remove();\n  this._hasEllipsis = hasEllipsis;\n  return hasEllipsis;\n}\n\nfunction cloneAndRemoveAttrs(node) {\n  var clone;\n\n  if (node) {\n    clone = node.cloneNode();\n    clone.removeAttribute(\"y\");\n    clone.removeAttribute(\"x\");\n  }\n\n  return clone || node;\n}\n\nfunction detachTitleElements(element) {\n  var titleElements = domAdapter.querySelectorAll(element, \"title\");\n\n  for (var i = 0; i < titleElements.length; i++) {\n    element.removeChild(titleElements[i]);\n  }\n\n  return titleElements;\n}\n\nfunction detachAndStoreTitleElements(element) {\n  var titleElements = detachTitleElements(element);\n  return () => {\n    for (var i = 0; i < titleElements.length; i++) {\n      element.appendChild(titleElements[i]);\n    }\n  };\n}\n\nfunction setMaxSize(maxWidth, maxHeight) {\n  var options = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {};\n  var that = this;\n  var lines = [];\n  var textChanged = false;\n  var textIsEmpty = false;\n  var ellipsisMaxWidth = maxWidth;\n  restoreText.call(that);\n  var restoreTitleElement = detachAndStoreTitleElements(this.element);\n  var ellipsis = that.renderer.text(ELLIPSIS).attr(that._styles).append(that.renderer.root);\n  var ellipsisWidth = ellipsis.getBBox().width;\n\n  var {\n    width: width,\n    height: height\n  } = that._getElementBBox();\n\n  if ((width || height) && (width > maxWidth || maxHeight && height > maxHeight)) {\n    if (maxWidth - ellipsisWidth < 0) {\n      ellipsisMaxWidth = 0;\n    } else {\n      ellipsisMaxWidth -= ellipsisWidth;\n    }\n\n    lines = applyOverflowRules(that.element, that._texts, maxWidth, ellipsisMaxWidth, options);\n    lines = setMaxHeight(lines, ellipsisMaxWidth, options, maxHeight, parseFloat(this._getLineHeight()));\n    this._texts = lines.reduce((texts, line) => texts.concat(line.parts), []).filter(t => \"\" !== t.value).map(t => {\n      t.stroke && t.tspan.parentNode.appendChild(t.stroke);\n      return t;\n    }).map(t => {\n      t.tspan.parentNode.appendChild(t.tspan);\n      return t;\n    });\n    !this._texts.length && (this._texts = null);\n    textChanged = true;\n\n    if (this._texts) {\n      locateTextNodes(this);\n    } else {\n      this.element.textContent = \"\";\n      textIsEmpty = true;\n    }\n  }\n\n  ellipsis.remove();\n  that._hasEllipsis = textChanged;\n  restoreTitleElement();\n  return {\n    rowCount: lines.length,\n    textChanged: textChanged,\n    textIsEmpty: textIsEmpty\n  };\n}\n\nfunction getIndexForEllipsis(text, maxWidth, startBox, endBox) {\n  var k;\n  var kk;\n\n  if (startBox <= maxWidth && endBox > maxWidth) {\n    for (k = 1, kk = text.value.length; k <= kk; ++k) {\n      if (startBox + text.tspan.getSubStringLength(0, k) > maxWidth) {\n        return k - 1;\n      }\n    }\n  }\n}\n\nfunction getTextWidth(text) {\n  return text.value.length ? text.tspan.getSubStringLength(0, text.value.length) : 0;\n}\n\nfunction prepareLines(element, texts, maxWidth) {\n  var lines = [];\n  var i;\n  var ii;\n  var text;\n  var startBox;\n  var endBox;\n\n  if (texts) {\n    for (i = 0, ii = texts.length; i < ii; ++i) {\n      text = texts[i];\n\n      if (!lines[text.line]) {\n        text.startBox = startBox = 0;\n        lines.push({\n          commonLength: text.value.length,\n          parts: [text]\n        });\n      } else {\n        text.startBox = startBox;\n        lines[text.line].parts.push(text);\n        lines[text.line].commonLength += text.value.length;\n      }\n\n      endBox = startBox + text.tspan.getSubStringLength(0, text.value.length);\n      text.endIndex = getIndexForEllipsis(text, maxWidth, startBox, endBox);\n      startBox = endBox;\n    }\n  } else {\n    text = {\n      value: element.textContent,\n      tspan: element\n    };\n    text.startBox = startBox = 0;\n    endBox = startBox + getTextWidth(text);\n    text.endIndex = getIndexForEllipsis(text, maxWidth, startBox, endBox);\n    lines = [{\n      commonLength: element.textContent.length,\n      parts: [text]\n    }];\n  }\n\n  return lines;\n}\n\nfunction getSpaceBreakIndex(text, maxWidth) {\n  var initialIndices = text.startBox > 0 ? [0] : [];\n  var spaceIndices = text.value.split(\"\").reduce((indices, char, index) => {\n    if (\" \" === char) {\n      indices.push(index);\n    }\n\n    return indices;\n  }, initialIndices);\n  var spaceIndex = 0;\n\n  while (void 0 !== spaceIndices[spaceIndex + 1] && text.startBox + text.tspan.getSubStringLength(0, spaceIndices[spaceIndex + 1]) < maxWidth) {\n    spaceIndex++;\n  }\n\n  return spaceIndices[spaceIndex];\n}\n\nfunction getWordBreakIndex(text, maxWidth) {\n  for (var i = 0; i < text.value.length - 1; i++) {\n    if (text.startBox + text.tspan.getSubStringLength(0, i + 1) > maxWidth) {\n      return i;\n    }\n  }\n}\n\nfunction getEllipsisString(ellipsisMaxWidth, _ref) {\n  var {\n    hideOverflowEllipsis: hideOverflowEllipsis\n  } = _ref;\n  return hideOverflowEllipsis && 0 === ellipsisMaxWidth ? \"\" : ELLIPSIS;\n}\n\nfunction setEllipsis(text, ellipsisMaxWidth, options) {\n  var ellipsis = getEllipsisString(ellipsisMaxWidth, options);\n\n  if (text.value.length && text.tspan.parentNode) {\n    for (var i = text.value.length - 1; i >= 1; i--) {\n      if (text.startBox + text.tspan.getSubStringLength(0, i) < ellipsisMaxWidth) {\n        setNewText(text, i, ellipsis);\n        break;\n      } else if (1 === i) {\n        setNewText(text, 0, ellipsis);\n      }\n    }\n  }\n}\n\nfunction wordWrap(text, maxWidth, ellipsisMaxWidth, options, lastStepBreakIndex) {\n  var wholeText = text.value;\n  var breakIndex;\n\n  if (\"none\" !== options.wordWrap) {\n    breakIndex = \"normal\" === options.wordWrap ? getSpaceBreakIndex(text, maxWidth) : getWordBreakIndex(text, maxWidth);\n  }\n\n  var restLines = [];\n  var restText;\n\n  if (isFinite(breakIndex) && !(0 === lastStepBreakIndex && 0 === breakIndex)) {\n    setNewText(text, breakIndex, \"\");\n    var newTextOffset = \" \" === wholeText[breakIndex] ? 1 : 0;\n    var restString = wholeText.slice(breakIndex + newTextOffset);\n\n    if (restString.length) {\n      var restTspan = cloneAndRemoveAttrs(text.tspan);\n      restTspan.textContent = restString;\n      text.tspan.parentNode.appendChild(restTspan);\n      restText = extend(extend({}, text), {\n        value: restString,\n        startBox: 0,\n        height: 0,\n        tspan: restTspan,\n        stroke: cloneAndRemoveAttrs(text.stroke),\n        endBox: restTspan.getSubStringLength(0, restString.length)\n      });\n      restText.stroke && (restText.stroke.textContent = restString);\n\n      if (restText.endBox > maxWidth) {\n        restLines = wordWrap(restText, maxWidth, ellipsisMaxWidth, options, breakIndex);\n\n        if (!restLines.length) {\n          return [];\n        }\n      }\n    }\n  }\n\n  if (text.value.length) {\n    if (\"ellipsis\" === options.textOverflow && text.tspan.getSubStringLength(0, text.value.length) > maxWidth) {\n      setEllipsis(text, ellipsisMaxWidth, options);\n    }\n\n    if (\"hide\" === options.textOverflow && text.tspan.getSubStringLength(0, text.value.length) > maxWidth) {\n      return [];\n    }\n  } else {\n    text.tspan.parentNode.removeChild(text.tspan);\n  }\n\n  var parts = [];\n\n  if (restText) {\n    parts.push(restText);\n  }\n\n  return [{\n    commonLength: wholeText.length,\n    parts: parts\n  }].concat(restLines);\n}\n\nfunction calculateLineHeight(line, lineHeight) {\n  return line.parts.reduce((height, text) => max(height, getItemLineHeight(text, lineHeight)), 0);\n}\n\nfunction setMaxHeight(lines, ellipsisMaxWidth, options, maxHeight, lineHeight) {\n  var textOverflow = options.textOverflow;\n\n  if (!isFinite(maxHeight) || 0 === Number(maxHeight) || \"none\" === textOverflow) {\n    return lines;\n  }\n\n  var result = lines.reduce((_ref2, l, index, arr) => {\n    var [lines, commonHeight] = _ref2;\n    var height = calculateLineHeight(l, lineHeight);\n    commonHeight += height;\n\n    if (commonHeight < maxHeight) {\n      lines.push(l);\n    } else {\n      l.parts.forEach(item => {\n        removeTextSpan(item);\n      });\n\n      if (\"ellipsis\" === textOverflow) {\n        var prevLine = arr[index - 1];\n\n        if (prevLine) {\n          var text = prevLine.parts[prevLine.parts.length - 1];\n\n          if (!text.hasEllipsis) {\n            if (0 === ellipsisMaxWidth || text.endBox < ellipsisMaxWidth) {\n              setNewText(text, text.value.length, getEllipsisString(ellipsisMaxWidth, options));\n            } else {\n              setEllipsis(text, ellipsisMaxWidth, options);\n            }\n          }\n        }\n      }\n    }\n\n    return [lines, commonHeight];\n  }, [[], 0]);\n\n  if (\"hide\" === textOverflow && result[1] > maxHeight) {\n    result[0].forEach(l => {\n      l.parts.forEach(item => {\n        removeTextSpan(item);\n      });\n    });\n    return [];\n  }\n\n  return result[0];\n}\n\nfunction applyOverflowRules(element, texts, maxWidth, ellipsisMaxWidth, options) {\n  if (!texts) {\n    var textValue = element.textContent;\n    var text = {\n      value: textValue,\n      height: 0,\n      line: 0\n    };\n    element.textContent = \"\";\n    createTspans([text], element, \"tspan\");\n    texts = [text];\n  }\n\n  return texts.reduce((_ref3, text) => {\n    var [lines, startBox, endBox, stop, lineNumber] = _ref3;\n    var line = lines[lines.length - 1];\n\n    if (stop) {\n      return [lines, startBox, endBox, stop];\n    }\n\n    if (!line || text.line !== lineNumber) {\n      text.startBox = startBox = 0;\n      lines.push({\n        commonLength: text.value.length,\n        parts: [text]\n      });\n    } else {\n      text.startBox = startBox;\n\n      if (startBox > ellipsisMaxWidth && \"none\" === options.wordWrap && \"ellipsis\" === options.textOverflow) {\n        removeTextSpan(text);\n        return [lines, startBox, endBox, stop, lineNumber];\n      }\n\n      line.parts.push(text);\n      line.commonLength += text.value.length;\n    }\n\n    text.endBox = endBox = startBox + getTextWidth(text);\n    startBox = endBox;\n\n    if (isDefined(maxWidth) && endBox > maxWidth) {\n      var wordWrapLines = wordWrap(text, maxWidth, ellipsisMaxWidth, options);\n\n      if (!wordWrapLines.length) {\n        lines = [];\n        stop = true;\n      } else {\n        lines = lines.concat(wordWrapLines.filter(l => l.parts.length > 0));\n      }\n    }\n\n    return [lines, startBox, endBox, stop, text.line];\n  }, [[], 0, 0, false, 0])[0];\n}\n\nfunction setNewText(text, index) {\n  var insertString = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : ELLIPSIS;\n  var newText = text.value.substr(0, index) + insertString;\n  text.value = text.tspan.textContent = newText;\n  text.stroke && (text.stroke.textContent = newText);\n\n  if (insertString === ELLIPSIS) {\n    text.hasEllipsis = true;\n  }\n}\n\nfunction removeTextSpan(text) {\n  text.tspan.parentNode && text.tspan.parentNode.removeChild(text.tspan);\n  text.stroke && text.stroke.parentNode && text.stroke.parentNode.removeChild(text.stroke);\n}\n\nfunction createTextNodes(wrapper, text, isStroked) {\n  var items;\n  var parsedHtml;\n  wrapper._texts = null;\n  wrapper.clear();\n\n  if (null === text) {\n    return;\n  }\n\n  text = \"\" + text;\n\n  if (!wrapper.renderer.encodeHtml && (/<[a-z][\\s\\S]*>/i.test(text) || -1 !== text.indexOf(\"&\"))) {\n    parsedHtml = removeExtraAttrs(text);\n    items = parseHTML(parsedHtml);\n  } else if (/\\n/g.test(text)) {\n    items = parseMultiline(text);\n  } else if (isStroked) {\n    items = [{\n      value: text.trim(),\n      height: 0\n    }];\n  }\n\n  if (items) {\n    if (items.length) {\n      wrapper._texts = items;\n\n      if (isStroked) {\n        createTspans(items, wrapper.element, KEY_STROKE);\n      }\n\n      createTspans(items, wrapper.element, \"tspan\");\n    }\n  } else {\n    wrapper.element.appendChild(domAdapter.createTextNode(text));\n  }\n}\n\nfunction setTextNodeAttribute(item, name, value) {\n  item.tspan.setAttribute(name, value);\n  item.stroke && item.stroke.setAttribute(name, value);\n}\n\nfunction getItemLineHeight(item, defaultValue) {\n  return item.inherits ? maxLengthFontSize(item.height, defaultValue) : item.height || defaultValue;\n}\n\nfunction locateTextNodes(wrapper) {\n  if (!wrapper._texts) {\n    return;\n  }\n\n  var items = wrapper._texts;\n  var x = wrapper._settings.x;\n\n  var lineHeight = wrapper._getLineHeight();\n\n  var i;\n  var ii;\n  var item = items[0];\n  setTextNodeAttribute(item, \"x\", x);\n  setTextNodeAttribute(item, \"y\", wrapper._settings.y);\n\n  for (i = 1, ii = items.length; i < ii; ++i) {\n    item = items[i];\n\n    if (parseFloat(item.height) >= 0) {\n      setTextNodeAttribute(item, \"x\", x);\n      var height = getItemLineHeight(item, lineHeight);\n      setTextNodeAttribute(item, \"dy\", height);\n    }\n  }\n}\n\nfunction alignTextNodes(wrapper, alignment) {\n  if (!wrapper._texts || \"center\" === alignment) {\n    return;\n  }\n\n  var items = wrapper._texts;\n  var direction = \"left\" === alignment ? -1 : 1;\n  var maxTextWidth = Math.max.apply(Math, items.map(t => getTextWidth(t)));\n\n  for (var i = 0; i < items.length; i++) {\n    var item = items[i];\n    var textWidth = getTextWidth(item);\n\n    if (0 !== maxTextWidth && maxTextWidth !== textWidth) {\n      setTextNodeAttribute(item, \"dx\", direction * round((maxTextWidth - textWidth) / 2 * 10) / 10);\n    }\n  }\n}\n\nfunction maxLengthFontSize(fontSize1, fontSize2) {\n  var parsedHeight1 = parseFloat(fontSize1);\n  var parsedHeight2 = parseFloat(fontSize2);\n  var height1 = parsedHeight1 || DEFAULT_FONT_SIZE;\n  var height2 = parsedHeight2 || DEFAULT_FONT_SIZE;\n  return height1 > height2 ? !isNaN(parsedHeight1) ? fontSize1 : height1 : !isNaN(parsedHeight2) ? fontSize2 : height2;\n}\n\nfunction strokeTextNodes(wrapper) {\n  if (!wrapper._texts) {\n    return;\n  }\n\n  var items = wrapper._texts;\n  var stroke = wrapper._settings[KEY_STROKE];\n  var strokeWidth = wrapper._settings[KEY_STROKE_WIDTH];\n  var strokeOpacity = wrapper._settings[KEY_STROKE_OPACITY] || 1;\n  var tspan;\n  var i;\n  var ii;\n\n  for (i = 0, ii = items.length; i < ii; ++i) {\n    tspan = items[i].stroke;\n    tspan.setAttribute(KEY_STROKE, stroke);\n    tspan.setAttribute(KEY_STROKE_WIDTH, strokeWidth);\n    tspan.setAttribute(KEY_STROKE_OPACITY, strokeOpacity);\n    tspan.setAttribute(\"stroke-linejoin\", \"round\");\n  }\n}\n\nfunction baseAnimate(that, params, options, complete) {\n  options = options || {};\n  var key;\n  var value;\n  var renderer = that.renderer;\n  var settings = that._settings;\n  var animationParams = {};\n  var defaults = {\n    translateX: 0,\n    translateY: 0,\n    scaleX: 1,\n    scaleY: 1,\n    rotate: 0,\n    rotateX: 0,\n    rotateY: 0\n  };\n\n  if (complete) {\n    options.complete = complete;\n  }\n\n  if (renderer.animationEnabled()) {\n    for (key in params) {\n      value = params[key];\n\n      if (/^(translate(X|Y)|rotate[XY]?|scale(X|Y))$/i.test(key)) {\n        animationParams.transform = animationParams.transform || {\n          from: {},\n          to: {}\n        };\n        animationParams.transform.from[key] = key in settings ? Number(settings[key].toFixed(3)) : defaults[key];\n        animationParams.transform.to[key] = value;\n      } else if (\"arc\" === key || \"segments\" === key) {\n        animationParams[key] = value;\n      } else {\n        animationParams[key] = {\n          from: key in settings ? settings[key] : parseFloat(that.element.getAttribute(key) || 0),\n          to: value\n        };\n      }\n    }\n\n    renderer.animateElement(that, animationParams, extend(extend({}, renderer._animation), options));\n  } else {\n    options.step && options.step.call(that, 1, 1);\n    options.complete && options.complete.call(that);\n    that.attr(params);\n  }\n\n  return that;\n}\n\nfunction pathAnimate(params, options, complete) {\n  var curSegments = this.segments || [];\n  var newSegments;\n  var endSegments;\n\n  if (this.renderer.animationEnabled() && \"points\" in params) {\n    newSegments = buildPathSegments(params.points, this.type);\n    endSegments = compensateSegments(curSegments, newSegments, this.type);\n    params.segments = {\n      from: curSegments,\n      to: newSegments,\n      end: endSegments\n    };\n    delete params.points;\n  }\n\n  return baseAnimate(this, params, options, complete);\n}\n\nfunction arcAnimate(params, options, complete) {\n  var settings = this._settings;\n  var arcParams = {\n    from: {},\n    to: {}\n  };\n\n  if (this.renderer.animationEnabled() && (\"x\" in params || \"y\" in params || \"innerRadius\" in params || \"outerRadius\" in params || \"startAngle\" in params || \"endAngle\" in params)) {\n    arcParams.from.x = settings.x || 0;\n    arcParams.from.y = settings.y || 0;\n    arcParams.from.innerRadius = settings.innerRadius || 0;\n    arcParams.from.outerRadius = settings.outerRadius || 0;\n    arcParams.from.startAngle = settings.startAngle || 0;\n    arcParams.from.endAngle = settings.endAngle || 0;\n    arcParams.to.x = \"x\" in params ? params.x : settings.x;\n    delete params.x;\n    arcParams.to.y = \"y\" in params ? params.y : settings.y;\n    delete params.y;\n    arcParams.to.innerRadius = \"innerRadius\" in params ? params.innerRadius : settings.innerRadius;\n    delete params.innerRadius;\n    arcParams.to.outerRadius = \"outerRadius\" in params ? params.outerRadius : settings.outerRadius;\n    delete params.outerRadius;\n    arcParams.to.startAngle = \"startAngle\" in params ? params.startAngle : settings.startAngle;\n    delete params.startAngle;\n    arcParams.to.endAngle = \"endAngle\" in params ? params.endAngle : settings.endAngle;\n    delete params.endAngle;\n    params.arc = arcParams;\n  }\n\n  return baseAnimate(this, params, options, complete);\n}\n\nfunction buildLink(target, parameters) {\n  var obj = {\n    is: false,\n    name: parameters.name || parameters,\n    after: parameters.after\n  };\n\n  if (target) {\n    obj.to = target;\n  } else {\n    obj.virtual = true;\n  }\n\n  return obj;\n}\n\nexport var SvgElement = function (renderer, tagName, type) {\n  this.renderer = renderer;\n  this.element = createElement(tagName);\n  this._settings = {};\n  this._styles = {};\n\n  if (\"path\" === tagName) {\n    this.type = type || \"line\";\n  }\n};\n\nfunction removeFuncIriCallback(callback) {\n  fixFuncIriCallbacks.remove(callback);\n}\n\nSvgElement.prototype = {\n  constructor: SvgElement,\n  _getJQElement: function () {\n    return this._$element || (this._$element = $(this.element));\n  },\n  _addFixIRICallback: function () {\n    var that = this;\n\n    var fn = function () {\n      fixFuncIri(that, \"fill\");\n      fixFuncIri(that, \"clip-path\");\n      fixFuncIri(that, \"filter\");\n    };\n\n    that.element._fixFuncIri = fn;\n    fn.renderer = that.renderer;\n    fixFuncIriCallbacks.add(fn);\n\n    that._addFixIRICallback = function () {};\n  },\n  _clearChildrenFuncIri: function () {\n    !function clearChildren(element) {\n      var i;\n\n      for (i = 0; i < element.childNodes.length; i++) {\n        removeFuncIriCallback(element.childNodes[i]._fixFuncIri);\n        clearChildren(element.childNodes[i]);\n      }\n    }(this.element);\n  },\n  dispose: function () {\n    removeFuncIriCallback(this.element._fixFuncIri);\n\n    this._clearChildrenFuncIri();\n\n    this._getJQElement().remove();\n\n    return this;\n  },\n  append: function (parent) {\n    (parent || this.renderer.root).element.appendChild(this.element);\n    return this;\n  },\n  remove: function () {\n    var element = this.element;\n    element.parentNode && element.parentNode.removeChild(element);\n    return this;\n  },\n  enableLinks: function () {\n    this._links = [];\n    return this;\n  },\n  virtualLink: function (parameters) {\n    linkItem({\n      _link: buildLink(null, parameters)\n    }, this);\n    return this;\n  },\n  linkAfter: function (name) {\n    this._linkAfter = name;\n    return this;\n  },\n  linkOn: function (target, parameters) {\n    this._link = buildLink(target, parameters);\n    linkItem(this, target);\n    return this;\n  },\n  linkOff: function () {\n    unlinkItem(this);\n    this._link = null;\n    return this;\n  },\n  linkAppend: function () {\n    var link = this._link;\n    var items = link.to._links;\n    var i;\n    var next;\n\n    for (i = link.i + 1; (next = items[i]) && !next._link.is; ++i) {}\n\n    this._insert(link.to, next);\n\n    link.is = true;\n    return this;\n  },\n  _insert: function (parent, next) {\n    parent.element.insertBefore(this.element, next ? next.element : null);\n  },\n  linkRemove: function () {\n    this.remove();\n    this._link.is = false;\n    return this;\n  },\n  clear: function () {\n    this._clearChildrenFuncIri();\n\n    this._getJQElement().empty();\n\n    return this;\n  },\n  toBackground: function () {\n    var elem = this.element;\n    var parent = elem.parentNode;\n    parent && parent.insertBefore(elem, parent.firstChild);\n    return this;\n  },\n  toForeground: function () {\n    var elem = this.element;\n    var parent = elem.parentNode;\n    parent && parent.appendChild(elem);\n    return this;\n  },\n  attr: function (attrs) {\n    return baseAttr(this, attrs);\n  },\n  smartAttr: function (attrs) {\n    return this.attr(processHatchingAttrs(this, attrs));\n  },\n  css: function (styles) {\n    return baseCss(this, styles);\n  },\n  animate: function (params, options, complete) {\n    return baseAnimate(this, params, options, complete);\n  },\n\n  sharp(pos, sharpDirection) {\n    return this.attr({\n      sharp: pos || true,\n      sharpDirection: sharpDirection\n    });\n  },\n\n  _applyTransformation() {\n    var tr = this._settings;\n    var rotateX;\n    var rotateY;\n    var transformations = [];\n    var sharpMode = tr.sharp;\n    var trDirection = tr.sharpDirection || 1;\n    var strokeOdd = tr[KEY_STROKE_WIDTH] % 2;\n    var correctionX = strokeOdd && (\"h\" === sharpMode || true === sharpMode) ? SHARPING_CORRECTION * trDirection : 0;\n    var correctionY = strokeOdd && (\"v\" === sharpMode || true === sharpMode) ? SHARPING_CORRECTION * trDirection : 0;\n    transformations.push(\"translate(\" + ((tr.translateX || 0) + correctionX) + \",\" + ((tr.translateY || 0) + correctionY) + \")\");\n\n    if (tr.rotate) {\n      if (\"rotateX\" in tr) {\n        rotateX = tr.rotateX;\n      } else {\n        rotateX = tr.x;\n      }\n\n      if (\"rotateY\" in tr) {\n        rotateY = tr.rotateY;\n      } else {\n        rotateY = tr.y;\n      }\n\n      transformations.push(\"rotate(\" + tr.rotate + \",\" + (rotateX || 0) + \",\" + (rotateY || 0) + \")\");\n    }\n\n    var scaleXDefined = isDefined(tr.scaleX);\n    var scaleYDefined = isDefined(tr.scaleY);\n\n    if (scaleXDefined || scaleYDefined) {\n      transformations.push(\"scale(\" + (scaleXDefined ? tr.scaleX : 1) + \",\" + (scaleYDefined ? tr.scaleY : 1) + \")\");\n    }\n\n    if (transformations.length) {\n      this.element.setAttribute(\"transform\", transformations.join(\" \"));\n    }\n  },\n\n  move: function (x, y, animate, animOptions) {\n    var obj = {};\n    isDefined(x) && (obj.translateX = x);\n    isDefined(y) && (obj.translateY = y);\n\n    if (!animate) {\n      this.attr(obj);\n    } else {\n      this.animate(obj, animOptions);\n    }\n\n    return this;\n  },\n  rotate: function (angle, x, y, animate, animOptions) {\n    var obj = {\n      rotate: angle || 0\n    };\n    isDefined(x) && (obj.rotateX = x);\n    isDefined(y) && (obj.rotateY = y);\n\n    if (!animate) {\n      this.attr(obj);\n    } else {\n      this.animate(obj, animOptions);\n    }\n\n    return this;\n  },\n  _getElementBBox: function () {\n    var elem = this.element;\n    var bBox;\n\n    try {\n      bBox = elem.getBBox && elem.getBBox();\n    } catch (e) {}\n\n    return bBox || {\n      x: 0,\n      y: 0,\n      width: elem.offsetWidth || 0,\n      height: elem.offsetHeight || 0\n    };\n  },\n  getBBox: function () {\n    var transformation = this._settings;\n\n    var bBox = this._getElementBBox();\n\n    if (transformation.rotate) {\n      bBox = rotateBBox(bBox, [(\"rotateX\" in transformation ? transformation.rotateX : transformation.x) || 0, (\"rotateY\" in transformation ? transformation.rotateY : transformation.y) || 0], -transformation.rotate);\n    } else {\n      bBox = normalizeBBox(bBox);\n    }\n\n    return bBox;\n  },\n  markup: function () {\n    return getSvgMarkup(this.element);\n  },\n  getOffset: function () {\n    return this._getJQElement().offset();\n  },\n  stopAnimation: function (disableComplete) {\n    var animation = this.animation;\n    animation && animation.stop(disableComplete);\n    return this;\n  },\n  setTitle: function (text) {\n    var titleElem = createElement(\"title\");\n    titleElem.textContent = text || \"\";\n    this.element.appendChild(titleElem);\n  },\n\n  removeTitle() {\n    detachTitleElements(this.element);\n  },\n\n  data: function (obj, val) {\n    var elem = this.element;\n    var key;\n\n    if (void 0 !== val) {\n      elem[obj] = val;\n    } else {\n      for (key in obj) {\n        elem[key] = obj[key];\n      }\n    }\n\n    return this;\n  },\n  on: function () {\n    var args = [this._getJQElement()];\n    args.push.apply(args, arguments);\n    eventsEngine.on.apply(eventsEngine, args);\n    return this;\n  },\n  off: function () {\n    var args = [this._getJQElement()];\n    args.push.apply(args, arguments);\n    eventsEngine.off.apply(eventsEngine, args);\n    return this;\n  },\n  trigger: function () {\n    var args = [this._getJQElement()];\n    args.push.apply(args, arguments);\n    eventsEngine.trigger.apply(eventsEngine, args);\n    return this;\n  }\n};\nexport var PathSvgElement = function (renderer, type) {\n  SvgElement.call(this, renderer, \"path\", type);\n};\nPathSvgElement.prototype = objectCreate(SvgElement.prototype);\nextend(PathSvgElement.prototype, {\n  constructor: PathSvgElement,\n  attr: pathAttr,\n  animate: pathAnimate\n});\nexport var ArcSvgElement = function (renderer) {\n  SvgElement.call(this, renderer, \"path\", \"arc\");\n};\nArcSvgElement.prototype = objectCreate(SvgElement.prototype);\nextend(ArcSvgElement.prototype, {\n  constructor: ArcSvgElement,\n  attr: arcAttr,\n  animate: arcAnimate\n});\nexport var RectSvgElement = function (renderer) {\n  SvgElement.call(this, renderer, \"rect\");\n};\nRectSvgElement.prototype = objectCreate(SvgElement.prototype);\nextend(RectSvgElement.prototype, {\n  constructor: RectSvgElement,\n  attr: rectAttr\n});\nexport var TextSvgElement = function (renderer) {\n  SvgElement.call(this, renderer, \"text\");\n  this.css({\n    \"white-space\": \"pre\"\n  });\n};\nTextSvgElement.prototype = objectCreate(SvgElement.prototype);\nextend(TextSvgElement.prototype, {\n  constructor: TextSvgElement,\n  attr: textAttr,\n  css: textCss,\n  applyEllipsis: applyEllipsis,\n  setMaxSize: setMaxSize,\n  restoreText: restoreText,\n\n  _getLineHeight() {\n    return !isNaN(parseFloat(this._styles[KEY_FONT_SIZE])) ? this._styles[KEY_FONT_SIZE] : DEFAULT_FONT_SIZE;\n  }\n\n});\n\nfunction updateIndexes(items, k) {\n  var i;\n  var item;\n\n  for (i = k; item = items[i]; ++i) {\n    item._link.i = i;\n  }\n}\n\nfunction linkItem(target, container) {\n  var items = container._links;\n  var key = target._link.after = target._link.after || container._linkAfter;\n  var i;\n  var item;\n\n  if (key) {\n    for (i = 0; (item = items[i]) && item._link.name !== key; ++i) {}\n\n    if (item) {\n      for (++i; (item = items[i]) && item._link.after === key; ++i) {}\n    }\n  } else {\n    i = items.length;\n  }\n\n  items.splice(i, 0, target);\n  updateIndexes(items, i);\n}\n\nfunction unlinkItem(target) {\n  var i;\n  var items = target._link.to._links;\n\n  for (i = 0; items[i] !== target; ++i) {}\n\n  items.splice(i, 1);\n  updateIndexes(items, i);\n}\n\nexport function Renderer(options) {\n  this.root = this._createElement(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    fill: NONE,\n    stroke: NONE,\n    \"stroke-width\": 0\n  }).attr({\n    class: options.cssClass\n  }).css({\n    \"line-height\": \"normal\",\n    \"-ms-user-select\": NONE,\n    \"-moz-user-select\": NONE,\n    \"-webkit-user-select\": NONE,\n    \"-webkit-tap-highlight-color\": \"rgba(0, 0, 0, 0)\",\n    display: \"block\",\n    overflow: \"hidden\"\n  });\n\n  this._init();\n\n  this.pathModified = !!options.pathModified;\n  this._$container = $(options.container);\n  this.root.append({\n    element: options.container\n  });\n  this._locker = 0;\n  this._backed = false;\n}\nRenderer.prototype = {\n  constructor: Renderer,\n  _init: function () {\n    this._defs = this._createElement(\"defs\").append(this.root);\n    this._animationController = new AnimationController(this.root.element);\n    this._animation = {\n      enabled: true,\n      duration: 1e3,\n      easing: \"easeOutCubic\"\n    };\n  },\n  setOptions: function (options) {\n    this.rtl = !!options.rtl;\n    this.encodeHtml = !!options.encodeHtml;\n    this.updateAnimationOptions(options.animation || {});\n    this.root.attr({\n      direction: this.rtl ? \"rtl\" : \"ltr\"\n    });\n    return this;\n  },\n  _createElement: function (tagName, attr, type) {\n    var elem = new SvgElement(this, tagName, type);\n    attr && elem.attr(attr);\n    return elem;\n  },\n  lock: function () {\n    if (0 === this._locker) {\n      this._backed = !this._$container.is(\":visible\");\n\n      if (this._backed) {\n        backupRoot(this.root);\n      }\n    }\n\n    ++this._locker;\n    return this;\n  },\n  unlock: function () {\n    --this._locker;\n\n    if (0 === this._locker) {\n      if (this._backed) {\n        restoreRoot(this.root, this._$container[0]);\n      }\n\n      this._backed = false;\n    }\n\n    return this;\n  },\n  resize: function (width, height) {\n    if (width >= 0 && height >= 0) {\n      this.root.attr({\n        width: width,\n        height: height\n      });\n    }\n\n    return this;\n  },\n  dispose: function () {\n    var key;\n    this.root.dispose();\n\n    this._defs.dispose();\n\n    this._animationController.dispose();\n\n    fixFuncIriCallbacks.removeByRenderer(this);\n\n    for (key in this) {\n      this[key] = null;\n    }\n\n    return this;\n  },\n  animationEnabled: function () {\n    return !!this._animation.enabled;\n  },\n  updateAnimationOptions: function (newOptions) {\n    extend(this._animation, newOptions);\n    return this;\n  },\n  stopAllAnimations: function (lock) {\n    this._animationController[lock ? \"lock\" : \"stop\"]();\n\n    return this;\n  },\n  animateElement: function (element, params, options) {\n    this._animationController.animateElement(element, params, options);\n\n    return this;\n  },\n  svg: function () {\n    return this.root.markup();\n  },\n  getRootOffset: function () {\n    return this.root.getOffset();\n  },\n  onEndAnimation: function (endAnimation) {\n    this._animationController.onEndAnimation(endAnimation);\n  },\n  rect: function (x, y, width, height) {\n    var elem = new RectSvgElement(this);\n    return elem.attr({\n      x: x || 0,\n      y: y || 0,\n      width: width || 0,\n      height: height || 0\n    });\n  },\n  simpleRect: function () {\n    return this._createElement(\"rect\");\n  },\n  circle: function (x, y, r) {\n    return this._createElement(\"circle\", {\n      cx: x || 0,\n      cy: y || 0,\n      r: r || 0\n    });\n  },\n  g: function () {\n    return this._createElement(\"g\");\n  },\n  image: function (x, y, w, h, href, location) {\n    var image = this._createElement(\"image\", {\n      x: x || 0,\n      y: y || 0,\n      width: w || 0,\n      height: h || 0,\n      preserveAspectRatio: preserveAspectRatioMap[normalizeEnum(location)] || NONE\n    });\n\n    image.element.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"href\", href || \"\");\n    return image;\n  },\n  path: function (points, type) {\n    var elem = new PathSvgElement(this, type);\n    return elem.attr({\n      points: points || []\n    });\n  },\n  arc: function (x, y, innerRadius, outerRadius, startAngle, endAngle) {\n    var elem = new ArcSvgElement(this);\n    return elem.attr({\n      x: x || 0,\n      y: y || 0,\n      innerRadius: innerRadius || 0,\n      outerRadius: outerRadius || 0,\n      startAngle: startAngle || 0,\n      endAngle: endAngle || 0\n    });\n  },\n  text: function (_text, x, y) {\n    var elem = new TextSvgElement(this);\n    return elem.attr({\n      text: _text,\n      x: x || 0,\n      y: y || 0\n    });\n  },\n  linearGradient: function (stops) {\n    var id = getNextDefsSvgId();\n    var that = this;\n\n    var gradient = that._createElement(\"linearGradient\", {\n      id: id\n    }).append(that._defs);\n\n    gradient.id = id;\n    stops.forEach(stop => {\n      that._createElement(\"stop\", {\n        offset: stop.offset,\n        \"stop-color\": stop[\"stop-color\"]\n      }).append(gradient);\n    });\n    return gradient;\n  },\n  pattern: function (color, hatching, _id) {\n    hatching = hatching || {};\n    var step = hatching.step || 6;\n    var stepTo2 = step / 2;\n    var stepBy15 = 1.5 * step;\n\n    var id = _id || getNextDefsSvgId();\n\n    var d = \"right\" === normalizeEnum(hatching.direction) ? \"M \" + stepTo2 + \" \" + -stepTo2 + \" L \" + -stepTo2 + \" \" + stepTo2 + \" M 0 \" + step + \" L \" + step + \" 0 M \" + stepBy15 + \" \" + stepTo2 + \" L \" + stepTo2 + \" \" + stepBy15 : \"M 0 0 L \" + step + \" \" + step + \" M \" + -stepTo2 + \" \" + stepTo2 + \" L \" + stepTo2 + \" \" + stepBy15 + \" M \" + stepTo2 + \" \" + -stepTo2 + \" L \" + stepBy15 + \" \" + stepTo2;\n\n    var pattern = this._createElement(\"pattern\", {\n      id: id,\n      width: step,\n      height: step,\n      patternUnits: \"userSpaceOnUse\"\n    }).append(this._defs);\n\n    pattern.id = id;\n    this.rect(0, 0, step, step).attr({\n      fill: color,\n      opacity: hatching.opacity\n    }).append(pattern);\n    new PathSvgElement(this).attr({\n      d: d,\n      \"stroke-width\": hatching.width || 1,\n      stroke: color\n    }).append(pattern);\n    return pattern;\n  },\n  _getPointsWithYOffset: function (points, offset) {\n    return points.map(function (point, index) {\n      if (index % 2 !== 0) {\n        return point + offset;\n      }\n\n      return point;\n    });\n  },\n  clipShape: function (method, methodArgs) {\n    var id = getNextDefsSvgId();\n\n    var clipPath = this._createElement(\"clipPath\", {\n      id: id\n    }).append(this._defs);\n\n    var shape = method.apply(this, methodArgs).append(clipPath);\n    shape.id = id;\n\n    shape.remove = function () {\n      throw \"Not implemented\";\n    };\n\n    shape.dispose = function () {\n      clipPath.dispose();\n      clipPath = null;\n      return this;\n    };\n\n    return shape;\n  },\n\n  clipRect(x, y, width, height) {\n    return this.clipShape(this.rect, arguments);\n  },\n\n  clipCircle(x, y, radius) {\n    return this.clipShape(this.circle, arguments);\n  },\n\n  shadowFilter: function (x, y, width, height, offsetX, offsetY, blur, color, opacity) {\n    var id = getNextDefsSvgId();\n\n    var filter = this._createElement(\"filter\", {\n      id: id,\n      x: x || 0,\n      y: y || 0,\n      width: width || 0,\n      height: height || 0\n    }).append(this._defs);\n\n    var gaussianBlur = this._createElement(\"feGaussianBlur\", {\n      in: \"SourceGraphic\",\n      result: \"gaussianBlurResult\",\n      stdDeviation: blur || 0\n    }).append(filter);\n\n    var offset = this._createElement(\"feOffset\", {\n      in: \"gaussianBlurResult\",\n      result: \"offsetResult\",\n      dx: offsetX || 0,\n      dy: offsetY || 0\n    }).append(filter);\n\n    var flood = this._createElement(\"feFlood\", {\n      result: \"floodResult\",\n      \"flood-color\": color || \"\",\n      \"flood-opacity\": opacity\n    }).append(filter);\n\n    var composite = this._createElement(\"feComposite\", {\n      in: \"floodResult\",\n      in2: \"offsetResult\",\n      operator: \"in\",\n      result: \"compositeResult\"\n    }).append(filter);\n\n    var finalComposite = this._createElement(\"feComposite\", {\n      in: \"SourceGraphic\",\n      in2: \"compositeResult\",\n      operator: \"over\"\n    }).append(filter);\n\n    filter.id = id;\n    filter.gaussianBlur = gaussianBlur;\n    filter.offset = offset;\n    filter.flood = flood;\n    filter.composite = composite;\n    filter.finalComposite = finalComposite;\n\n    filter.attr = function (attrs) {\n      var filterAttrs = {};\n      var offsetAttrs = {};\n      var floodAttrs = {};\n      \"x\" in attrs && (filterAttrs.x = attrs.x);\n      \"y\" in attrs && (filterAttrs.y = attrs.y);\n      \"width\" in attrs && (filterAttrs.width = attrs.width);\n      \"height\" in attrs && (filterAttrs.height = attrs.height);\n      baseAttr(this, filterAttrs);\n      \"blur\" in attrs && this.gaussianBlur.attr({\n        stdDeviation: attrs.blur\n      });\n      \"offsetX\" in attrs && (offsetAttrs.dx = attrs.offsetX);\n      \"offsetY\" in attrs && (offsetAttrs.dy = attrs.offsetY);\n      this.offset.attr(offsetAttrs);\n      \"color\" in attrs && (floodAttrs[\"flood-color\"] = attrs.color);\n      \"opacity\" in attrs && (floodAttrs[\"flood-opacity\"] = attrs.opacity);\n      this.flood.attr(floodAttrs);\n      return this;\n    };\n\n    return filter;\n  },\n  brightFilter: function (type, slope) {\n    var id = getNextDefsSvgId();\n\n    var filter = this._createElement(\"filter\", {\n      id: id\n    }).append(this._defs);\n\n    var componentTransferElement = this._createElement(\"feComponentTransfer\").append(filter);\n\n    var attrs = {\n      type: type,\n      slope: slope\n    };\n    filter.id = id;\n\n    this._createElement(\"feFuncR\", attrs).append(componentTransferElement);\n\n    this._createElement(\"feFuncG\", attrs).append(componentTransferElement);\n\n    this._createElement(\"feFuncB\", attrs).append(componentTransferElement);\n\n    return filter;\n  },\n  getGrayScaleFilter: function () {\n    if (this._grayScaleFilter) {\n      return this._grayScaleFilter;\n    }\n\n    var id = getNextDefsSvgId();\n\n    var filter = this._createElement(\"filter\", {\n      id: id\n    }).append(this._defs);\n\n    this._createElement(\"feColorMatrix\").attr({\n      type: \"matrix\",\n      values: \"0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 0.6 0\"\n    }).append(filter);\n\n    filter.id = id;\n    this._grayScaleFilter = filter;\n    return filter;\n  },\n  initHatching: function () {\n    var storage = this._hatchingStorage = this._hatchingStorage || {\n      byHash: {},\n      baseId: getNextDefsSvgId()\n    };\n    var byHash = storage.byHash;\n    var name;\n\n    for (name in byHash) {\n      byHash[name].pattern.dispose();\n    }\n\n    storage.byHash = {};\n    storage.refToHash = {};\n    storage.nextId = 0;\n  },\n  lockHatching: function (color, hatching, ref) {\n    var storage = this._hatchingStorage;\n    var hash = getHatchingHash(color, hatching);\n    var storageItem;\n    var pattern;\n\n    if (storage.refToHash[ref] !== hash) {\n      if (ref) {\n        this.releaseHatching(ref);\n      }\n\n      storageItem = storage.byHash[hash];\n\n      if (!storageItem) {\n        pattern = this.pattern(color, hatching, storage.baseId + \"-hatching-\" + storage.nextId++);\n        storageItem = storage.byHash[hash] = {\n          pattern: pattern,\n          count: 0\n        };\n        storage.refToHash[pattern.id] = hash;\n      }\n\n      ++storageItem.count;\n      ref = storageItem.pattern.id;\n    }\n\n    return ref;\n  },\n  releaseHatching: function (ref) {\n    var storage = this._hatchingStorage;\n    var hash = storage.refToHash[ref];\n    var storageItem = storage.byHash[hash];\n\n    if (storageItem && 0 === --storageItem.count) {\n      storageItem.pattern.dispose();\n      delete storage.byHash[hash];\n      delete storage.refToHash[ref];\n    }\n  }\n};\n\nfunction getHatchingHash(color, hatching) {\n  return \"@\" + color + \"::\" + hatching.step + \":\" + hatching.width + \":\" + hatching.opacity + \":\" + hatching.direction;\n}\n\nvar fixFuncIriCallbacks = function () {\n  var callbacks = [];\n  return {\n    add: function (fn) {\n      callbacks.push(fn);\n    },\n    remove: function (fn) {\n      callbacks = callbacks.filter(function (el) {\n        return el !== fn;\n      });\n    },\n    removeByRenderer: function (renderer) {\n      callbacks = callbacks.filter(function (el) {\n        return el.renderer !== renderer;\n      });\n    },\n    fire: function () {\n      callbacks.forEach(function (fn) {\n        fn();\n      });\n    }\n  };\n}();\n\nexport var refreshPaths = function () {\n  fixFuncIriCallbacks.fire();\n};","map":{"version":3,"names":["$","domAdapter","getWindow","callOnce","eventsEngine","getSvgMarkup","AnimationController","normalizeBBox","rotateBBox","normalizeEnum","isDefined","window","max","min","floor","round","sin","cos","abs","PI","Math","PI_DIV_180","SHARPING_CORRECTION","ARC_COORD_PREC","pxAddingExceptions","opacity","order","orphans","widows","zoom","KEY_TEXT","KEY_STROKE","KEY_STROKE_WIDTH","KEY_STROKE_OPACITY","KEY_FONT_SIZE","KEY_FONT_STYLE","KEY_FONT_WEIGHT","KEY_TEXT_DECORATION","KEY_TEXTS_ALIGNMENT","NONE","DEFAULT_FONT_SIZE","ELLIPSIS","objectCreate","Object","create","proto","F","prototype","DEFAULTS","scaleX","scaleY","getBackup","backupContainer","createElement","style","left","position","backupCounter","backupRoot","root","getBody","appendChild","append","element","restoreRoot","container","removeChild","getNextDefsSvgId","numDefsSvgElements","isObjectArgument","value","tagName","createElementNS","getFuncIri","id","pathModified","location","href","split","extend","target","source","key","roundValue","exp","toString","preserveAspectRatioMap","full","lefttop","leftcenter","leftbottom","centertop","center","centerbottom","righttop","rightcenter","rightbottom","processHatchingAttrs","attrs","hatching","direction","fill","_hatching","renderer","lockHatching","releaseHatching","normalizeArcParams","x","y","innerR","outerR","startAngle","endAngle","isCircle","noArc","angleDiff","buildArcPath","startAngleCos","startAngleSin","endAngleCos","endAngleSin","longFlag","toFixed","join","buildPathSegments","points","type","list","buildLineSegments","buildCurveSegments","close","buildSegments","buildSimpleLineSegment","buildSimpleCurveSegment","buildSimpleSegment","_points$","i","ii","length","k0","k","push","combinePathParam","segments","d","segment","j","jj","compensateSegments","oldSegments","newSegments","oldLength","newLength","originalNewSegments","makeEqualSegments","indexOf","makeEqualAreaSegments","makeEqualLineSegments","slice","prepareConstSegment","constSeg","short","long","head","shortLength","longLength","constsSeg1","constsSeg2","splice","baseCss","that","styles","elemStyles","_styles","fixFuncIri","wrapper","attribute","attr","removeAttribute","setAttribute","baseAttr","settings","_settings","attributes","elem","rtl","hasTransformations","recalculateDashStyle","sw","right","_addFixIRICallback","test","dashStyle","_originalSW","replace","parseInt","_applyTransformation","pathAttr","arcAttr","innerRadius","outerRadius","apply","rectAttr","width","height","maxSW","newSW","_originalX","_originalY","_originalWidth","_originalHeight","sharp","textAttr","isResetRequired","wasStroked","alignTextNodes","isStroked","createTextNodes","text","_hasEllipsis","locateTextNodes","strokeTextNodes","textCss","orderHtmlTree","line","node","parentStyle","parentClassName","realStyle","nodes","wholeText","className","isElementNode","color","fontSize","fontStyle","fontWeight","textDecoration","childNodes","adjustLineHeights","items","currentItem","item","maxLengthFontSize","inherits","parseFloat","NaN","removeExtraAttrs","html","findStyleAndClassAttrs","allTagAttrs","p1","p2","p3","match","map","str","parseHTML","div","innerHTML","parseMultiline","texts","trim","createTspans","fieldName","createTextNode","restoreText","applyEllipsis","maxWidth","lines","hasEllipsis","lineParts","call","ellipsis","ellipsisWidth","getBBox","_getElementBBox","prepareLines","_texts","parts","commonLength","endIndex","setNewText","startBox","removeTextSpan","remove","cloneAndRemoveAttrs","clone","cloneNode","detachTitleElements","titleElements","querySelectorAll","detachAndStoreTitleElements","setMaxSize","maxHeight","options","arguments","textChanged","textIsEmpty","ellipsisMaxWidth","restoreTitleElement","applyOverflowRules","setMaxHeight","_getLineHeight","reduce","concat","filter","t","stroke","tspan","parentNode","textContent","rowCount","getIndexForEllipsis","endBox","kk","getSubStringLength","getTextWidth","getSpaceBreakIndex","initialIndices","spaceIndices","indices","char","index","spaceIndex","getWordBreakIndex","getEllipsisString","_ref","hideOverflowEllipsis","setEllipsis","wordWrap","lastStepBreakIndex","breakIndex","restLines","restText","isFinite","newTextOffset","restString","restTspan","textOverflow","calculateLineHeight","lineHeight","getItemLineHeight","Number","result","_ref2","l","arr","commonHeight","forEach","prevLine","textValue","_ref3","stop","lineNumber","wordWrapLines","insertString","newText","substr","parsedHtml","clear","encodeHtml","setTextNodeAttribute","name","defaultValue","alignment","maxTextWidth","textWidth","fontSize1","fontSize2","parsedHeight1","parsedHeight2","height1","height2","isNaN","strokeWidth","strokeOpacity","baseAnimate","params","complete","animationParams","defaults","translateX","translateY","rotate","rotateX","rotateY","animationEnabled","transform","from","to","getAttribute","animateElement","_animation","step","pathAnimate","curSegments","endSegments","end","arcAnimate","arcParams","arc","buildLink","parameters","obj","is","after","virtual","SvgElement","removeFuncIriCallback","callback","fixFuncIriCallbacks","constructor","_getJQElement","_$element","fn","_fixFuncIri","add","_clearChildrenFuncIri","clearChildren","dispose","parent","enableLinks","_links","virtualLink","linkItem","_link","linkAfter","_linkAfter","linkOn","linkOff","unlinkItem","linkAppend","link","next","_insert","insertBefore","linkRemove","empty","toBackground","firstChild","toForeground","smartAttr","css","animate","pos","sharpDirection","tr","transformations","sharpMode","trDirection","strokeOdd","correctionX","correctionY","scaleXDefined","scaleYDefined","move","animOptions","angle","bBox","e","offsetWidth","offsetHeight","transformation","markup","getOffset","offset","stopAnimation","disableComplete","animation","setTitle","titleElem","removeTitle","data","val","on","args","off","trigger","PathSvgElement","ArcSvgElement","RectSvgElement","TextSvgElement","updateIndexes","Renderer","_createElement","xmlns","version","class","cssClass","display","overflow","_init","_$container","_locker","_backed","_defs","_animationController","enabled","duration","easing","setOptions","updateAnimationOptions","lock","unlock","resize","removeByRenderer","newOptions","stopAllAnimations","svg","getRootOffset","onEndAnimation","endAnimation","rect","simpleRect","circle","r","cx","cy","g","image","w","h","preserveAspectRatio","setAttributeNS","path","_text","linearGradient","stops","gradient","pattern","_id","stepTo2","stepBy15","patternUnits","_getPointsWithYOffset","point","clipShape","method","methodArgs","clipPath","shape","clipRect","clipCircle","radius","shadowFilter","offsetX","offsetY","blur","gaussianBlur","in","stdDeviation","dx","dy","flood","composite","in2","operator","finalComposite","filterAttrs","offsetAttrs","floodAttrs","brightFilter","slope","componentTransferElement","getGrayScaleFilter","_grayScaleFilter","values","initHatching","storage","_hatchingStorage","byHash","baseId","refToHash","nextId","ref","hash","getHatchingHash","storageItem","count","callbacks","el","fire","refreshPaths"],"sources":["D:/APPLICATION/UI/UPL/NEW/node_modules/devextreme/esm/viz/core/renderers/renderer.js"],"sourcesContent":["/**\r\n * DevExtreme (esm/viz/core/renderers/renderer.js)\r\n * Version: 22.2.4\r\n * Build date: Thu Jan 19 2023\r\n *\r\n * Copyright (c) 2012 - 2023 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport $ from \"../../../core/renderer\";\r\nimport domAdapter from \"../../../core/dom_adapter\";\r\nimport {\r\n    getWindow\r\n} from \"../../../core/utils/window\";\r\nimport callOnce from \"../../../core/utils/call_once\";\r\nimport eventsEngine from \"../../../events/core/events_engine\";\r\nimport {\r\n    getSvgMarkup\r\n} from \"../../../core/utils/svg\";\r\nimport {\r\n    AnimationController\r\n} from \"./animation\";\r\nimport {\r\n    normalizeBBox,\r\n    rotateBBox,\r\n    normalizeEnum\r\n} from \"../utils\";\r\nimport {\r\n    isDefined\r\n} from \"../../../core/utils/type\";\r\nvar window = getWindow();\r\nvar {\r\n    max: max,\r\n    min: min,\r\n    floor: floor,\r\n    round: round,\r\n    sin: sin,\r\n    cos: cos,\r\n    abs: abs,\r\n    PI: PI\r\n} = Math;\r\nvar PI_DIV_180 = PI / 180;\r\nvar SHARPING_CORRECTION = .5;\r\nvar ARC_COORD_PREC = 5;\r\nvar pxAddingExceptions = {\r\n    \"column-count\": true,\r\n    \"fill-opacity\": true,\r\n    \"flex-grow\": true,\r\n    \"flex-shrink\": true,\r\n    \"font-weight\": true,\r\n    \"line-height\": true,\r\n    opacity: true,\r\n    order: true,\r\n    orphans: true,\r\n    widows: true,\r\n    \"z-index\": true,\r\n    zoom: true\r\n};\r\nvar KEY_TEXT = \"text\";\r\nvar KEY_STROKE = \"stroke\";\r\nvar KEY_STROKE_WIDTH = \"stroke-width\";\r\nvar KEY_STROKE_OPACITY = \"stroke-opacity\";\r\nvar KEY_FONT_SIZE = \"font-size\";\r\nvar KEY_FONT_STYLE = \"font-style\";\r\nvar KEY_FONT_WEIGHT = \"font-weight\";\r\nvar KEY_TEXT_DECORATION = \"text-decoration\";\r\nvar KEY_TEXTS_ALIGNMENT = \"textsAlignment\";\r\nvar NONE = \"none\";\r\nvar DEFAULT_FONT_SIZE = 12;\r\nvar ELLIPSIS = \"...\";\r\nvar objectCreate = function() {\r\n    if (!Object.create) {\r\n        return function(proto) {\r\n            var F = function() {};\r\n            F.prototype = proto;\r\n            return new F\r\n        }\r\n    } else {\r\n        return function(proto) {\r\n            return Object.create(proto)\r\n        }\r\n    }\r\n}();\r\nvar DEFAULTS = {\r\n    scaleX: 1,\r\n    scaleY: 1,\r\n    \"pointer-events\": null\r\n};\r\nvar getBackup = callOnce((function() {\r\n    var backupContainer = domAdapter.createElement(\"div\");\r\n    backupContainer.style.left = \"-9999px\";\r\n    backupContainer.style.position = \"absolute\";\r\n    return {\r\n        backupContainer: backupContainer,\r\n        backupCounter: 0\r\n    }\r\n}));\r\n\r\nfunction backupRoot(root) {\r\n    if (0 === getBackup().backupCounter) {\r\n        domAdapter.getBody().appendChild(getBackup().backupContainer)\r\n    }++getBackup().backupCounter;\r\n    root.append({\r\n        element: getBackup().backupContainer\r\n    })\r\n}\r\n\r\nfunction restoreRoot(root, container) {\r\n    root.append({\r\n        element: container\r\n    });\r\n    --getBackup().backupCounter;\r\n    if (0 === getBackup().backupCounter) {\r\n        domAdapter.getBody().removeChild(getBackup().backupContainer)\r\n    }\r\n}\r\nvar getNextDefsSvgId = function() {\r\n    var numDefsSvgElements = 1;\r\n    return function() {\r\n        return \"DevExpress_\" + numDefsSvgElements++\r\n    }\r\n}();\r\n\r\nfunction isObjectArgument(value) {\r\n    return value && \"string\" !== typeof value\r\n}\r\n\r\nfunction createElement(tagName) {\r\n    return domAdapter.createElementNS(\"http://www.w3.org/2000/svg\", tagName)\r\n}\r\nexport function getFuncIri(id, pathModified) {\r\n    return null !== id ? \"url(\" + (pathModified ? window.location.href.split(\"#\")[0] : \"\") + \"#\" + id + \")\" : id\r\n}\r\n\r\nfunction extend(target, source) {\r\n    var key;\r\n    for (key in source) {\r\n        target[key] = source[key]\r\n    }\r\n    return target\r\n}\r\n\r\nfunction roundValue(value, exp) {\r\n    value = value.toString().split(\"e\");\r\n    value = round(+(value[0] + \"e\" + (value[1] ? +value[1] + exp : exp)));\r\n    value = value.toString().split(\"e\");\r\n    return +(value[0] + \"e\" + (value[1] ? +value[1] - exp : -exp))\r\n}\r\nvar preserveAspectRatioMap = {\r\n    full: NONE,\r\n    lefttop: \"xMinYMin\",\r\n    leftcenter: \"xMinYMid\",\r\n    leftbottom: \"xMinYMax\",\r\n    centertop: \"xMidYMin\",\r\n    center: \"xMidYMid\",\r\n    centerbottom: \"xMidYMax\",\r\n    righttop: \"xMaxYMin\",\r\n    rightcenter: \"xMaxYMid\",\r\n    rightbottom: \"xMaxYMax\"\r\n};\r\nexport function processHatchingAttrs(element, attrs) {\r\n    if (attrs.hatching && \"none\" !== normalizeEnum(attrs.hatching.direction)) {\r\n        attrs = extend({}, attrs);\r\n        attrs.fill = element._hatching = element.renderer.lockHatching(attrs.fill, attrs.hatching, element._hatching);\r\n        delete attrs.hatching\r\n    } else if (element._hatching) {\r\n        element.renderer.releaseHatching(element._hatching);\r\n        element._hatching = null\r\n    }\r\n    return attrs\r\n}\r\n\r\nfunction normalizeArcParams(x, y, innerR, outerR, startAngle, endAngle) {\r\n    var isCircle;\r\n    var noArc = true;\r\n    var angleDiff = roundValue(endAngle, 3) - roundValue(startAngle, 3);\r\n    if (angleDiff) {\r\n        if (abs(angleDiff) % 360 === 0) {\r\n            startAngle = 0;\r\n            endAngle = 360;\r\n            isCircle = true;\r\n            endAngle -= .01\r\n        }\r\n        if (startAngle > 360) {\r\n            startAngle %= 360\r\n        }\r\n        if (endAngle > 360) {\r\n            endAngle %= 360\r\n        }\r\n        if (startAngle > endAngle) {\r\n            startAngle -= 360\r\n        }\r\n        noArc = false\r\n    }\r\n    startAngle *= PI_DIV_180;\r\n    endAngle *= PI_DIV_180;\r\n    return [x, y, min(outerR, innerR), max(outerR, innerR), cos(startAngle), sin(startAngle), cos(endAngle), sin(endAngle), isCircle, floor(abs(endAngle - startAngle) / PI) % 2 ? \"1\" : \"0\", noArc]\r\n}\r\nvar buildArcPath = function(x, y, innerR, outerR, startAngleCos, startAngleSin, endAngleCos, endAngleSin, isCircle, longFlag) {\r\n    return [\"M\", (x + outerR * startAngleCos).toFixed(ARC_COORD_PREC), (y - outerR * startAngleSin).toFixed(ARC_COORD_PREC), \"A\", outerR.toFixed(ARC_COORD_PREC), outerR.toFixed(ARC_COORD_PREC), 0, longFlag, 0, (x + outerR * endAngleCos).toFixed(ARC_COORD_PREC), (y - outerR * endAngleSin).toFixed(ARC_COORD_PREC), isCircle ? \"M\" : \"L\", (x + innerR * endAngleCos).toFixed(5), (y - innerR * endAngleSin).toFixed(ARC_COORD_PREC), \"A\", innerR.toFixed(ARC_COORD_PREC), innerR.toFixed(ARC_COORD_PREC), 0, longFlag, 1, (x + innerR * startAngleCos).toFixed(ARC_COORD_PREC), (y - innerR * startAngleSin).toFixed(ARC_COORD_PREC), \"Z\"].join(\" \")\r\n};\r\n\r\nfunction buildPathSegments(points, type) {\r\n    var list = [\r\n        [\"M\", 0, 0]\r\n    ];\r\n    switch (type) {\r\n        case \"line\":\r\n            list = buildLineSegments(points);\r\n            break;\r\n        case \"area\":\r\n            list = buildLineSegments(points, true);\r\n            break;\r\n        case \"bezier\":\r\n            list = buildCurveSegments(points);\r\n            break;\r\n        case \"bezierarea\":\r\n            list = buildCurveSegments(points, true)\r\n    }\r\n    return list\r\n}\r\n\r\nfunction buildLineSegments(points, close) {\r\n    return buildSegments(points, buildSimpleLineSegment, close)\r\n}\r\n\r\nfunction buildCurveSegments(points, close) {\r\n    return buildSegments(points, buildSimpleCurveSegment, close)\r\n}\r\n\r\nfunction buildSegments(points, buildSimpleSegment, close) {\r\n    var _points$;\r\n    var i;\r\n    var ii;\r\n    var list = [];\r\n    if (null !== (_points$ = points[0]) && void 0 !== _points$ && _points$.length) {\r\n        for (i = 0, ii = points.length; i < ii; ++i) {\r\n            buildSimpleSegment(points[i], close, list)\r\n        }\r\n    } else {\r\n        buildSimpleSegment(points, close, list)\r\n    }\r\n    return list\r\n}\r\n\r\nfunction buildSimpleLineSegment(points, close, list) {\r\n    var i = 0;\r\n    var k0 = list.length;\r\n    var k = k0;\r\n    var ii = (points || []).length;\r\n    if (ii) {\r\n        if (void 0 !== points[0].x) {\r\n            for (; i < ii;) {\r\n                list[k++] = [\"L\", points[i].x, points[i++].y]\r\n            }\r\n        } else {\r\n            for (; i < ii;) {\r\n                list[k++] = [\"L\", points[i++], points[i++]]\r\n            }\r\n        }\r\n        list[k0][0] = \"M\"\r\n    } else {\r\n        list[k] = [\"M\", 0, 0]\r\n    }\r\n    close && list.push([\"Z\"]);\r\n    return list\r\n}\r\n\r\nfunction buildSimpleCurveSegment(points, close, list) {\r\n    var i;\r\n    var k = list.length;\r\n    var ii = (points || []).length;\r\n    if (ii) {\r\n        if (void 0 !== points[0].x) {\r\n            list[k++] = [\"M\", points[0].x, points[0].y];\r\n            for (i = 1; i < ii;) {\r\n                list[k++] = [\"C\", points[i].x, points[i++].y, points[i].x, points[i++].y, points[i].x, points[i++].y]\r\n            }\r\n        } else {\r\n            list[k++] = [\"M\", points[0], points[1]];\r\n            for (i = 2; i < ii;) {\r\n                list[k++] = [\"C\", points[i++], points[i++], points[i++], points[i++], points[i++], points[i++]]\r\n            }\r\n        }\r\n    } else {\r\n        list[k] = [\"M\", 0, 0]\r\n    }\r\n    close && list.push([\"Z\"]);\r\n    return list\r\n}\r\n\r\nfunction combinePathParam(segments) {\r\n    var d = [];\r\n    var k = 0;\r\n    var i;\r\n    var ii = segments.length;\r\n    var segment;\r\n    var j;\r\n    var jj;\r\n    for (i = 0; i < ii; ++i) {\r\n        segment = segments[i];\r\n        for (j = 0, jj = segment.length; j < jj; ++j) {\r\n            d[k++] = segment[j]\r\n        }\r\n    }\r\n    return d.join(\" \")\r\n}\r\n\r\nfunction compensateSegments(oldSegments, newSegments, type) {\r\n    var oldLength = oldSegments.length;\r\n    var newLength = newSegments.length;\r\n    var i;\r\n    var originalNewSegments;\r\n    var makeEqualSegments = -1 !== type.indexOf(\"area\") ? makeEqualAreaSegments : makeEqualLineSegments;\r\n    if (0 === oldLength) {\r\n        for (i = 0; i < newLength; i++) {\r\n            oldSegments.push(newSegments[i].slice(0))\r\n        }\r\n    } else if (oldLength < newLength) {\r\n        makeEqualSegments(oldSegments, newSegments, type)\r\n    } else if (oldLength > newLength) {\r\n        originalNewSegments = newSegments.slice(0);\r\n        makeEqualSegments(newSegments, oldSegments, type)\r\n    }\r\n    return originalNewSegments\r\n}\r\n\r\nfunction prepareConstSegment(constSeg, type) {\r\n    var x = constSeg[constSeg.length - 2];\r\n    var y = constSeg[constSeg.length - 1];\r\n    switch (type) {\r\n        case \"line\":\r\n        case \"area\":\r\n            constSeg[0] = \"L\";\r\n            break;\r\n        case \"bezier\":\r\n        case \"bezierarea\":\r\n            constSeg[0] = \"C\";\r\n            constSeg[1] = constSeg[3] = constSeg[5] = x;\r\n            constSeg[2] = constSeg[4] = constSeg[6] = y\r\n    }\r\n}\r\n\r\nfunction makeEqualLineSegments(short, long, type) {\r\n    var constSeg = short[short.length - 1].slice();\r\n    var i = short.length;\r\n    prepareConstSegment(constSeg, type);\r\n    for (; i < long.length; i++) {\r\n        short[i] = constSeg.slice(0)\r\n    }\r\n}\r\n\r\nfunction makeEqualAreaSegments(short, long, type) {\r\n    var i;\r\n    var head;\r\n    var shortLength = short.length;\r\n    var longLength = long.length;\r\n    var constsSeg1;\r\n    var constsSeg2;\r\n    if ((shortLength - 1) % 2 === 0 && (longLength - 1) % 2 === 0) {\r\n        i = (shortLength - 1) / 2 - 1;\r\n        head = short.slice(0, i + 1);\r\n        constsSeg1 = head[head.length - 1].slice(0);\r\n        constsSeg2 = short.slice(i + 1)[0].slice(0);\r\n        prepareConstSegment(constsSeg1, type);\r\n        prepareConstSegment(constsSeg2, type);\r\n        for (var j = i; j < (longLength - 1) / 2 - 1; j++) {\r\n            short.splice(j + 1, 0, constsSeg1);\r\n            short.splice(j + 3, 0, constsSeg2)\r\n        }\r\n    }\r\n}\r\n\r\nfunction baseCss(that, styles) {\r\n    var elemStyles = that._styles;\r\n    var key;\r\n    var value;\r\n    styles = styles || {};\r\n    for (key in styles) {\r\n        value = styles[key];\r\n        if (isDefined(value)) {\r\n            value += \"number\" === typeof value && !pxAddingExceptions[key] ? \"px\" : \"\";\r\n            elemStyles[key] = \"\" !== value ? value : null\r\n        }\r\n    }\r\n    for (key in elemStyles) {\r\n        value = elemStyles[key];\r\n        if (value) {\r\n            that.element.style[key] = value\r\n        } else if (null === value) {\r\n            that.element.style[key] = \"\"\r\n        }\r\n    }\r\n    return that\r\n}\r\n\r\nfunction fixFuncIri(wrapper, attribute) {\r\n    var element = wrapper.element;\r\n    var id = wrapper.attr(attribute);\r\n    if (id && -1 !== id.indexOf(\"DevExpress\")) {\r\n        element.removeAttribute(attribute);\r\n        element.setAttribute(attribute, getFuncIri(id, wrapper.renderer.pathModified))\r\n    }\r\n}\r\n\r\nfunction baseAttr(that, attrs) {\r\n    attrs = attrs || {};\r\n    var settings = that._settings;\r\n    var attributes = {};\r\n    var key;\r\n    var value;\r\n    var elem = that.element;\r\n    var renderer = that.renderer;\r\n    var rtl = renderer.rtl;\r\n    var hasTransformations;\r\n    var recalculateDashStyle;\r\n    var sw;\r\n    var i;\r\n    if (!isObjectArgument(attrs)) {\r\n        if (attrs in settings) {\r\n            return settings[attrs]\r\n        }\r\n        if (attrs in DEFAULTS) {\r\n            return DEFAULTS[attrs]\r\n        }\r\n        return 0\r\n    }\r\n    extend(attributes, attrs);\r\n    for (key in attributes) {\r\n        value = attributes[key];\r\n        if (void 0 === value) {\r\n            continue\r\n        }\r\n        settings[key] = value;\r\n        if (\"align\" === key) {\r\n            key = \"text-anchor\";\r\n            value = {\r\n                left: rtl ? \"end\" : \"start\",\r\n                center: \"middle\",\r\n                right: rtl ? \"start\" : \"end\"\r\n            } [value] || null\r\n        } else if (\"dashStyle\" === key) {\r\n            recalculateDashStyle = true;\r\n            continue\r\n        } else if (key === KEY_STROKE_WIDTH) {\r\n            recalculateDashStyle = true\r\n        } else if (value && (\"fill\" === key || \"clip-path\" === key || \"filter\" === key) && 0 === value.indexOf(\"DevExpress\")) {\r\n            that._addFixIRICallback();\r\n            value = getFuncIri(value, renderer.pathModified)\r\n        } else if (/^(translate(X|Y)|rotate[XY]?|scale(X|Y)|sharp|sharpDirection)$/i.test(key)) {\r\n            hasTransformations = true;\r\n            continue\r\n        } else if (/^(x|y|d)$/i.test(key)) {\r\n            hasTransformations = true\r\n        }\r\n        if (null === value) {\r\n            elem.removeAttribute(key)\r\n        } else {\r\n            elem.setAttribute(key, value)\r\n        }\r\n    }\r\n    if (recalculateDashStyle && \"dashStyle\" in settings) {\r\n        value = settings.dashStyle;\r\n        sw = (\"_originalSW\" in that ? that._originalSW : settings[KEY_STROKE_WIDTH]) || 1;\r\n        key = \"stroke-dasharray\";\r\n        value = null === value ? \"\" : normalizeEnum(value);\r\n        if (\"\" === value || \"solid\" === value || value === NONE) {\r\n            that.element.removeAttribute(key)\r\n        } else {\r\n            value = value.replace(/longdash/g, \"8,3,\").replace(/dash/g, \"4,3,\").replace(/dot/g, \"1,3,\").replace(/,$/, \"\").split(\",\");\r\n            i = value.length;\r\n            while (i--) {\r\n                value[i] = parseInt(value[i]) * sw\r\n            }\r\n            that.element.setAttribute(key, value.join(\",\"))\r\n        }\r\n    }\r\n    if (hasTransformations) {\r\n        that._applyTransformation()\r\n    }\r\n    return that\r\n}\r\n\r\nfunction pathAttr(attrs) {\r\n    var segments;\r\n    if (isObjectArgument(attrs)) {\r\n        attrs = extend({}, attrs);\r\n        segments = attrs.segments;\r\n        if (\"points\" in attrs) {\r\n            segments = buildPathSegments(attrs.points, this.type);\r\n            delete attrs.points\r\n        }\r\n        if (segments) {\r\n            attrs.d = combinePathParam(segments);\r\n            this.segments = segments;\r\n            delete attrs.segments\r\n        }\r\n    }\r\n    return baseAttr(this, attrs)\r\n}\r\n\r\nfunction arcAttr(attrs) {\r\n    var settings = this._settings;\r\n    var x;\r\n    var y;\r\n    var innerRadius;\r\n    var outerRadius;\r\n    var startAngle;\r\n    var endAngle;\r\n    if (isObjectArgument(attrs)) {\r\n        attrs = extend({}, attrs);\r\n        if (\"x\" in attrs || \"y\" in attrs || \"innerRadius\" in attrs || \"outerRadius\" in attrs || \"startAngle\" in attrs || \"endAngle\" in attrs) {\r\n            settings.x = x = \"x\" in attrs ? attrs.x : settings.x;\r\n            delete attrs.x;\r\n            settings.y = y = \"y\" in attrs ? attrs.y : settings.y;\r\n            delete attrs.y;\r\n            settings.innerRadius = innerRadius = \"innerRadius\" in attrs ? attrs.innerRadius : settings.innerRadius;\r\n            delete attrs.innerRadius;\r\n            settings.outerRadius = outerRadius = \"outerRadius\" in attrs ? attrs.outerRadius : settings.outerRadius;\r\n            delete attrs.outerRadius;\r\n            settings.startAngle = startAngle = \"startAngle\" in attrs ? attrs.startAngle : settings.startAngle;\r\n            delete attrs.startAngle;\r\n            settings.endAngle = endAngle = \"endAngle\" in attrs ? attrs.endAngle : settings.endAngle;\r\n            delete attrs.endAngle;\r\n            attrs.d = buildArcPath.apply(null, normalizeArcParams(x, y, innerRadius, outerRadius, startAngle, endAngle))\r\n        }\r\n    }\r\n    return baseAttr(this, attrs)\r\n}\r\n\r\nfunction rectAttr(attrs) {\r\n    var x;\r\n    var y;\r\n    var width;\r\n    var height;\r\n    var sw;\r\n    var maxSW;\r\n    var newSW;\r\n    if (isObjectArgument(attrs)) {\r\n        attrs = extend({}, attrs);\r\n        if (void 0 !== attrs.x || void 0 !== attrs.y || void 0 !== attrs.width || void 0 !== attrs.height || void 0 !== attrs[KEY_STROKE_WIDTH]) {\r\n            void 0 !== attrs.x ? x = this._originalX = attrs.x : x = this._originalX || 0;\r\n            void 0 !== attrs.y ? y = this._originalY = attrs.y : y = this._originalY || 0;\r\n            void 0 !== attrs.width ? width = this._originalWidth = attrs.width : width = this._originalWidth || 0;\r\n            void 0 !== attrs.height ? height = this._originalHeight = attrs.height : height = this._originalHeight || 0;\r\n            void 0 !== attrs[KEY_STROKE_WIDTH] ? sw = this._originalSW = attrs[KEY_STROKE_WIDTH] : sw = this._originalSW;\r\n            maxSW = ~~((width < height ? width : height) / 2);\r\n            newSW = (sw || 0) < maxSW ? sw || 0 : maxSW;\r\n            attrs.x = x + newSW / 2;\r\n            attrs.y = y + newSW / 2;\r\n            attrs.width = width - newSW;\r\n            attrs.height = height - newSW;\r\n            ((sw || 0) !== newSW || !(0 === newSW && void 0 === sw)) && (attrs[KEY_STROKE_WIDTH] = newSW)\r\n        }\r\n        if (\"sharp\" in attrs) {\r\n            delete attrs.sharp\r\n        }\r\n    }\r\n    return baseAttr(this, attrs)\r\n}\r\n\r\nfunction textAttr(attrs) {\r\n    var isResetRequired;\r\n    if (!isObjectArgument(attrs)) {\r\n        return baseAttr(this, attrs)\r\n    }\r\n    attrs = extend({}, attrs);\r\n    var settings = this._settings;\r\n    var wasStroked = isDefined(settings[KEY_STROKE]) && isDefined(settings[KEY_STROKE_WIDTH]);\r\n    if (void 0 !== attrs[KEY_TEXT]) {\r\n        settings[KEY_TEXT] = attrs[KEY_TEXT];\r\n        delete attrs[KEY_TEXT];\r\n        isResetRequired = true\r\n    }\r\n    if (void 0 !== attrs[KEY_STROKE]) {\r\n        settings[KEY_STROKE] = attrs[KEY_STROKE];\r\n        delete attrs[KEY_STROKE]\r\n    }\r\n    if (void 0 !== attrs[KEY_STROKE_WIDTH]) {\r\n        settings[KEY_STROKE_WIDTH] = attrs[KEY_STROKE_WIDTH];\r\n        delete attrs[KEY_STROKE_WIDTH]\r\n    }\r\n    if (void 0 !== attrs[KEY_STROKE_OPACITY]) {\r\n        settings[KEY_STROKE_OPACITY] = attrs[KEY_STROKE_OPACITY];\r\n        delete attrs[KEY_STROKE_OPACITY]\r\n    }\r\n    if (void 0 !== attrs[KEY_TEXTS_ALIGNMENT]) {\r\n        alignTextNodes(this, attrs[KEY_TEXTS_ALIGNMENT]);\r\n        delete attrs[KEY_TEXTS_ALIGNMENT]\r\n    }\r\n    var isStroked = isDefined(settings[KEY_STROKE]) && isDefined(settings[KEY_STROKE_WIDTH]);\r\n    baseAttr(this, attrs);\r\n    isResetRequired = isResetRequired || isStroked !== wasStroked && settings[KEY_TEXT];\r\n    if (isResetRequired) {\r\n        createTextNodes(this, settings.text, isStroked);\r\n        this._hasEllipsis = false\r\n    }\r\n    if (isResetRequired || void 0 !== attrs.x || void 0 !== attrs.y) {\r\n        locateTextNodes(this)\r\n    }\r\n    if (isStroked) {\r\n        strokeTextNodes(this)\r\n    }\r\n    return this\r\n}\r\n\r\nfunction textCss(styles) {\r\n    styles = styles || {};\r\n    baseCss(this, styles);\r\n    if (KEY_FONT_SIZE in styles) {\r\n        locateTextNodes(this)\r\n    }\r\n    return this\r\n}\r\n\r\nfunction orderHtmlTree(list, line, node, parentStyle, parentClassName) {\r\n    var style;\r\n    var realStyle;\r\n    var i;\r\n    var ii;\r\n    var nodes;\r\n    if (void 0 !== node.wholeText) {\r\n        list.push({\r\n            value: node.wholeText,\r\n            style: parentStyle,\r\n            className: parentClassName,\r\n            line: line,\r\n            height: parentStyle[KEY_FONT_SIZE] || 0\r\n        })\r\n    } else if (\"BR\" === node.tagName) {\r\n        ++line\r\n    } else if (domAdapter.isElementNode(node)) {\r\n        extend(style = {}, parentStyle);\r\n        switch (node.tagName) {\r\n            case \"B\":\r\n            case \"STRONG\":\r\n                style[KEY_FONT_WEIGHT] = \"bold\";\r\n                break;\r\n            case \"I\":\r\n            case \"EM\":\r\n                style[KEY_FONT_STYLE] = \"italic\";\r\n                break;\r\n            case \"U\":\r\n                style[KEY_TEXT_DECORATION] = \"underline\"\r\n        }\r\n        realStyle = node.style;\r\n        realStyle.color && (style.fill = realStyle.color);\r\n        realStyle.fontSize && (style[KEY_FONT_SIZE] = realStyle.fontSize);\r\n        realStyle.fontStyle && (style[KEY_FONT_STYLE] = realStyle.fontStyle);\r\n        realStyle.fontWeight && (style[KEY_FONT_WEIGHT] = realStyle.fontWeight);\r\n        realStyle.textDecoration && (style[KEY_TEXT_DECORATION] = realStyle.textDecoration);\r\n        for (i = 0, nodes = node.childNodes, ii = nodes.length; i < ii; ++i) {\r\n            line = orderHtmlTree(list, line, nodes[i], style, node.className || parentClassName)\r\n        }\r\n    }\r\n    return line\r\n}\r\n\r\nfunction adjustLineHeights(items) {\r\n    var i;\r\n    var ii;\r\n    var currentItem = items[0];\r\n    var item;\r\n    for (i = 1, ii = items.length; i < ii; ++i) {\r\n        item = items[i];\r\n        if (item.line === currentItem.line) {\r\n            currentItem.height = maxLengthFontSize(currentItem.height, item.height);\r\n            currentItem.inherits = currentItem.inherits || 0 === parseFloat(item.height);\r\n            item.height = NaN\r\n        } else {\r\n            currentItem = item\r\n        }\r\n    }\r\n}\r\n\r\nfunction removeExtraAttrs(html) {\r\n    var findStyleAndClassAttrs = /(style|class)\\s*=\\s*([\"'])(?:(?!\\2).)*\\2\\s?/gi;\r\n    return html.replace(/(?:(<[a-z0-9]+\\s*))([\\s\\S]*?)(>|\\/>)/gi, (function(allTagAttrs, p1, p2, p3) {\r\n        p2 = (p2 && p2.match(findStyleAndClassAttrs) || []).map((function(str) {\r\n            return str\r\n        })).join(\" \");\r\n        return p1 + p2 + p3\r\n    }))\r\n}\r\n\r\nfunction parseHTML(text) {\r\n    var items = [];\r\n    var div = domAdapter.createElement(\"div\");\r\n    div.innerHTML = text.replace(/\\r/g, \"\").replace(/\\n/g, \"<br/>\");\r\n    orderHtmlTree(items, 0, div, {}, \"\");\r\n    adjustLineHeights(items);\r\n    return items\r\n}\r\n\r\nfunction parseMultiline(text) {\r\n    var texts = text.replace(/\\r/g, \"\").split(/\\n/g);\r\n    var i = 0;\r\n    var items = [];\r\n    for (; i < texts.length; i++) {\r\n        items.push({\r\n            value: texts[i].trim(),\r\n            height: 0,\r\n            line: i\r\n        })\r\n    }\r\n    return items\r\n}\r\n\r\nfunction createTspans(items, element, fieldName) {\r\n    var i;\r\n    var ii;\r\n    var item;\r\n    for (i = 0, ii = items.length; i < ii; ++i) {\r\n        item = items[i];\r\n        item[fieldName] = createElement(\"tspan\");\r\n        item[fieldName].appendChild(domAdapter.createTextNode(item.value));\r\n        item.style && baseCss({\r\n            element: item[fieldName],\r\n            _styles: {}\r\n        }, item.style);\r\n        item.className && item[fieldName].setAttribute(\"class\", item.className);\r\n        element.appendChild(item[fieldName])\r\n    }\r\n}\r\n\r\nfunction restoreText() {\r\n    if (this._hasEllipsis) {\r\n        this.attr({\r\n            text: this._settings.text\r\n        })\r\n    }\r\n}\r\n\r\nfunction applyEllipsis(maxWidth) {\r\n    var lines;\r\n    var hasEllipsis = false;\r\n    var i;\r\n    var ii;\r\n    var lineParts;\r\n    var j;\r\n    var jj;\r\n    var text;\r\n    restoreText.call(this);\r\n    var ellipsis = this.renderer.text(ELLIPSIS).attr(this._styles).append(this.renderer.root);\r\n    var ellipsisWidth = ellipsis.getBBox().width;\r\n    if (this._getElementBBox().width > maxWidth) {\r\n        if (maxWidth - ellipsisWidth < 0) {\r\n            maxWidth = 0\r\n        } else {\r\n            maxWidth -= ellipsisWidth\r\n        }\r\n        lines = prepareLines(this.element, this._texts, maxWidth);\r\n        for (i = 0, ii = lines.length; i < ii; ++i) {\r\n            lineParts = lines[i].parts;\r\n            if (1 === lines[i].commonLength) {\r\n                continue\r\n            }\r\n            for (j = 0, jj = lineParts.length; j < jj; ++j) {\r\n                text = lineParts[j];\r\n                if (isDefined(text.endIndex)) {\r\n                    setNewText(text, text.endIndex);\r\n                    hasEllipsis = true\r\n                } else if (text.startBox > maxWidth) {\r\n                    removeTextSpan(text)\r\n                }\r\n            }\r\n        }\r\n    }\r\n    ellipsis.remove();\r\n    this._hasEllipsis = hasEllipsis;\r\n    return hasEllipsis\r\n}\r\n\r\nfunction cloneAndRemoveAttrs(node) {\r\n    var clone;\r\n    if (node) {\r\n        clone = node.cloneNode();\r\n        clone.removeAttribute(\"y\");\r\n        clone.removeAttribute(\"x\")\r\n    }\r\n    return clone || node\r\n}\r\n\r\nfunction detachTitleElements(element) {\r\n    var titleElements = domAdapter.querySelectorAll(element, \"title\");\r\n    for (var i = 0; i < titleElements.length; i++) {\r\n        element.removeChild(titleElements[i])\r\n    }\r\n    return titleElements\r\n}\r\n\r\nfunction detachAndStoreTitleElements(element) {\r\n    var titleElements = detachTitleElements(element);\r\n    return () => {\r\n        for (var i = 0; i < titleElements.length; i++) {\r\n            element.appendChild(titleElements[i])\r\n        }\r\n    }\r\n}\r\n\r\nfunction setMaxSize(maxWidth, maxHeight) {\r\n    var options = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {};\r\n    var that = this;\r\n    var lines = [];\r\n    var textChanged = false;\r\n    var textIsEmpty = false;\r\n    var ellipsisMaxWidth = maxWidth;\r\n    restoreText.call(that);\r\n    var restoreTitleElement = detachAndStoreTitleElements(this.element);\r\n    var ellipsis = that.renderer.text(ELLIPSIS).attr(that._styles).append(that.renderer.root);\r\n    var ellipsisWidth = ellipsis.getBBox().width;\r\n    var {\r\n        width: width,\r\n        height: height\r\n    } = that._getElementBBox();\r\n    if ((width || height) && (width > maxWidth || maxHeight && height > maxHeight)) {\r\n        if (maxWidth - ellipsisWidth < 0) {\r\n            ellipsisMaxWidth = 0\r\n        } else {\r\n            ellipsisMaxWidth -= ellipsisWidth\r\n        }\r\n        lines = applyOverflowRules(that.element, that._texts, maxWidth, ellipsisMaxWidth, options);\r\n        lines = setMaxHeight(lines, ellipsisMaxWidth, options, maxHeight, parseFloat(this._getLineHeight()));\r\n        this._texts = lines.reduce((texts, line) => texts.concat(line.parts), []).filter(t => \"\" !== t.value).map(t => {\r\n            t.stroke && t.tspan.parentNode.appendChild(t.stroke);\r\n            return t\r\n        }).map(t => {\r\n            t.tspan.parentNode.appendChild(t.tspan);\r\n            return t\r\n        });\r\n        !this._texts.length && (this._texts = null);\r\n        textChanged = true;\r\n        if (this._texts) {\r\n            locateTextNodes(this)\r\n        } else {\r\n            this.element.textContent = \"\";\r\n            textIsEmpty = true\r\n        }\r\n    }\r\n    ellipsis.remove();\r\n    that._hasEllipsis = textChanged;\r\n    restoreTitleElement();\r\n    return {\r\n        rowCount: lines.length,\r\n        textChanged: textChanged,\r\n        textIsEmpty: textIsEmpty\r\n    }\r\n}\r\n\r\nfunction getIndexForEllipsis(text, maxWidth, startBox, endBox) {\r\n    var k;\r\n    var kk;\r\n    if (startBox <= maxWidth && endBox > maxWidth) {\r\n        for (k = 1, kk = text.value.length; k <= kk; ++k) {\r\n            if (startBox + text.tspan.getSubStringLength(0, k) > maxWidth) {\r\n                return k - 1\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction getTextWidth(text) {\r\n    return text.value.length ? text.tspan.getSubStringLength(0, text.value.length) : 0\r\n}\r\n\r\nfunction prepareLines(element, texts, maxWidth) {\r\n    var lines = [];\r\n    var i;\r\n    var ii;\r\n    var text;\r\n    var startBox;\r\n    var endBox;\r\n    if (texts) {\r\n        for (i = 0, ii = texts.length; i < ii; ++i) {\r\n            text = texts[i];\r\n            if (!lines[text.line]) {\r\n                text.startBox = startBox = 0;\r\n                lines.push({\r\n                    commonLength: text.value.length,\r\n                    parts: [text]\r\n                })\r\n            } else {\r\n                text.startBox = startBox;\r\n                lines[text.line].parts.push(text);\r\n                lines[text.line].commonLength += text.value.length\r\n            }\r\n            endBox = startBox + text.tspan.getSubStringLength(0, text.value.length);\r\n            text.endIndex = getIndexForEllipsis(text, maxWidth, startBox, endBox);\r\n            startBox = endBox\r\n        }\r\n    } else {\r\n        text = {\r\n            value: element.textContent,\r\n            tspan: element\r\n        };\r\n        text.startBox = startBox = 0;\r\n        endBox = startBox + getTextWidth(text);\r\n        text.endIndex = getIndexForEllipsis(text, maxWidth, startBox, endBox);\r\n        lines = [{\r\n            commonLength: element.textContent.length,\r\n            parts: [text]\r\n        }]\r\n    }\r\n    return lines\r\n}\r\n\r\nfunction getSpaceBreakIndex(text, maxWidth) {\r\n    var initialIndices = text.startBox > 0 ? [0] : [];\r\n    var spaceIndices = text.value.split(\"\").reduce((indices, char, index) => {\r\n        if (\" \" === char) {\r\n            indices.push(index)\r\n        }\r\n        return indices\r\n    }, initialIndices);\r\n    var spaceIndex = 0;\r\n    while (void 0 !== spaceIndices[spaceIndex + 1] && text.startBox + text.tspan.getSubStringLength(0, spaceIndices[spaceIndex + 1]) < maxWidth) {\r\n        spaceIndex++\r\n    }\r\n    return spaceIndices[spaceIndex]\r\n}\r\n\r\nfunction getWordBreakIndex(text, maxWidth) {\r\n    for (var i = 0; i < text.value.length - 1; i++) {\r\n        if (text.startBox + text.tspan.getSubStringLength(0, i + 1) > maxWidth) {\r\n            return i\r\n        }\r\n    }\r\n}\r\n\r\nfunction getEllipsisString(ellipsisMaxWidth, _ref) {\r\n    var {\r\n        hideOverflowEllipsis: hideOverflowEllipsis\r\n    } = _ref;\r\n    return hideOverflowEllipsis && 0 === ellipsisMaxWidth ? \"\" : ELLIPSIS\r\n}\r\n\r\nfunction setEllipsis(text, ellipsisMaxWidth, options) {\r\n    var ellipsis = getEllipsisString(ellipsisMaxWidth, options);\r\n    if (text.value.length && text.tspan.parentNode) {\r\n        for (var i = text.value.length - 1; i >= 1; i--) {\r\n            if (text.startBox + text.tspan.getSubStringLength(0, i) < ellipsisMaxWidth) {\r\n                setNewText(text, i, ellipsis);\r\n                break\r\n            } else if (1 === i) {\r\n                setNewText(text, 0, ellipsis)\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction wordWrap(text, maxWidth, ellipsisMaxWidth, options, lastStepBreakIndex) {\r\n    var wholeText = text.value;\r\n    var breakIndex;\r\n    if (\"none\" !== options.wordWrap) {\r\n        breakIndex = \"normal\" === options.wordWrap ? getSpaceBreakIndex(text, maxWidth) : getWordBreakIndex(text, maxWidth)\r\n    }\r\n    var restLines = [];\r\n    var restText;\r\n    if (isFinite(breakIndex) && !(0 === lastStepBreakIndex && 0 === breakIndex)) {\r\n        setNewText(text, breakIndex, \"\");\r\n        var newTextOffset = \" \" === wholeText[breakIndex] ? 1 : 0;\r\n        var restString = wholeText.slice(breakIndex + newTextOffset);\r\n        if (restString.length) {\r\n            var restTspan = cloneAndRemoveAttrs(text.tspan);\r\n            restTspan.textContent = restString;\r\n            text.tspan.parentNode.appendChild(restTspan);\r\n            restText = extend(extend({}, text), {\r\n                value: restString,\r\n                startBox: 0,\r\n                height: 0,\r\n                tspan: restTspan,\r\n                stroke: cloneAndRemoveAttrs(text.stroke),\r\n                endBox: restTspan.getSubStringLength(0, restString.length)\r\n            });\r\n            restText.stroke && (restText.stroke.textContent = restString);\r\n            if (restText.endBox > maxWidth) {\r\n                restLines = wordWrap(restText, maxWidth, ellipsisMaxWidth, options, breakIndex);\r\n                if (!restLines.length) {\r\n                    return []\r\n                }\r\n            }\r\n        }\r\n    }\r\n    if (text.value.length) {\r\n        if (\"ellipsis\" === options.textOverflow && text.tspan.getSubStringLength(0, text.value.length) > maxWidth) {\r\n            setEllipsis(text, ellipsisMaxWidth, options)\r\n        }\r\n        if (\"hide\" === options.textOverflow && text.tspan.getSubStringLength(0, text.value.length) > maxWidth) {\r\n            return []\r\n        }\r\n    } else {\r\n        text.tspan.parentNode.removeChild(text.tspan)\r\n    }\r\n    var parts = [];\r\n    if (restText) {\r\n        parts.push(restText)\r\n    }\r\n    return [{\r\n        commonLength: wholeText.length,\r\n        parts: parts\r\n    }].concat(restLines)\r\n}\r\n\r\nfunction calculateLineHeight(line, lineHeight) {\r\n    return line.parts.reduce((height, text) => max(height, getItemLineHeight(text, lineHeight)), 0)\r\n}\r\n\r\nfunction setMaxHeight(lines, ellipsisMaxWidth, options, maxHeight, lineHeight) {\r\n    var textOverflow = options.textOverflow;\r\n    if (!isFinite(maxHeight) || 0 === Number(maxHeight) || \"none\" === textOverflow) {\r\n        return lines\r\n    }\r\n    var result = lines.reduce((_ref2, l, index, arr) => {\r\n        var [lines, commonHeight] = _ref2;\r\n        var height = calculateLineHeight(l, lineHeight);\r\n        commonHeight += height;\r\n        if (commonHeight < maxHeight) {\r\n            lines.push(l)\r\n        } else {\r\n            l.parts.forEach(item => {\r\n                removeTextSpan(item)\r\n            });\r\n            if (\"ellipsis\" === textOverflow) {\r\n                var prevLine = arr[index - 1];\r\n                if (prevLine) {\r\n                    var text = prevLine.parts[prevLine.parts.length - 1];\r\n                    if (!text.hasEllipsis) {\r\n                        if (0 === ellipsisMaxWidth || text.endBox < ellipsisMaxWidth) {\r\n                            setNewText(text, text.value.length, getEllipsisString(ellipsisMaxWidth, options))\r\n                        } else {\r\n                            setEllipsis(text, ellipsisMaxWidth, options)\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return [lines, commonHeight]\r\n    }, [\r\n        [], 0\r\n    ]);\r\n    if (\"hide\" === textOverflow && result[1] > maxHeight) {\r\n        result[0].forEach(l => {\r\n            l.parts.forEach(item => {\r\n                removeTextSpan(item)\r\n            })\r\n        });\r\n        return []\r\n    }\r\n    return result[0]\r\n}\r\n\r\nfunction applyOverflowRules(element, texts, maxWidth, ellipsisMaxWidth, options) {\r\n    if (!texts) {\r\n        var textValue = element.textContent;\r\n        var text = {\r\n            value: textValue,\r\n            height: 0,\r\n            line: 0\r\n        };\r\n        element.textContent = \"\";\r\n        createTspans([text], element, \"tspan\");\r\n        texts = [text]\r\n    }\r\n    return texts.reduce((_ref3, text) => {\r\n        var [lines, startBox, endBox, stop, lineNumber] = _ref3;\r\n        var line = lines[lines.length - 1];\r\n        if (stop) {\r\n            return [lines, startBox, endBox, stop]\r\n        }\r\n        if (!line || text.line !== lineNumber) {\r\n            text.startBox = startBox = 0;\r\n            lines.push({\r\n                commonLength: text.value.length,\r\n                parts: [text]\r\n            })\r\n        } else {\r\n            text.startBox = startBox;\r\n            if (startBox > ellipsisMaxWidth && \"none\" === options.wordWrap && \"ellipsis\" === options.textOverflow) {\r\n                removeTextSpan(text);\r\n                return [lines, startBox, endBox, stop, lineNumber]\r\n            }\r\n            line.parts.push(text);\r\n            line.commonLength += text.value.length\r\n        }\r\n        text.endBox = endBox = startBox + getTextWidth(text);\r\n        startBox = endBox;\r\n        if (isDefined(maxWidth) && endBox > maxWidth) {\r\n            var wordWrapLines = wordWrap(text, maxWidth, ellipsisMaxWidth, options);\r\n            if (!wordWrapLines.length) {\r\n                lines = [];\r\n                stop = true\r\n            } else {\r\n                lines = lines.concat(wordWrapLines.filter(l => l.parts.length > 0))\r\n            }\r\n        }\r\n        return [lines, startBox, endBox, stop, text.line]\r\n    }, [\r\n        [], 0, 0, false, 0\r\n    ])[0]\r\n}\r\n\r\nfunction setNewText(text, index) {\r\n    var insertString = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : ELLIPSIS;\r\n    var newText = text.value.substr(0, index) + insertString;\r\n    text.value = text.tspan.textContent = newText;\r\n    text.stroke && (text.stroke.textContent = newText);\r\n    if (insertString === ELLIPSIS) {\r\n        text.hasEllipsis = true\r\n    }\r\n}\r\n\r\nfunction removeTextSpan(text) {\r\n    text.tspan.parentNode && text.tspan.parentNode.removeChild(text.tspan);\r\n    text.stroke && text.stroke.parentNode && text.stroke.parentNode.removeChild(text.stroke)\r\n}\r\n\r\nfunction createTextNodes(wrapper, text, isStroked) {\r\n    var items;\r\n    var parsedHtml;\r\n    wrapper._texts = null;\r\n    wrapper.clear();\r\n    if (null === text) {\r\n        return\r\n    }\r\n    text = \"\" + text;\r\n    if (!wrapper.renderer.encodeHtml && (/<[a-z][\\s\\S]*>/i.test(text) || -1 !== text.indexOf(\"&\"))) {\r\n        parsedHtml = removeExtraAttrs(text);\r\n        items = parseHTML(parsedHtml)\r\n    } else if (/\\n/g.test(text)) {\r\n        items = parseMultiline(text)\r\n    } else if (isStroked) {\r\n        items = [{\r\n            value: text.trim(),\r\n            height: 0\r\n        }]\r\n    }\r\n    if (items) {\r\n        if (items.length) {\r\n            wrapper._texts = items;\r\n            if (isStroked) {\r\n                createTspans(items, wrapper.element, KEY_STROKE)\r\n            }\r\n            createTspans(items, wrapper.element, \"tspan\")\r\n        }\r\n    } else {\r\n        wrapper.element.appendChild(domAdapter.createTextNode(text))\r\n    }\r\n}\r\n\r\nfunction setTextNodeAttribute(item, name, value) {\r\n    item.tspan.setAttribute(name, value);\r\n    item.stroke && item.stroke.setAttribute(name, value)\r\n}\r\n\r\nfunction getItemLineHeight(item, defaultValue) {\r\n    return item.inherits ? maxLengthFontSize(item.height, defaultValue) : item.height || defaultValue\r\n}\r\n\r\nfunction locateTextNodes(wrapper) {\r\n    if (!wrapper._texts) {\r\n        return\r\n    }\r\n    var items = wrapper._texts;\r\n    var x = wrapper._settings.x;\r\n    var lineHeight = wrapper._getLineHeight();\r\n    var i;\r\n    var ii;\r\n    var item = items[0];\r\n    setTextNodeAttribute(item, \"x\", x);\r\n    setTextNodeAttribute(item, \"y\", wrapper._settings.y);\r\n    for (i = 1, ii = items.length; i < ii; ++i) {\r\n        item = items[i];\r\n        if (parseFloat(item.height) >= 0) {\r\n            setTextNodeAttribute(item, \"x\", x);\r\n            var height = getItemLineHeight(item, lineHeight);\r\n            setTextNodeAttribute(item, \"dy\", height)\r\n        }\r\n    }\r\n}\r\n\r\nfunction alignTextNodes(wrapper, alignment) {\r\n    if (!wrapper._texts || \"center\" === alignment) {\r\n        return\r\n    }\r\n    var items = wrapper._texts;\r\n    var direction = \"left\" === alignment ? -1 : 1;\r\n    var maxTextWidth = Math.max.apply(Math, items.map(t => getTextWidth(t)));\r\n    for (var i = 0; i < items.length; i++) {\r\n        var item = items[i];\r\n        var textWidth = getTextWidth(item);\r\n        if (0 !== maxTextWidth && maxTextWidth !== textWidth) {\r\n            setTextNodeAttribute(item, \"dx\", direction * round((maxTextWidth - textWidth) / 2 * 10) / 10)\r\n        }\r\n    }\r\n}\r\n\r\nfunction maxLengthFontSize(fontSize1, fontSize2) {\r\n    var parsedHeight1 = parseFloat(fontSize1);\r\n    var parsedHeight2 = parseFloat(fontSize2);\r\n    var height1 = parsedHeight1 || DEFAULT_FONT_SIZE;\r\n    var height2 = parsedHeight2 || DEFAULT_FONT_SIZE;\r\n    return height1 > height2 ? !isNaN(parsedHeight1) ? fontSize1 : height1 : !isNaN(parsedHeight2) ? fontSize2 : height2\r\n}\r\n\r\nfunction strokeTextNodes(wrapper) {\r\n    if (!wrapper._texts) {\r\n        return\r\n    }\r\n    var items = wrapper._texts;\r\n    var stroke = wrapper._settings[KEY_STROKE];\r\n    var strokeWidth = wrapper._settings[KEY_STROKE_WIDTH];\r\n    var strokeOpacity = wrapper._settings[KEY_STROKE_OPACITY] || 1;\r\n    var tspan;\r\n    var i;\r\n    var ii;\r\n    for (i = 0, ii = items.length; i < ii; ++i) {\r\n        tspan = items[i].stroke;\r\n        tspan.setAttribute(KEY_STROKE, stroke);\r\n        tspan.setAttribute(KEY_STROKE_WIDTH, strokeWidth);\r\n        tspan.setAttribute(KEY_STROKE_OPACITY, strokeOpacity);\r\n        tspan.setAttribute(\"stroke-linejoin\", \"round\")\r\n    }\r\n}\r\n\r\nfunction baseAnimate(that, params, options, complete) {\r\n    options = options || {};\r\n    var key;\r\n    var value;\r\n    var renderer = that.renderer;\r\n    var settings = that._settings;\r\n    var animationParams = {};\r\n    var defaults = {\r\n        translateX: 0,\r\n        translateY: 0,\r\n        scaleX: 1,\r\n        scaleY: 1,\r\n        rotate: 0,\r\n        rotateX: 0,\r\n        rotateY: 0\r\n    };\r\n    if (complete) {\r\n        options.complete = complete\r\n    }\r\n    if (renderer.animationEnabled()) {\r\n        for (key in params) {\r\n            value = params[key];\r\n            if (/^(translate(X|Y)|rotate[XY]?|scale(X|Y))$/i.test(key)) {\r\n                animationParams.transform = animationParams.transform || {\r\n                    from: {},\r\n                    to: {}\r\n                };\r\n                animationParams.transform.from[key] = key in settings ? Number(settings[key].toFixed(3)) : defaults[key];\r\n                animationParams.transform.to[key] = value\r\n            } else if (\"arc\" === key || \"segments\" === key) {\r\n                animationParams[key] = value\r\n            } else {\r\n                animationParams[key] = {\r\n                    from: key in settings ? settings[key] : parseFloat(that.element.getAttribute(key) || 0),\r\n                    to: value\r\n                }\r\n            }\r\n        }\r\n        renderer.animateElement(that, animationParams, extend(extend({}, renderer._animation), options))\r\n    } else {\r\n        options.step && options.step.call(that, 1, 1);\r\n        options.complete && options.complete.call(that);\r\n        that.attr(params)\r\n    }\r\n    return that\r\n}\r\n\r\nfunction pathAnimate(params, options, complete) {\r\n    var curSegments = this.segments || [];\r\n    var newSegments;\r\n    var endSegments;\r\n    if (this.renderer.animationEnabled() && \"points\" in params) {\r\n        newSegments = buildPathSegments(params.points, this.type);\r\n        endSegments = compensateSegments(curSegments, newSegments, this.type);\r\n        params.segments = {\r\n            from: curSegments,\r\n            to: newSegments,\r\n            end: endSegments\r\n        };\r\n        delete params.points\r\n    }\r\n    return baseAnimate(this, params, options, complete)\r\n}\r\n\r\nfunction arcAnimate(params, options, complete) {\r\n    var settings = this._settings;\r\n    var arcParams = {\r\n        from: {},\r\n        to: {}\r\n    };\r\n    if (this.renderer.animationEnabled() && (\"x\" in params || \"y\" in params || \"innerRadius\" in params || \"outerRadius\" in params || \"startAngle\" in params || \"endAngle\" in params)) {\r\n        arcParams.from.x = settings.x || 0;\r\n        arcParams.from.y = settings.y || 0;\r\n        arcParams.from.innerRadius = settings.innerRadius || 0;\r\n        arcParams.from.outerRadius = settings.outerRadius || 0;\r\n        arcParams.from.startAngle = settings.startAngle || 0;\r\n        arcParams.from.endAngle = settings.endAngle || 0;\r\n        arcParams.to.x = \"x\" in params ? params.x : settings.x;\r\n        delete params.x;\r\n        arcParams.to.y = \"y\" in params ? params.y : settings.y;\r\n        delete params.y;\r\n        arcParams.to.innerRadius = \"innerRadius\" in params ? params.innerRadius : settings.innerRadius;\r\n        delete params.innerRadius;\r\n        arcParams.to.outerRadius = \"outerRadius\" in params ? params.outerRadius : settings.outerRadius;\r\n        delete params.outerRadius;\r\n        arcParams.to.startAngle = \"startAngle\" in params ? params.startAngle : settings.startAngle;\r\n        delete params.startAngle;\r\n        arcParams.to.endAngle = \"endAngle\" in params ? params.endAngle : settings.endAngle;\r\n        delete params.endAngle;\r\n        params.arc = arcParams\r\n    }\r\n    return baseAnimate(this, params, options, complete)\r\n}\r\n\r\nfunction buildLink(target, parameters) {\r\n    var obj = {\r\n        is: false,\r\n        name: parameters.name || parameters,\r\n        after: parameters.after\r\n    };\r\n    if (target) {\r\n        obj.to = target\r\n    } else {\r\n        obj.virtual = true\r\n    }\r\n    return obj\r\n}\r\nexport var SvgElement = function(renderer, tagName, type) {\r\n    this.renderer = renderer;\r\n    this.element = createElement(tagName);\r\n    this._settings = {};\r\n    this._styles = {};\r\n    if (\"path\" === tagName) {\r\n        this.type = type || \"line\"\r\n    }\r\n};\r\n\r\nfunction removeFuncIriCallback(callback) {\r\n    fixFuncIriCallbacks.remove(callback)\r\n}\r\nSvgElement.prototype = {\r\n    constructor: SvgElement,\r\n    _getJQElement: function() {\r\n        return this._$element || (this._$element = $(this.element))\r\n    },\r\n    _addFixIRICallback: function() {\r\n        var that = this;\r\n        var fn = function() {\r\n            fixFuncIri(that, \"fill\");\r\n            fixFuncIri(that, \"clip-path\");\r\n            fixFuncIri(that, \"filter\")\r\n        };\r\n        that.element._fixFuncIri = fn;\r\n        fn.renderer = that.renderer;\r\n        fixFuncIriCallbacks.add(fn);\r\n        that._addFixIRICallback = function() {}\r\n    },\r\n    _clearChildrenFuncIri: function() {\r\n        ! function clearChildren(element) {\r\n            var i;\r\n            for (i = 0; i < element.childNodes.length; i++) {\r\n                removeFuncIriCallback(element.childNodes[i]._fixFuncIri);\r\n                clearChildren(element.childNodes[i])\r\n            }\r\n        }(this.element)\r\n    },\r\n    dispose: function() {\r\n        removeFuncIriCallback(this.element._fixFuncIri);\r\n        this._clearChildrenFuncIri();\r\n        this._getJQElement().remove();\r\n        return this\r\n    },\r\n    append: function(parent) {\r\n        (parent || this.renderer.root).element.appendChild(this.element);\r\n        return this\r\n    },\r\n    remove: function() {\r\n        var element = this.element;\r\n        element.parentNode && element.parentNode.removeChild(element);\r\n        return this\r\n    },\r\n    enableLinks: function() {\r\n        this._links = [];\r\n        return this\r\n    },\r\n    virtualLink: function(parameters) {\r\n        linkItem({\r\n            _link: buildLink(null, parameters)\r\n        }, this);\r\n        return this\r\n    },\r\n    linkAfter: function(name) {\r\n        this._linkAfter = name;\r\n        return this\r\n    },\r\n    linkOn: function(target, parameters) {\r\n        this._link = buildLink(target, parameters);\r\n        linkItem(this, target);\r\n        return this\r\n    },\r\n    linkOff: function() {\r\n        unlinkItem(this);\r\n        this._link = null;\r\n        return this\r\n    },\r\n    linkAppend: function() {\r\n        var link = this._link;\r\n        var items = link.to._links;\r\n        var i;\r\n        var next;\r\n        for (i = link.i + 1;\r\n            (next = items[i]) && !next._link.is; ++i) {}\r\n        this._insert(link.to, next);\r\n        link.is = true;\r\n        return this\r\n    },\r\n    _insert: function(parent, next) {\r\n        parent.element.insertBefore(this.element, next ? next.element : null)\r\n    },\r\n    linkRemove: function() {\r\n        this.remove();\r\n        this._link.is = false;\r\n        return this\r\n    },\r\n    clear: function() {\r\n        this._clearChildrenFuncIri();\r\n        this._getJQElement().empty();\r\n        return this\r\n    },\r\n    toBackground: function() {\r\n        var elem = this.element;\r\n        var parent = elem.parentNode;\r\n        parent && parent.insertBefore(elem, parent.firstChild);\r\n        return this\r\n    },\r\n    toForeground: function() {\r\n        var elem = this.element;\r\n        var parent = elem.parentNode;\r\n        parent && parent.appendChild(elem);\r\n        return this\r\n    },\r\n    attr: function(attrs) {\r\n        return baseAttr(this, attrs)\r\n    },\r\n    smartAttr: function(attrs) {\r\n        return this.attr(processHatchingAttrs(this, attrs))\r\n    },\r\n    css: function(styles) {\r\n        return baseCss(this, styles)\r\n    },\r\n    animate: function(params, options, complete) {\r\n        return baseAnimate(this, params, options, complete)\r\n    },\r\n    sharp(pos, sharpDirection) {\r\n        return this.attr({\r\n            sharp: pos || true,\r\n            sharpDirection: sharpDirection\r\n        })\r\n    },\r\n    _applyTransformation() {\r\n        var tr = this._settings;\r\n        var rotateX;\r\n        var rotateY;\r\n        var transformations = [];\r\n        var sharpMode = tr.sharp;\r\n        var trDirection = tr.sharpDirection || 1;\r\n        var strokeOdd = tr[KEY_STROKE_WIDTH] % 2;\r\n        var correctionX = strokeOdd && (\"h\" === sharpMode || true === sharpMode) ? SHARPING_CORRECTION * trDirection : 0;\r\n        var correctionY = strokeOdd && (\"v\" === sharpMode || true === sharpMode) ? SHARPING_CORRECTION * trDirection : 0;\r\n        transformations.push(\"translate(\" + ((tr.translateX || 0) + correctionX) + \",\" + ((tr.translateY || 0) + correctionY) + \")\");\r\n        if (tr.rotate) {\r\n            if (\"rotateX\" in tr) {\r\n                rotateX = tr.rotateX\r\n            } else {\r\n                rotateX = tr.x\r\n            }\r\n            if (\"rotateY\" in tr) {\r\n                rotateY = tr.rotateY\r\n            } else {\r\n                rotateY = tr.y\r\n            }\r\n            transformations.push(\"rotate(\" + tr.rotate + \",\" + (rotateX || 0) + \",\" + (rotateY || 0) + \")\")\r\n        }\r\n        var scaleXDefined = isDefined(tr.scaleX);\r\n        var scaleYDefined = isDefined(tr.scaleY);\r\n        if (scaleXDefined || scaleYDefined) {\r\n            transformations.push(\"scale(\" + (scaleXDefined ? tr.scaleX : 1) + \",\" + (scaleYDefined ? tr.scaleY : 1) + \")\")\r\n        }\r\n        if (transformations.length) {\r\n            this.element.setAttribute(\"transform\", transformations.join(\" \"))\r\n        }\r\n    },\r\n    move: function(x, y, animate, animOptions) {\r\n        var obj = {};\r\n        isDefined(x) && (obj.translateX = x);\r\n        isDefined(y) && (obj.translateY = y);\r\n        if (!animate) {\r\n            this.attr(obj)\r\n        } else {\r\n            this.animate(obj, animOptions)\r\n        }\r\n        return this\r\n    },\r\n    rotate: function(angle, x, y, animate, animOptions) {\r\n        var obj = {\r\n            rotate: angle || 0\r\n        };\r\n        isDefined(x) && (obj.rotateX = x);\r\n        isDefined(y) && (obj.rotateY = y);\r\n        if (!animate) {\r\n            this.attr(obj)\r\n        } else {\r\n            this.animate(obj, animOptions)\r\n        }\r\n        return this\r\n    },\r\n    _getElementBBox: function() {\r\n        var elem = this.element;\r\n        var bBox;\r\n        try {\r\n            bBox = elem.getBBox && elem.getBBox()\r\n        } catch (e) {}\r\n        return bBox || {\r\n            x: 0,\r\n            y: 0,\r\n            width: elem.offsetWidth || 0,\r\n            height: elem.offsetHeight || 0\r\n        }\r\n    },\r\n    getBBox: function() {\r\n        var transformation = this._settings;\r\n        var bBox = this._getElementBBox();\r\n        if (transformation.rotate) {\r\n            bBox = rotateBBox(bBox, [(\"rotateX\" in transformation ? transformation.rotateX : transformation.x) || 0, (\"rotateY\" in transformation ? transformation.rotateY : transformation.y) || 0], -transformation.rotate)\r\n        } else {\r\n            bBox = normalizeBBox(bBox)\r\n        }\r\n        return bBox\r\n    },\r\n    markup: function() {\r\n        return getSvgMarkup(this.element)\r\n    },\r\n    getOffset: function() {\r\n        return this._getJQElement().offset()\r\n    },\r\n    stopAnimation: function(disableComplete) {\r\n        var animation = this.animation;\r\n        animation && animation.stop(disableComplete);\r\n        return this\r\n    },\r\n    setTitle: function(text) {\r\n        var titleElem = createElement(\"title\");\r\n        titleElem.textContent = text || \"\";\r\n        this.element.appendChild(titleElem)\r\n    },\r\n    removeTitle() {\r\n        detachTitleElements(this.element)\r\n    },\r\n    data: function(obj, val) {\r\n        var elem = this.element;\r\n        var key;\r\n        if (void 0 !== val) {\r\n            elem[obj] = val\r\n        } else {\r\n            for (key in obj) {\r\n                elem[key] = obj[key]\r\n            }\r\n        }\r\n        return this\r\n    },\r\n    on: function() {\r\n        var args = [this._getJQElement()];\r\n        args.push.apply(args, arguments);\r\n        eventsEngine.on.apply(eventsEngine, args);\r\n        return this\r\n    },\r\n    off: function() {\r\n        var args = [this._getJQElement()];\r\n        args.push.apply(args, arguments);\r\n        eventsEngine.off.apply(eventsEngine, args);\r\n        return this\r\n    },\r\n    trigger: function() {\r\n        var args = [this._getJQElement()];\r\n        args.push.apply(args, arguments);\r\n        eventsEngine.trigger.apply(eventsEngine, args);\r\n        return this\r\n    }\r\n};\r\nexport var PathSvgElement = function(renderer, type) {\r\n    SvgElement.call(this, renderer, \"path\", type)\r\n};\r\nPathSvgElement.prototype = objectCreate(SvgElement.prototype);\r\nextend(PathSvgElement.prototype, {\r\n    constructor: PathSvgElement,\r\n    attr: pathAttr,\r\n    animate: pathAnimate\r\n});\r\nexport var ArcSvgElement = function(renderer) {\r\n    SvgElement.call(this, renderer, \"path\", \"arc\")\r\n};\r\nArcSvgElement.prototype = objectCreate(SvgElement.prototype);\r\nextend(ArcSvgElement.prototype, {\r\n    constructor: ArcSvgElement,\r\n    attr: arcAttr,\r\n    animate: arcAnimate\r\n});\r\nexport var RectSvgElement = function(renderer) {\r\n    SvgElement.call(this, renderer, \"rect\")\r\n};\r\nRectSvgElement.prototype = objectCreate(SvgElement.prototype);\r\nextend(RectSvgElement.prototype, {\r\n    constructor: RectSvgElement,\r\n    attr: rectAttr\r\n});\r\nexport var TextSvgElement = function(renderer) {\r\n    SvgElement.call(this, renderer, \"text\");\r\n    this.css({\r\n        \"white-space\": \"pre\"\r\n    })\r\n};\r\nTextSvgElement.prototype = objectCreate(SvgElement.prototype);\r\nextend(TextSvgElement.prototype, {\r\n    constructor: TextSvgElement,\r\n    attr: textAttr,\r\n    css: textCss,\r\n    applyEllipsis: applyEllipsis,\r\n    setMaxSize: setMaxSize,\r\n    restoreText: restoreText,\r\n    _getLineHeight() {\r\n        return !isNaN(parseFloat(this._styles[KEY_FONT_SIZE])) ? this._styles[KEY_FONT_SIZE] : DEFAULT_FONT_SIZE\r\n    }\r\n});\r\n\r\nfunction updateIndexes(items, k) {\r\n    var i;\r\n    var item;\r\n    for (i = k; item = items[i]; ++i) {\r\n        item._link.i = i\r\n    }\r\n}\r\n\r\nfunction linkItem(target, container) {\r\n    var items = container._links;\r\n    var key = target._link.after = target._link.after || container._linkAfter;\r\n    var i;\r\n    var item;\r\n    if (key) {\r\n        for (i = 0;\r\n            (item = items[i]) && item._link.name !== key; ++i) {}\r\n        if (item) {\r\n            for (++i;\r\n                (item = items[i]) && item._link.after === key; ++i) {}\r\n        }\r\n    } else {\r\n        i = items.length\r\n    }\r\n    items.splice(i, 0, target);\r\n    updateIndexes(items, i)\r\n}\r\n\r\nfunction unlinkItem(target) {\r\n    var i;\r\n    var items = target._link.to._links;\r\n    for (i = 0; items[i] !== target; ++i) {}\r\n    items.splice(i, 1);\r\n    updateIndexes(items, i)\r\n}\r\nexport function Renderer(options) {\r\n    this.root = this._createElement(\"svg\", {\r\n        xmlns: \"http://www.w3.org/2000/svg\",\r\n        version: \"1.1\",\r\n        fill: NONE,\r\n        stroke: NONE,\r\n        \"stroke-width\": 0\r\n    }).attr({\r\n        class: options.cssClass\r\n    }).css({\r\n        \"line-height\": \"normal\",\r\n        \"-ms-user-select\": NONE,\r\n        \"-moz-user-select\": NONE,\r\n        \"-webkit-user-select\": NONE,\r\n        \"-webkit-tap-highlight-color\": \"rgba(0, 0, 0, 0)\",\r\n        display: \"block\",\r\n        overflow: \"hidden\"\r\n    });\r\n    this._init();\r\n    this.pathModified = !!options.pathModified;\r\n    this._$container = $(options.container);\r\n    this.root.append({\r\n        element: options.container\r\n    });\r\n    this._locker = 0;\r\n    this._backed = false\r\n}\r\nRenderer.prototype = {\r\n    constructor: Renderer,\r\n    _init: function() {\r\n        this._defs = this._createElement(\"defs\").append(this.root);\r\n        this._animationController = new AnimationController(this.root.element);\r\n        this._animation = {\r\n            enabled: true,\r\n            duration: 1e3,\r\n            easing: \"easeOutCubic\"\r\n        }\r\n    },\r\n    setOptions: function(options) {\r\n        this.rtl = !!options.rtl;\r\n        this.encodeHtml = !!options.encodeHtml;\r\n        this.updateAnimationOptions(options.animation || {});\r\n        this.root.attr({\r\n            direction: this.rtl ? \"rtl\" : \"ltr\"\r\n        });\r\n        return this\r\n    },\r\n    _createElement: function(tagName, attr, type) {\r\n        var elem = new SvgElement(this, tagName, type);\r\n        attr && elem.attr(attr);\r\n        return elem\r\n    },\r\n    lock: function() {\r\n        if (0 === this._locker) {\r\n            this._backed = !this._$container.is(\":visible\");\r\n            if (this._backed) {\r\n                backupRoot(this.root)\r\n            }\r\n        }++this._locker;\r\n        return this\r\n    },\r\n    unlock: function() {\r\n        --this._locker;\r\n        if (0 === this._locker) {\r\n            if (this._backed) {\r\n                restoreRoot(this.root, this._$container[0])\r\n            }\r\n            this._backed = false\r\n        }\r\n        return this\r\n    },\r\n    resize: function(width, height) {\r\n        if (width >= 0 && height >= 0) {\r\n            this.root.attr({\r\n                width: width,\r\n                height: height\r\n            })\r\n        }\r\n        return this\r\n    },\r\n    dispose: function() {\r\n        var key;\r\n        this.root.dispose();\r\n        this._defs.dispose();\r\n        this._animationController.dispose();\r\n        fixFuncIriCallbacks.removeByRenderer(this);\r\n        for (key in this) {\r\n            this[key] = null\r\n        }\r\n        return this\r\n    },\r\n    animationEnabled: function() {\r\n        return !!this._animation.enabled\r\n    },\r\n    updateAnimationOptions: function(newOptions) {\r\n        extend(this._animation, newOptions);\r\n        return this\r\n    },\r\n    stopAllAnimations: function(lock) {\r\n        this._animationController[lock ? \"lock\" : \"stop\"]();\r\n        return this\r\n    },\r\n    animateElement: function(element, params, options) {\r\n        this._animationController.animateElement(element, params, options);\r\n        return this\r\n    },\r\n    svg: function() {\r\n        return this.root.markup()\r\n    },\r\n    getRootOffset: function() {\r\n        return this.root.getOffset()\r\n    },\r\n    onEndAnimation: function(endAnimation) {\r\n        this._animationController.onEndAnimation(endAnimation)\r\n    },\r\n    rect: function(x, y, width, height) {\r\n        var elem = new RectSvgElement(this);\r\n        return elem.attr({\r\n            x: x || 0,\r\n            y: y || 0,\r\n            width: width || 0,\r\n            height: height || 0\r\n        })\r\n    },\r\n    simpleRect: function() {\r\n        return this._createElement(\"rect\")\r\n    },\r\n    circle: function(x, y, r) {\r\n        return this._createElement(\"circle\", {\r\n            cx: x || 0,\r\n            cy: y || 0,\r\n            r: r || 0\r\n        })\r\n    },\r\n    g: function() {\r\n        return this._createElement(\"g\")\r\n    },\r\n    image: function(x, y, w, h, href, location) {\r\n        var image = this._createElement(\"image\", {\r\n            x: x || 0,\r\n            y: y || 0,\r\n            width: w || 0,\r\n            height: h || 0,\r\n            preserveAspectRatio: preserveAspectRatioMap[normalizeEnum(location)] || NONE\r\n        });\r\n        image.element.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"href\", href || \"\");\r\n        return image\r\n    },\r\n    path: function(points, type) {\r\n        var elem = new PathSvgElement(this, type);\r\n        return elem.attr({\r\n            points: points || []\r\n        })\r\n    },\r\n    arc: function(x, y, innerRadius, outerRadius, startAngle, endAngle) {\r\n        var elem = new ArcSvgElement(this);\r\n        return elem.attr({\r\n            x: x || 0,\r\n            y: y || 0,\r\n            innerRadius: innerRadius || 0,\r\n            outerRadius: outerRadius || 0,\r\n            startAngle: startAngle || 0,\r\n            endAngle: endAngle || 0\r\n        })\r\n    },\r\n    text: function(_text, x, y) {\r\n        var elem = new TextSvgElement(this);\r\n        return elem.attr({\r\n            text: _text,\r\n            x: x || 0,\r\n            y: y || 0\r\n        })\r\n    },\r\n    linearGradient: function(stops) {\r\n        var id = getNextDefsSvgId();\r\n        var that = this;\r\n        var gradient = that._createElement(\"linearGradient\", {\r\n            id: id\r\n        }).append(that._defs);\r\n        gradient.id = id;\r\n        stops.forEach(stop => {\r\n            that._createElement(\"stop\", {\r\n                offset: stop.offset,\r\n                \"stop-color\": stop[\"stop-color\"]\r\n            }).append(gradient)\r\n        });\r\n        return gradient\r\n    },\r\n    pattern: function(color, hatching, _id) {\r\n        hatching = hatching || {};\r\n        var step = hatching.step || 6;\r\n        var stepTo2 = step / 2;\r\n        var stepBy15 = 1.5 * step;\r\n        var id = _id || getNextDefsSvgId();\r\n        var d = \"right\" === normalizeEnum(hatching.direction) ? \"M \" + stepTo2 + \" \" + -stepTo2 + \" L \" + -stepTo2 + \" \" + stepTo2 + \" M 0 \" + step + \" L \" + step + \" 0 M \" + stepBy15 + \" \" + stepTo2 + \" L \" + stepTo2 + \" \" + stepBy15 : \"M 0 0 L \" + step + \" \" + step + \" M \" + -stepTo2 + \" \" + stepTo2 + \" L \" + stepTo2 + \" \" + stepBy15 + \" M \" + stepTo2 + \" \" + -stepTo2 + \" L \" + stepBy15 + \" \" + stepTo2;\r\n        var pattern = this._createElement(\"pattern\", {\r\n            id: id,\r\n            width: step,\r\n            height: step,\r\n            patternUnits: \"userSpaceOnUse\"\r\n        }).append(this._defs);\r\n        pattern.id = id;\r\n        this.rect(0, 0, step, step).attr({\r\n            fill: color,\r\n            opacity: hatching.opacity\r\n        }).append(pattern);\r\n        new PathSvgElement(this).attr({\r\n            d: d,\r\n            \"stroke-width\": hatching.width || 1,\r\n            stroke: color\r\n        }).append(pattern);\r\n        return pattern\r\n    },\r\n    _getPointsWithYOffset: function(points, offset) {\r\n        return points.map((function(point, index) {\r\n            if (index % 2 !== 0) {\r\n                return point + offset\r\n            }\r\n            return point\r\n        }))\r\n    },\r\n    clipShape: function(method, methodArgs) {\r\n        var id = getNextDefsSvgId();\r\n        var clipPath = this._createElement(\"clipPath\", {\r\n            id: id\r\n        }).append(this._defs);\r\n        var shape = method.apply(this, methodArgs).append(clipPath);\r\n        shape.id = id;\r\n        shape.remove = function() {\r\n            throw \"Not implemented\"\r\n        };\r\n        shape.dispose = function() {\r\n            clipPath.dispose();\r\n            clipPath = null;\r\n            return this\r\n        };\r\n        return shape\r\n    },\r\n    clipRect(x, y, width, height) {\r\n        return this.clipShape(this.rect, arguments)\r\n    },\r\n    clipCircle(x, y, radius) {\r\n        return this.clipShape(this.circle, arguments)\r\n    },\r\n    shadowFilter: function(x, y, width, height, offsetX, offsetY, blur, color, opacity) {\r\n        var id = getNextDefsSvgId();\r\n        var filter = this._createElement(\"filter\", {\r\n            id: id,\r\n            x: x || 0,\r\n            y: y || 0,\r\n            width: width || 0,\r\n            height: height || 0\r\n        }).append(this._defs);\r\n        var gaussianBlur = this._createElement(\"feGaussianBlur\", {\r\n            in: \"SourceGraphic\",\r\n            result: \"gaussianBlurResult\",\r\n            stdDeviation: blur || 0\r\n        }).append(filter);\r\n        var offset = this._createElement(\"feOffset\", {\r\n            in: \"gaussianBlurResult\",\r\n            result: \"offsetResult\",\r\n            dx: offsetX || 0,\r\n            dy: offsetY || 0\r\n        }).append(filter);\r\n        var flood = this._createElement(\"feFlood\", {\r\n            result: \"floodResult\",\r\n            \"flood-color\": color || \"\",\r\n            \"flood-opacity\": opacity\r\n        }).append(filter);\r\n        var composite = this._createElement(\"feComposite\", {\r\n            in: \"floodResult\",\r\n            in2: \"offsetResult\",\r\n            operator: \"in\",\r\n            result: \"compositeResult\"\r\n        }).append(filter);\r\n        var finalComposite = this._createElement(\"feComposite\", {\r\n            in: \"SourceGraphic\",\r\n            in2: \"compositeResult\",\r\n            operator: \"over\"\r\n        }).append(filter);\r\n        filter.id = id;\r\n        filter.gaussianBlur = gaussianBlur;\r\n        filter.offset = offset;\r\n        filter.flood = flood;\r\n        filter.composite = composite;\r\n        filter.finalComposite = finalComposite;\r\n        filter.attr = function(attrs) {\r\n            var filterAttrs = {};\r\n            var offsetAttrs = {};\r\n            var floodAttrs = {};\r\n            \"x\" in attrs && (filterAttrs.x = attrs.x);\r\n            \"y\" in attrs && (filterAttrs.y = attrs.y);\r\n            \"width\" in attrs && (filterAttrs.width = attrs.width);\r\n            \"height\" in attrs && (filterAttrs.height = attrs.height);\r\n            baseAttr(this, filterAttrs);\r\n            \"blur\" in attrs && this.gaussianBlur.attr({\r\n                stdDeviation: attrs.blur\r\n            });\r\n            \"offsetX\" in attrs && (offsetAttrs.dx = attrs.offsetX);\r\n            \"offsetY\" in attrs && (offsetAttrs.dy = attrs.offsetY);\r\n            this.offset.attr(offsetAttrs);\r\n            \"color\" in attrs && (floodAttrs[\"flood-color\"] = attrs.color);\r\n            \"opacity\" in attrs && (floodAttrs[\"flood-opacity\"] = attrs.opacity);\r\n            this.flood.attr(floodAttrs);\r\n            return this\r\n        };\r\n        return filter\r\n    },\r\n    brightFilter: function(type, slope) {\r\n        var id = getNextDefsSvgId();\r\n        var filter = this._createElement(\"filter\", {\r\n            id: id\r\n        }).append(this._defs);\r\n        var componentTransferElement = this._createElement(\"feComponentTransfer\").append(filter);\r\n        var attrs = {\r\n            type: type,\r\n            slope: slope\r\n        };\r\n        filter.id = id;\r\n        this._createElement(\"feFuncR\", attrs).append(componentTransferElement);\r\n        this._createElement(\"feFuncG\", attrs).append(componentTransferElement);\r\n        this._createElement(\"feFuncB\", attrs).append(componentTransferElement);\r\n        return filter\r\n    },\r\n    getGrayScaleFilter: function() {\r\n        if (this._grayScaleFilter) {\r\n            return this._grayScaleFilter\r\n        }\r\n        var id = getNextDefsSvgId();\r\n        var filter = this._createElement(\"filter\", {\r\n            id: id\r\n        }).append(this._defs);\r\n        this._createElement(\"feColorMatrix\").attr({\r\n            type: \"matrix\",\r\n            values: \"0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 0.6 0\"\r\n        }).append(filter);\r\n        filter.id = id;\r\n        this._grayScaleFilter = filter;\r\n        return filter\r\n    },\r\n    initHatching: function() {\r\n        var storage = this._hatchingStorage = this._hatchingStorage || {\r\n            byHash: {},\r\n            baseId: getNextDefsSvgId()\r\n        };\r\n        var byHash = storage.byHash;\r\n        var name;\r\n        for (name in byHash) {\r\n            byHash[name].pattern.dispose()\r\n        }\r\n        storage.byHash = {};\r\n        storage.refToHash = {};\r\n        storage.nextId = 0\r\n    },\r\n    lockHatching: function(color, hatching, ref) {\r\n        var storage = this._hatchingStorage;\r\n        var hash = getHatchingHash(color, hatching);\r\n        var storageItem;\r\n        var pattern;\r\n        if (storage.refToHash[ref] !== hash) {\r\n            if (ref) {\r\n                this.releaseHatching(ref)\r\n            }\r\n            storageItem = storage.byHash[hash];\r\n            if (!storageItem) {\r\n                pattern = this.pattern(color, hatching, storage.baseId + \"-hatching-\" + storage.nextId++);\r\n                storageItem = storage.byHash[hash] = {\r\n                    pattern: pattern,\r\n                    count: 0\r\n                };\r\n                storage.refToHash[pattern.id] = hash\r\n            }++storageItem.count;\r\n            ref = storageItem.pattern.id\r\n        }\r\n        return ref\r\n    },\r\n    releaseHatching: function(ref) {\r\n        var storage = this._hatchingStorage;\r\n        var hash = storage.refToHash[ref];\r\n        var storageItem = storage.byHash[hash];\r\n        if (storageItem && 0 === --storageItem.count) {\r\n            storageItem.pattern.dispose();\r\n            delete storage.byHash[hash];\r\n            delete storage.refToHash[ref]\r\n        }\r\n    }\r\n};\r\n\r\nfunction getHatchingHash(color, hatching) {\r\n    return \"@\" + color + \"::\" + hatching.step + \":\" + hatching.width + \":\" + hatching.opacity + \":\" + hatching.direction\r\n}\r\nvar fixFuncIriCallbacks = function() {\r\n    var callbacks = [];\r\n    return {\r\n        add: function(fn) {\r\n            callbacks.push(fn)\r\n        },\r\n        remove: function(fn) {\r\n            callbacks = callbacks.filter((function(el) {\r\n                return el !== fn\r\n            }))\r\n        },\r\n        removeByRenderer: function(renderer) {\r\n            callbacks = callbacks.filter((function(el) {\r\n                return el.renderer !== renderer\r\n            }))\r\n        },\r\n        fire: function() {\r\n            callbacks.forEach((function(fn) {\r\n                fn()\r\n            }))\r\n        }\r\n    }\r\n}();\r\nexport var refreshPaths = function() {\r\n    fixFuncIriCallbacks.fire()\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}
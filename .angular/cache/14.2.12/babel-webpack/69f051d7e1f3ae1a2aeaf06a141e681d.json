{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/html_editor/utils/image_uploader_helper.js)\r\n * Version: 22.2.4\r\n * Build date: Thu Jan 19 2023\r\n *\r\n * Copyright (c) 2012 - 2023 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nvar _excluded = [\"imageSrc\", \"src\"];\nimport $ from \"../../../core/renderer\";\nimport localizationMessage from \"../../../localization/message\";\nimport { map } from \"../../../core/utils/iterator\";\nimport { extend } from \"../../../core/utils/extend\";\nimport { getHeight, getWidth } from \"../../../core/utils/size\";\nimport devices from \"../../../core/devices\";\nimport { isDefined } from \"../../../core/utils/type\";\nvar isMobile = \"phone\" === devices.current().deviceType;\nvar DIALOG_IMAGE_CAPTION = \"dxHtmlEditor-dialogImageCaption\";\nvar DIALOG_UPDATE_IMAGE_CAPTION = \"dxHtmlEditor-dialogUpdateImageCaption\";\nvar DIALOG_IMAGE_FIELD_URL = \"dxHtmlEditor-dialogImageUrlField\";\nvar DIALOG_IMAGE_FIELD_ALT = \"dxHtmlEditor-dialogImageAltField\";\nvar DIALOG_IMAGE_FIELD_WIDTH = \"dxHtmlEditor-dialogImageWidthField\";\nvar DIALOG_IMAGE_FIELD_HEIGHT = \"dxHtmlEditor-dialogImageHeightField\";\nvar DIALOG_IMAGE_ADD_BUTTON = \"dxHtmlEditor-dialogImageAddButton\";\nvar DIALOG_IMAGE_UPDATE_BUTTON = \"dxHtmlEditor-dialogImageUpdateButton\";\nvar DIALOG_IMAGE_SPECIFY_URL = \"dxHtmlEditor-dialogImageSpecifyUrl\";\nvar DIALOG_IMAGE_SELECT_FILE = \"dxHtmlEditor-dialogImageSelectFile\";\nvar DIALOG_IMAGE_KEEP_ASPECT_RATIO = \"dxHtmlEditor-dialogImageKeepAspectRatio\";\nvar DIALOG_IMAGE_ENCODE_TO_BASE64 = \"dxHtmlEditor-dialogImageEncodeToBase64\";\nvar DIALOG_IMAGE_POPUP_CLASS = \"dx-htmleditor-add-image-popup\";\nvar DIALOG_IMAGE_POPUP_WITH_TABS_CLASS = \"dx-htmleditor-add-image-popup-with-tabs\";\nvar DIALOG_IMAGE_FIX_RATIO_CONTAINER = \"dx-fix-ratio-container\";\nvar FORM_DIALOG_CLASS = \"dx-formdialog\";\nvar USER_ACTION = \"user\";\nvar SILENT_ACTION = \"silent\";\nvar FILE_UPLOADER_NAME = \"dx-htmleditor-image\";\nimport ButtonGroup from \"../../button_group\";\nimport FileUploader from \"../../file_uploader\";\nimport TextBox from \"../../text_box\";\nexport class ImageUploader {\n  constructor(module, config) {\n    this.module = module;\n    this.config = null !== config && void 0 !== config ? config : {};\n    this.quill = this.module.quill;\n    this.editorInstance = this.module.editorInstance;\n  }\n\n  render() {\n    if (this.editorInstance._formDialog) {\n      this.editorInstance._formDialog.beforeAddButtonAction = () => this.getCurrentTab().upload();\n    }\n\n    this.tabPanelIndex = 0;\n    this.formData = this.getFormData();\n    this.isUpdating = this.isImageUpdating();\n    this.tabsModel = this.createTabsModel(this.config.tabs);\n    this.tabs = this.createTabs(this.formData);\n    var formConfig = this.getFormConfig();\n    this.updatePopupConfig();\n    this.updateAddButtonState();\n    this.editorInstance.showFormDialog(formConfig).done((formData, event) => {\n      this.tabs[this.getActiveTabIndex()].strategy.pasteImage(formData, event);\n    }).always(() => {\n      this.resetDialogPopupOptions();\n      this.quill.focus();\n    });\n  }\n\n  getCurrentTab() {\n    return this.tabs[this.tabPanelIndex];\n  }\n\n  updateAddButtonState() {\n    var isDisabled = this.getCurrentTab().isDisableButton();\n    this.setAddButtonDisabled(isDisabled);\n  }\n\n  setAddButtonDisabled(value) {\n    this.editorInstance.formDialogOption({\n      \"toolbarItems[0].options.disabled\": value\n    });\n  }\n\n  getActiveTabIndex() {\n    return this.isUpdating ? 0 : this.tabPanelIndex;\n  }\n\n  getFormData() {\n    return this.getUpdateDialogFormData(this.quill.getFormat());\n  }\n\n  getUpdateDialogFormData(formData) {\n    var {\n      imageSrc: imageSrc,\n      src: src\n    } = formData,\n        props = _objectWithoutPropertiesLoose(formData, _excluded);\n\n    return _extends({\n      src: null !== imageSrc && void 0 !== imageSrc ? imageSrc : src\n    }, props);\n  }\n\n  createUrlTab(formData) {\n    return new UrlTab(this.module, {\n      config: this.config,\n      formData: formData,\n      isUpdating: this.isUpdating\n    }, () => this.updateAddButtonState());\n  }\n\n  createFileTab() {\n    return new FileTab(this.module, {\n      config: this.config\n    }, () => this.updateAddButtonState());\n  }\n\n  createTabsModel() {\n    var model = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : [];\n\n    if (0 === model.length || this.isUpdating) {\n      return [\"url\"];\n    }\n\n    return model.map(tab => \"object\" === typeof tab ? tab.name : tab);\n  }\n\n  createTabs(formData) {\n    return this.tabsModel.map(tabName => {\n      var isUrlTab = \"url\" === tabName;\n      return isUrlTab ? this.createUrlTab(formData) : this.createFileTab();\n    });\n  }\n\n  isImageUpdating() {\n    var _this$module$quill$ge;\n\n    return Object.prototype.hasOwnProperty.call(null !== (_this$module$quill$ge = this.module.quill.getFormat()) && void 0 !== _this$module$quill$ge ? _this$module$quill$ge : {}, \"imageSrc\");\n  }\n\n  updatePopupConfig() {\n    var wrapperClasses = \"\".concat(DIALOG_IMAGE_POPUP_CLASS, \" \").concat(FORM_DIALOG_CLASS);\n\n    if (this.useTabbedItems()) {\n      wrapperClasses += \" \".concat(DIALOG_IMAGE_POPUP_WITH_TABS_CLASS);\n    }\n\n    var titleKey = this.isUpdating ? DIALOG_UPDATE_IMAGE_CAPTION : DIALOG_IMAGE_CAPTION;\n    var addButtonTextKey = this.isUpdating ? DIALOG_IMAGE_UPDATE_BUTTON : DIALOG_IMAGE_ADD_BUTTON;\n    this.editorInstance.formDialogOption({\n      title: localizationMessage.format(titleKey),\n      \"toolbarItems[0].options.text\": localizationMessage.format(addButtonTextKey),\n      wrapperAttr: {\n        class: wrapperClasses\n      }\n    });\n  }\n\n  resetDialogPopupOptions() {\n    this.editorInstance.formDialogOption({\n      \"toolbarItems[0].options.text\": localizationMessage.format(\"OK\"),\n      \"toolbarItems[0].options.visible\": true,\n      \"toolbarItems[0].options.disabled\": false,\n      wrapperAttr: {\n        class: FORM_DIALOG_CLASS\n      }\n    });\n  }\n\n  useTabbedItems() {\n    return this.tabsModel.length > 1;\n  }\n\n  getFormWidth() {\n    return isMobile ? \"100%\" : 493;\n  }\n\n  getFormConfig() {\n    return {\n      formData: this.formData,\n      width: this.getFormWidth(),\n      labelLocation: \"top\",\n      colCount: this.useTabbedItems() ? 1 : 11,\n      items: this.getItemsConfig()\n    };\n  }\n\n  getItemsConfig() {\n    if (this.useTabbedItems()) {\n      var tabsConfig = map(this.tabs, tabController => ({\n        title: tabController.getTabName(),\n        colCount: 11,\n        items: tabController.getItemsConfig()\n      }));\n      return [{\n        itemType: \"tabbed\",\n        tabPanelOptions: {\n          onSelectionChanged: e => {\n            this.tabPanelIndex = e.component.option(\"selectedIndex\");\n            this.updateAddButtonState();\n          }\n        },\n        tabs: tabsConfig\n      }];\n    }\n\n    return this.tabs[0].getItemsConfig();\n  }\n\n}\n\nclass BaseTab {\n  constructor(module, _ref, onFileSelected) {\n    var {\n      config: config,\n      formData: formData,\n      isUpdating: isUpdating\n    } = _ref;\n    this.module = module;\n    this.config = config;\n    this.formData = formData;\n    this.isUpdating = isUpdating;\n    this.onFileSelected = onFileSelected;\n    this.strategy = this.createStrategy();\n  }\n\n  getItemsConfig() {\n    return this.strategy.getItemsConfig();\n  }\n\n  createStrategy() {\n    return this.isUpdating ? new UpdateUrlStrategy(this.module, this.config, this.formData) : new AddUrlStrategy(this.module, this.config, this.onFileSelected);\n  }\n\n  isDisableButton() {\n    return false;\n  }\n\n  upload() {\n    return this.strategy.upload();\n  }\n\n}\n\nclass UrlTab extends BaseTab {\n  getTabName() {\n    return localizationMessage.format(DIALOG_IMAGE_SPECIFY_URL);\n  }\n\n}\n\nclass FileTab extends BaseTab {\n  getTabName() {\n    return localizationMessage.format(DIALOG_IMAGE_SELECT_FILE);\n  }\n\n  createStrategy() {\n    return new FileStrategy(this.module, this.config, this.onFileSelected);\n  }\n\n  isDisableButton() {\n    return !this.strategy.isValid();\n  }\n\n}\n\nclass BaseStrategy {\n  constructor(module, config) {\n    this.module = module;\n    this.config = config;\n    this.editorInstance = module.editorInstance;\n    this.quill = module.quill;\n    this.selection = this.getQuillSelection();\n  }\n\n  getQuillSelection() {\n    var selection = this.quill.getSelection();\n    return null !== selection && void 0 !== selection ? selection : {\n      index: this.quill.getLength(),\n      length: 0\n    };\n  }\n\n  pasteImage() {}\n\n  isValid() {\n    return true;\n  }\n\n  upload() {}\n\n}\n\nclass AddUrlStrategy extends BaseStrategy {\n  constructor(module, config, onFileSelected) {\n    super(module, config, onFileSelected);\n    this.shouldKeepAspectRatio = true;\n  }\n\n  pasteImage(formData, event) {\n    this.module.saveValueChangeEvent(event);\n    urlUpload(this.quill, this.selection.index, formData);\n  }\n\n  keepAspectRatio(data, _ref2) {\n    var {\n      dependentEditor: dependentEditor,\n      e: e\n    } = _ref2;\n    var newValue = parseInt(e.value);\n    var previousValue = parseInt(e.previousValue);\n    var previousDependentEditorValue = parseInt(dependentEditor.option(\"value\"));\n    data.component.updateData(data.dataField, newValue);\n\n    if (this.shouldKeepAspectRatio && previousDependentEditorValue && previousValue && !this.preventRecalculating) {\n      this.preventRecalculating = true;\n      dependentEditor.option(\"value\", Math.round(newValue * previousDependentEditorValue / parseInt(previousValue)).toString());\n    }\n\n    this.preventRecalculating = false;\n  }\n\n  createKeepAspectRatioEditor($container, data, dependentEditorDataField) {\n    return this.editorInstance._createComponent($container, TextBox, extend(true, data.editorOptions, {\n      value: data.component.option(\"formData\")[data.dataField],\n      onEnterKey: data.component.option(\"onEditorEnterKey\").bind(this.editorInstance._formDialog, data),\n      onValueChanged: e => {\n        this.keepAspectRatio(data, {\n          dependentEditor: this[dependentEditorDataField + \"Editor\"],\n          e: e\n        });\n      }\n    }));\n  }\n\n  upload() {\n    var result = this.editorInstance._formDialog._form.validate();\n\n    return result.isValid;\n  }\n\n  getItemsConfig() {\n    return [{\n      dataField: \"src\",\n      colSpan: 11,\n      label: {\n        text: localizationMessage.format(DIALOG_IMAGE_FIELD_URL)\n      },\n      validationRules: [{\n        type: \"required\"\n      }, {\n        type: \"stringLength\",\n        min: 1\n      }]\n    }, {\n      dataField: \"width\",\n      colSpan: 6,\n      label: {\n        text: localizationMessage.format(DIALOG_IMAGE_FIELD_WIDTH)\n      },\n      template: data => {\n        var $content = $(\"<div>\").addClass(DIALOG_IMAGE_FIX_RATIO_CONTAINER);\n        var $widthEditor = $(\"<div>\").appendTo($content);\n        this.widthEditor = this.createKeepAspectRatioEditor($widthEditor, data, \"height\");\n        var $ratioEditor = $(\"<div>\").appendTo($content);\n\n        this.editorInstance._createComponent($ratioEditor, ButtonGroup, {\n          items: [{\n            icon: \"imgarlock\",\n            value: \"keepRatio\"\n          }],\n          hint: localizationMessage.format(DIALOG_IMAGE_KEEP_ASPECT_RATIO),\n          focusStateEnabled: false,\n          keyExpr: \"value\",\n          stylingMode: \"outlined\",\n          selectionMode: \"multiple\",\n          selectedItemKeys: [\"keepRatio\"],\n          onSelectionChanged: e => {\n            this.shouldKeepAspectRatio = !!e.component.option(\"selectedItems\").length;\n          }\n        });\n\n        return $content;\n      }\n    }, {\n      dataField: \"height\",\n      colSpan: 5,\n      label: {\n        text: localizationMessage.format(DIALOG_IMAGE_FIELD_HEIGHT)\n      },\n      template: data => {\n        var $content = $(\"<div>\");\n        this.heightEditor = this.createKeepAspectRatioEditor($content, data, \"width\");\n        return $content;\n      }\n    }, {\n      dataField: \"alt\",\n      colSpan: 11,\n      label: {\n        text: localizationMessage.format(DIALOG_IMAGE_FIELD_ALT)\n      }\n    }];\n  }\n\n}\n\nclass UpdateUrlStrategy extends AddUrlStrategy {\n  constructor(module, config, formData, onFileSelected) {\n    super(module, config, onFileSelected);\n    this.formData = formData;\n    this.modifyFormData();\n  }\n\n  modifyFormData() {\n    var {\n      imageSrc: imageSrc\n    } = this.quill.getFormat(this.selection.index - 1, 1);\n\n    if (!imageSrc || 0 === this.selection.index) {\n      this.selection = {\n        index: this.selection.index + 1,\n        length: 0\n      };\n      this.quill.setSelection(this.selection.index, this.selection.length, SILENT_ACTION);\n    }\n\n    var imgElement = this.quill.getLeaf(this.selection.index)[0].domNode;\n\n    if (imgElement) {\n      var _this$formData$width, _this$formData$height;\n\n      this.formData.width = null !== (_this$formData$width = this.formData.width) && void 0 !== _this$formData$width ? _this$formData$width : getWidth($(imgElement));\n      this.formData.height = null !== (_this$formData$height = this.formData.height) && void 0 !== _this$formData$height ? _this$formData$height : getHeight($(imgElement));\n    }\n  }\n\n  pasteImage(formData, event) {\n    this.quill.deleteText(this.embedFormatIndex(), 1, SILENT_ACTION);\n    this.selection.index -= 1;\n    super.pasteImage(formData, event);\n  }\n\n  embedFormatIndex() {\n    var _this$selection;\n\n    var selection = null !== (_this$selection = this.selection) && void 0 !== _this$selection ? _this$selection : this.quill.getSelection();\n\n    if (selection) {\n      if (selection.length) {\n        return selection.index;\n      } else {\n        return selection.index - 1;\n      }\n    } else {\n      return this.quill.getLength();\n    }\n  }\n\n}\n\nclass FileStrategy extends BaseStrategy {\n  constructor(module, config, onFileSelected) {\n    super(module, config, onFileSelected);\n    this.useBase64 = !isDefined(this.config.fileUploadMode) || \"base64\" === this.config.fileUploadMode;\n    this.isValidInternal = false;\n    this.onFileSelected = onFileSelected;\n    this.data = null;\n  }\n\n  upload() {\n    if (this.useBase64) {\n      this.base64Upload(this.data);\n    } else if (this.data.value.length) {\n      this.data.component.upload();\n    }\n\n    return true;\n  }\n\n  isValid() {\n    return this.isValidInternal;\n  }\n\n  closeDialogPopup(data) {\n    this.editorInstance._formDialog.hide({\n      file: data.value ? data.value[0] : data.file\n    }, data.event);\n  }\n\n  serverUpload(data) {\n    if (!this.useBase64) {\n      var imageUrl = correctSlashesInUrl(this.config.uploadDirectory) + data.file.name;\n      urlUpload(this.quill, this.selection.index, {\n        src: imageUrl\n      });\n      this.closeDialogPopup(data);\n    }\n  }\n\n  base64Upload(data) {\n    this.quill.getModule(\"uploader\").upload(this.selection, data.value, true);\n    this.closeDialogPopup(data);\n  }\n\n  pasteImage(formData, event) {\n    if (this.useBase64) {\n      super.pasteImage(formData, event);\n    }\n  }\n\n  isBase64Editable() {\n    return \"both\" === this.config.fileUploadMode;\n  }\n\n  validate(e) {\n    var fileUploader = e.component;\n    this.isValidInternal = !fileUploader._files.some(file => !file.isValid());\n\n    if (0 === fileUploader._files.length) {\n      this.isValidInternal = false;\n    }\n  }\n\n  getFileUploaderOptions() {\n    var fileUploaderOptions = {\n      uploadUrl: this.config.uploadUrl,\n      onValueChanged: data => {\n        this.validate(data);\n        this.data = data;\n        this.onFileSelected();\n      },\n      onUploaded: e => this.serverUpload(e)\n    };\n    return extend({}, getFileUploaderBaseOptions(), fileUploaderOptions, this.config.fileUploaderOptions);\n  }\n\n  getItemsConfig() {\n    return [{\n      itemType: \"simple\",\n      dataField: \"files\",\n      colSpan: 11,\n      label: {\n        visible: false\n      },\n      template: () => {\n        var $content = $(\"<div>\");\n\n        this.module.editorInstance._createComponent($content, FileUploader, this.getFileUploaderOptions());\n\n        return $content;\n      }\n    }, {\n      itemType: \"simple\",\n      colSpan: 11,\n      label: {\n        visible: false\n      },\n      editorType: \"dxCheckBox\",\n      editorOptions: {\n        value: this.useBase64,\n        visible: this.isBase64Editable(),\n        text: localizationMessage.format(DIALOG_IMAGE_ENCODE_TO_BASE64),\n        onValueChanged: e => {\n          if (this.isBase64Editable()) {\n            this.useBase64 = e.value;\n          }\n        }\n      }\n    }];\n  }\n\n}\n\nexport function correctSlashesInUrl(url) {\n  return \"/\" !== url[url.length - 1] ? url + \"/\" : url;\n}\nexport function getFileUploaderBaseOptions() {\n  return {\n    value: [],\n    name: FILE_UPLOADER_NAME,\n    accept: \"image/*\",\n    uploadMode: \"useButtons\"\n  };\n}\nexport function urlUpload(quill, index, attributes) {\n  quill.insertEmbed(index, \"extendedImage\", attributes, USER_ACTION);\n  quill.setSelection(index + 1, 0, USER_ACTION);\n}","map":{"version":3,"names":["_extends","_objectWithoutPropertiesLoose","_excluded","$","localizationMessage","map","extend","getHeight","getWidth","devices","isDefined","isMobile","current","deviceType","DIALOG_IMAGE_CAPTION","DIALOG_UPDATE_IMAGE_CAPTION","DIALOG_IMAGE_FIELD_URL","DIALOG_IMAGE_FIELD_ALT","DIALOG_IMAGE_FIELD_WIDTH","DIALOG_IMAGE_FIELD_HEIGHT","DIALOG_IMAGE_ADD_BUTTON","DIALOG_IMAGE_UPDATE_BUTTON","DIALOG_IMAGE_SPECIFY_URL","DIALOG_IMAGE_SELECT_FILE","DIALOG_IMAGE_KEEP_ASPECT_RATIO","DIALOG_IMAGE_ENCODE_TO_BASE64","DIALOG_IMAGE_POPUP_CLASS","DIALOG_IMAGE_POPUP_WITH_TABS_CLASS","DIALOG_IMAGE_FIX_RATIO_CONTAINER","FORM_DIALOG_CLASS","USER_ACTION","SILENT_ACTION","FILE_UPLOADER_NAME","ButtonGroup","FileUploader","TextBox","ImageUploader","constructor","module","config","quill","editorInstance","render","_formDialog","beforeAddButtonAction","getCurrentTab","upload","tabPanelIndex","formData","getFormData","isUpdating","isImageUpdating","tabsModel","createTabsModel","tabs","createTabs","formConfig","getFormConfig","updatePopupConfig","updateAddButtonState","showFormDialog","done","event","getActiveTabIndex","strategy","pasteImage","always","resetDialogPopupOptions","focus","isDisabled","isDisableButton","setAddButtonDisabled","value","formDialogOption","getUpdateDialogFormData","getFormat","imageSrc","src","props","createUrlTab","UrlTab","createFileTab","FileTab","model","arguments","length","tab","name","tabName","isUrlTab","_this$module$quill$ge","Object","prototype","hasOwnProperty","call","wrapperClasses","concat","useTabbedItems","titleKey","addButtonTextKey","title","format","wrapperAttr","class","getFormWidth","width","labelLocation","colCount","items","getItemsConfig","tabsConfig","tabController","getTabName","itemType","tabPanelOptions","onSelectionChanged","e","component","option","BaseTab","_ref","onFileSelected","createStrategy","UpdateUrlStrategy","AddUrlStrategy","FileStrategy","isValid","BaseStrategy","selection","getQuillSelection","getSelection","index","getLength","shouldKeepAspectRatio","saveValueChangeEvent","urlUpload","keepAspectRatio","data","_ref2","dependentEditor","newValue","parseInt","previousValue","previousDependentEditorValue","updateData","dataField","preventRecalculating","Math","round","toString","createKeepAspectRatioEditor","$container","dependentEditorDataField","_createComponent","editorOptions","onEnterKey","bind","onValueChanged","result","_form","validate","colSpan","label","text","validationRules","type","min","template","$content","addClass","$widthEditor","appendTo","widthEditor","$ratioEditor","icon","hint","focusStateEnabled","keyExpr","stylingMode","selectionMode","selectedItemKeys","heightEditor","modifyFormData","setSelection","imgElement","getLeaf","domNode","_this$formData$width","_this$formData$height","height","deleteText","embedFormatIndex","_this$selection","useBase64","fileUploadMode","isValidInternal","base64Upload","closeDialogPopup","hide","file","serverUpload","imageUrl","correctSlashesInUrl","uploadDirectory","getModule","isBase64Editable","fileUploader","_files","some","getFileUploaderOptions","fileUploaderOptions","uploadUrl","onUploaded","getFileUploaderBaseOptions","visible","editorType","url","accept","uploadMode","attributes","insertEmbed"],"sources":["D:/APPLICATION/UI/UPL/NEW/node_modules/devextreme/esm/ui/html_editor/utils/image_uploader_helper.js"],"sourcesContent":["/**\r\n * DevExtreme (esm/ui/html_editor/utils/image_uploader_helper.js)\r\n * Version: 22.2.4\r\n * Build date: Thu Jan 19 2023\r\n *\r\n * Copyright (c) 2012 - 2023 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\r\nimport _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\r\nvar _excluded = [\"imageSrc\", \"src\"];\r\nimport $ from \"../../../core/renderer\";\r\nimport localizationMessage from \"../../../localization/message\";\r\nimport {\r\n    map\r\n} from \"../../../core/utils/iterator\";\r\nimport {\r\n    extend\r\n} from \"../../../core/utils/extend\";\r\nimport {\r\n    getHeight,\r\n    getWidth\r\n} from \"../../../core/utils/size\";\r\nimport devices from \"../../../core/devices\";\r\nimport {\r\n    isDefined\r\n} from \"../../../core/utils/type\";\r\nvar isMobile = \"phone\" === devices.current().deviceType;\r\nvar DIALOG_IMAGE_CAPTION = \"dxHtmlEditor-dialogImageCaption\";\r\nvar DIALOG_UPDATE_IMAGE_CAPTION = \"dxHtmlEditor-dialogUpdateImageCaption\";\r\nvar DIALOG_IMAGE_FIELD_URL = \"dxHtmlEditor-dialogImageUrlField\";\r\nvar DIALOG_IMAGE_FIELD_ALT = \"dxHtmlEditor-dialogImageAltField\";\r\nvar DIALOG_IMAGE_FIELD_WIDTH = \"dxHtmlEditor-dialogImageWidthField\";\r\nvar DIALOG_IMAGE_FIELD_HEIGHT = \"dxHtmlEditor-dialogImageHeightField\";\r\nvar DIALOG_IMAGE_ADD_BUTTON = \"dxHtmlEditor-dialogImageAddButton\";\r\nvar DIALOG_IMAGE_UPDATE_BUTTON = \"dxHtmlEditor-dialogImageUpdateButton\";\r\nvar DIALOG_IMAGE_SPECIFY_URL = \"dxHtmlEditor-dialogImageSpecifyUrl\";\r\nvar DIALOG_IMAGE_SELECT_FILE = \"dxHtmlEditor-dialogImageSelectFile\";\r\nvar DIALOG_IMAGE_KEEP_ASPECT_RATIO = \"dxHtmlEditor-dialogImageKeepAspectRatio\";\r\nvar DIALOG_IMAGE_ENCODE_TO_BASE64 = \"dxHtmlEditor-dialogImageEncodeToBase64\";\r\nvar DIALOG_IMAGE_POPUP_CLASS = \"dx-htmleditor-add-image-popup\";\r\nvar DIALOG_IMAGE_POPUP_WITH_TABS_CLASS = \"dx-htmleditor-add-image-popup-with-tabs\";\r\nvar DIALOG_IMAGE_FIX_RATIO_CONTAINER = \"dx-fix-ratio-container\";\r\nvar FORM_DIALOG_CLASS = \"dx-formdialog\";\r\nvar USER_ACTION = \"user\";\r\nvar SILENT_ACTION = \"silent\";\r\nvar FILE_UPLOADER_NAME = \"dx-htmleditor-image\";\r\nimport ButtonGroup from \"../../button_group\";\r\nimport FileUploader from \"../../file_uploader\";\r\nimport TextBox from \"../../text_box\";\r\nexport class ImageUploader {\r\n    constructor(module, config) {\r\n        this.module = module;\r\n        this.config = null !== config && void 0 !== config ? config : {};\r\n        this.quill = this.module.quill;\r\n        this.editorInstance = this.module.editorInstance\r\n    }\r\n    render() {\r\n        if (this.editorInstance._formDialog) {\r\n            this.editorInstance._formDialog.beforeAddButtonAction = () => this.getCurrentTab().upload()\r\n        }\r\n        this.tabPanelIndex = 0;\r\n        this.formData = this.getFormData();\r\n        this.isUpdating = this.isImageUpdating();\r\n        this.tabsModel = this.createTabsModel(this.config.tabs);\r\n        this.tabs = this.createTabs(this.formData);\r\n        var formConfig = this.getFormConfig();\r\n        this.updatePopupConfig();\r\n        this.updateAddButtonState();\r\n        this.editorInstance.showFormDialog(formConfig).done((formData, event) => {\r\n            this.tabs[this.getActiveTabIndex()].strategy.pasteImage(formData, event)\r\n        }).always(() => {\r\n            this.resetDialogPopupOptions();\r\n            this.quill.focus()\r\n        })\r\n    }\r\n    getCurrentTab() {\r\n        return this.tabs[this.tabPanelIndex]\r\n    }\r\n    updateAddButtonState() {\r\n        var isDisabled = this.getCurrentTab().isDisableButton();\r\n        this.setAddButtonDisabled(isDisabled)\r\n    }\r\n    setAddButtonDisabled(value) {\r\n        this.editorInstance.formDialogOption({\r\n            \"toolbarItems[0].options.disabled\": value\r\n        })\r\n    }\r\n    getActiveTabIndex() {\r\n        return this.isUpdating ? 0 : this.tabPanelIndex\r\n    }\r\n    getFormData() {\r\n        return this.getUpdateDialogFormData(this.quill.getFormat())\r\n    }\r\n    getUpdateDialogFormData(formData) {\r\n        var {\r\n            imageSrc: imageSrc,\r\n            src: src\r\n        } = formData, props = _objectWithoutPropertiesLoose(formData, _excluded);\r\n        return _extends({\r\n            src: null !== imageSrc && void 0 !== imageSrc ? imageSrc : src\r\n        }, props)\r\n    }\r\n    createUrlTab(formData) {\r\n        return new UrlTab(this.module, {\r\n            config: this.config,\r\n            formData: formData,\r\n            isUpdating: this.isUpdating\r\n        }, () => this.updateAddButtonState())\r\n    }\r\n    createFileTab() {\r\n        return new FileTab(this.module, {\r\n            config: this.config\r\n        }, () => this.updateAddButtonState())\r\n    }\r\n    createTabsModel() {\r\n        var model = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : [];\r\n        if (0 === model.length || this.isUpdating) {\r\n            return [\"url\"]\r\n        }\r\n        return model.map(tab => \"object\" === typeof tab ? tab.name : tab)\r\n    }\r\n    createTabs(formData) {\r\n        return this.tabsModel.map(tabName => {\r\n            var isUrlTab = \"url\" === tabName;\r\n            return isUrlTab ? this.createUrlTab(formData) : this.createFileTab()\r\n        })\r\n    }\r\n    isImageUpdating() {\r\n        var _this$module$quill$ge;\r\n        return Object.prototype.hasOwnProperty.call(null !== (_this$module$quill$ge = this.module.quill.getFormat()) && void 0 !== _this$module$quill$ge ? _this$module$quill$ge : {}, \"imageSrc\")\r\n    }\r\n    updatePopupConfig() {\r\n        var wrapperClasses = \"\".concat(DIALOG_IMAGE_POPUP_CLASS, \" \").concat(FORM_DIALOG_CLASS);\r\n        if (this.useTabbedItems()) {\r\n            wrapperClasses += \" \".concat(DIALOG_IMAGE_POPUP_WITH_TABS_CLASS)\r\n        }\r\n        var titleKey = this.isUpdating ? DIALOG_UPDATE_IMAGE_CAPTION : DIALOG_IMAGE_CAPTION;\r\n        var addButtonTextKey = this.isUpdating ? DIALOG_IMAGE_UPDATE_BUTTON : DIALOG_IMAGE_ADD_BUTTON;\r\n        this.editorInstance.formDialogOption({\r\n            title: localizationMessage.format(titleKey),\r\n            \"toolbarItems[0].options.text\": localizationMessage.format(addButtonTextKey),\r\n            wrapperAttr: {\r\n                class: wrapperClasses\r\n            }\r\n        })\r\n    }\r\n    resetDialogPopupOptions() {\r\n        this.editorInstance.formDialogOption({\r\n            \"toolbarItems[0].options.text\": localizationMessage.format(\"OK\"),\r\n            \"toolbarItems[0].options.visible\": true,\r\n            \"toolbarItems[0].options.disabled\": false,\r\n            wrapperAttr: {\r\n                class: FORM_DIALOG_CLASS\r\n            }\r\n        })\r\n    }\r\n    useTabbedItems() {\r\n        return this.tabsModel.length > 1\r\n    }\r\n    getFormWidth() {\r\n        return isMobile ? \"100%\" : 493\r\n    }\r\n    getFormConfig() {\r\n        return {\r\n            formData: this.formData,\r\n            width: this.getFormWidth(),\r\n            labelLocation: \"top\",\r\n            colCount: this.useTabbedItems() ? 1 : 11,\r\n            items: this.getItemsConfig()\r\n        }\r\n    }\r\n    getItemsConfig() {\r\n        if (this.useTabbedItems()) {\r\n            var tabsConfig = map(this.tabs, tabController => ({\r\n                title: tabController.getTabName(),\r\n                colCount: 11,\r\n                items: tabController.getItemsConfig()\r\n            }));\r\n            return [{\r\n                itemType: \"tabbed\",\r\n                tabPanelOptions: {\r\n                    onSelectionChanged: e => {\r\n                        this.tabPanelIndex = e.component.option(\"selectedIndex\");\r\n                        this.updateAddButtonState()\r\n                    }\r\n                },\r\n                tabs: tabsConfig\r\n            }]\r\n        }\r\n        return this.tabs[0].getItemsConfig()\r\n    }\r\n}\r\nclass BaseTab {\r\n    constructor(module, _ref, onFileSelected) {\r\n        var {\r\n            config: config,\r\n            formData: formData,\r\n            isUpdating: isUpdating\r\n        } = _ref;\r\n        this.module = module;\r\n        this.config = config;\r\n        this.formData = formData;\r\n        this.isUpdating = isUpdating;\r\n        this.onFileSelected = onFileSelected;\r\n        this.strategy = this.createStrategy()\r\n    }\r\n    getItemsConfig() {\r\n        return this.strategy.getItemsConfig()\r\n    }\r\n    createStrategy() {\r\n        return this.isUpdating ? new UpdateUrlStrategy(this.module, this.config, this.formData) : new AddUrlStrategy(this.module, this.config, this.onFileSelected)\r\n    }\r\n    isDisableButton() {\r\n        return false\r\n    }\r\n    upload() {\r\n        return this.strategy.upload()\r\n    }\r\n}\r\nclass UrlTab extends BaseTab {\r\n    getTabName() {\r\n        return localizationMessage.format(DIALOG_IMAGE_SPECIFY_URL)\r\n    }\r\n}\r\nclass FileTab extends BaseTab {\r\n    getTabName() {\r\n        return localizationMessage.format(DIALOG_IMAGE_SELECT_FILE)\r\n    }\r\n    createStrategy() {\r\n        return new FileStrategy(this.module, this.config, this.onFileSelected)\r\n    }\r\n    isDisableButton() {\r\n        return !this.strategy.isValid()\r\n    }\r\n}\r\nclass BaseStrategy {\r\n    constructor(module, config) {\r\n        this.module = module;\r\n        this.config = config;\r\n        this.editorInstance = module.editorInstance;\r\n        this.quill = module.quill;\r\n        this.selection = this.getQuillSelection()\r\n    }\r\n    getQuillSelection() {\r\n        var selection = this.quill.getSelection();\r\n        return null !== selection && void 0 !== selection ? selection : {\r\n            index: this.quill.getLength(),\r\n            length: 0\r\n        }\r\n    }\r\n    pasteImage() {}\r\n    isValid() {\r\n        return true\r\n    }\r\n    upload() {}\r\n}\r\nclass AddUrlStrategy extends BaseStrategy {\r\n    constructor(module, config, onFileSelected) {\r\n        super(module, config, onFileSelected);\r\n        this.shouldKeepAspectRatio = true\r\n    }\r\n    pasteImage(formData, event) {\r\n        this.module.saveValueChangeEvent(event);\r\n        urlUpload(this.quill, this.selection.index, formData)\r\n    }\r\n    keepAspectRatio(data, _ref2) {\r\n        var {\r\n            dependentEditor: dependentEditor,\r\n            e: e\r\n        } = _ref2;\r\n        var newValue = parseInt(e.value);\r\n        var previousValue = parseInt(e.previousValue);\r\n        var previousDependentEditorValue = parseInt(dependentEditor.option(\"value\"));\r\n        data.component.updateData(data.dataField, newValue);\r\n        if (this.shouldKeepAspectRatio && previousDependentEditorValue && previousValue && !this.preventRecalculating) {\r\n            this.preventRecalculating = true;\r\n            dependentEditor.option(\"value\", Math.round(newValue * previousDependentEditorValue / parseInt(previousValue)).toString())\r\n        }\r\n        this.preventRecalculating = false\r\n    }\r\n    createKeepAspectRatioEditor($container, data, dependentEditorDataField) {\r\n        return this.editorInstance._createComponent($container, TextBox, extend(true, data.editorOptions, {\r\n            value: data.component.option(\"formData\")[data.dataField],\r\n            onEnterKey: data.component.option(\"onEditorEnterKey\").bind(this.editorInstance._formDialog, data),\r\n            onValueChanged: e => {\r\n                this.keepAspectRatio(data, {\r\n                    dependentEditor: this[dependentEditorDataField + \"Editor\"],\r\n                    e: e\r\n                })\r\n            }\r\n        }))\r\n    }\r\n    upload() {\r\n        var result = this.editorInstance._formDialog._form.validate();\r\n        return result.isValid\r\n    }\r\n    getItemsConfig() {\r\n        return [{\r\n            dataField: \"src\",\r\n            colSpan: 11,\r\n            label: {\r\n                text: localizationMessage.format(DIALOG_IMAGE_FIELD_URL)\r\n            },\r\n            validationRules: [{\r\n                type: \"required\"\r\n            }, {\r\n                type: \"stringLength\",\r\n                min: 1\r\n            }]\r\n        }, {\r\n            dataField: \"width\",\r\n            colSpan: 6,\r\n            label: {\r\n                text: localizationMessage.format(DIALOG_IMAGE_FIELD_WIDTH)\r\n            },\r\n            template: data => {\r\n                var $content = $(\"<div>\").addClass(DIALOG_IMAGE_FIX_RATIO_CONTAINER);\r\n                var $widthEditor = $(\"<div>\").appendTo($content);\r\n                this.widthEditor = this.createKeepAspectRatioEditor($widthEditor, data, \"height\");\r\n                var $ratioEditor = $(\"<div>\").appendTo($content);\r\n                this.editorInstance._createComponent($ratioEditor, ButtonGroup, {\r\n                    items: [{\r\n                        icon: \"imgarlock\",\r\n                        value: \"keepRatio\"\r\n                    }],\r\n                    hint: localizationMessage.format(DIALOG_IMAGE_KEEP_ASPECT_RATIO),\r\n                    focusStateEnabled: false,\r\n                    keyExpr: \"value\",\r\n                    stylingMode: \"outlined\",\r\n                    selectionMode: \"multiple\",\r\n                    selectedItemKeys: [\"keepRatio\"],\r\n                    onSelectionChanged: e => {\r\n                        this.shouldKeepAspectRatio = !!e.component.option(\"selectedItems\").length\r\n                    }\r\n                });\r\n                return $content\r\n            }\r\n        }, {\r\n            dataField: \"height\",\r\n            colSpan: 5,\r\n            label: {\r\n                text: localizationMessage.format(DIALOG_IMAGE_FIELD_HEIGHT)\r\n            },\r\n            template: data => {\r\n                var $content = $(\"<div>\");\r\n                this.heightEditor = this.createKeepAspectRatioEditor($content, data, \"width\");\r\n                return $content\r\n            }\r\n        }, {\r\n            dataField: \"alt\",\r\n            colSpan: 11,\r\n            label: {\r\n                text: localizationMessage.format(DIALOG_IMAGE_FIELD_ALT)\r\n            }\r\n        }]\r\n    }\r\n}\r\nclass UpdateUrlStrategy extends AddUrlStrategy {\r\n    constructor(module, config, formData, onFileSelected) {\r\n        super(module, config, onFileSelected);\r\n        this.formData = formData;\r\n        this.modifyFormData()\r\n    }\r\n    modifyFormData() {\r\n        var {\r\n            imageSrc: imageSrc\r\n        } = this.quill.getFormat(this.selection.index - 1, 1);\r\n        if (!imageSrc || 0 === this.selection.index) {\r\n            this.selection = {\r\n                index: this.selection.index + 1,\r\n                length: 0\r\n            };\r\n            this.quill.setSelection(this.selection.index, this.selection.length, SILENT_ACTION)\r\n        }\r\n        var imgElement = this.quill.getLeaf(this.selection.index)[0].domNode;\r\n        if (imgElement) {\r\n            var _this$formData$width, _this$formData$height;\r\n            this.formData.width = null !== (_this$formData$width = this.formData.width) && void 0 !== _this$formData$width ? _this$formData$width : getWidth($(imgElement));\r\n            this.formData.height = null !== (_this$formData$height = this.formData.height) && void 0 !== _this$formData$height ? _this$formData$height : getHeight($(imgElement))\r\n        }\r\n    }\r\n    pasteImage(formData, event) {\r\n        this.quill.deleteText(this.embedFormatIndex(), 1, SILENT_ACTION);\r\n        this.selection.index -= 1;\r\n        super.pasteImage(formData, event)\r\n    }\r\n    embedFormatIndex() {\r\n        var _this$selection;\r\n        var selection = null !== (_this$selection = this.selection) && void 0 !== _this$selection ? _this$selection : this.quill.getSelection();\r\n        if (selection) {\r\n            if (selection.length) {\r\n                return selection.index\r\n            } else {\r\n                return selection.index - 1\r\n            }\r\n        } else {\r\n            return this.quill.getLength()\r\n        }\r\n    }\r\n}\r\nclass FileStrategy extends BaseStrategy {\r\n    constructor(module, config, onFileSelected) {\r\n        super(module, config, onFileSelected);\r\n        this.useBase64 = !isDefined(this.config.fileUploadMode) || \"base64\" === this.config.fileUploadMode;\r\n        this.isValidInternal = false;\r\n        this.onFileSelected = onFileSelected;\r\n        this.data = null\r\n    }\r\n    upload() {\r\n        if (this.useBase64) {\r\n            this.base64Upload(this.data)\r\n        } else if (this.data.value.length) {\r\n            this.data.component.upload()\r\n        }\r\n        return true\r\n    }\r\n    isValid() {\r\n        return this.isValidInternal\r\n    }\r\n    closeDialogPopup(data) {\r\n        this.editorInstance._formDialog.hide({\r\n            file: data.value ? data.value[0] : data.file\r\n        }, data.event)\r\n    }\r\n    serverUpload(data) {\r\n        if (!this.useBase64) {\r\n            var imageUrl = correctSlashesInUrl(this.config.uploadDirectory) + data.file.name;\r\n            urlUpload(this.quill, this.selection.index, {\r\n                src: imageUrl\r\n            });\r\n            this.closeDialogPopup(data)\r\n        }\r\n    }\r\n    base64Upload(data) {\r\n        this.quill.getModule(\"uploader\").upload(this.selection, data.value, true);\r\n        this.closeDialogPopup(data)\r\n    }\r\n    pasteImage(formData, event) {\r\n        if (this.useBase64) {\r\n            super.pasteImage(formData, event)\r\n        }\r\n    }\r\n    isBase64Editable() {\r\n        return \"both\" === this.config.fileUploadMode\r\n    }\r\n    validate(e) {\r\n        var fileUploader = e.component;\r\n        this.isValidInternal = !fileUploader._files.some(file => !file.isValid());\r\n        if (0 === fileUploader._files.length) {\r\n            this.isValidInternal = false\r\n        }\r\n    }\r\n    getFileUploaderOptions() {\r\n        var fileUploaderOptions = {\r\n            uploadUrl: this.config.uploadUrl,\r\n            onValueChanged: data => {\r\n                this.validate(data);\r\n                this.data = data;\r\n                this.onFileSelected()\r\n            },\r\n            onUploaded: e => this.serverUpload(e)\r\n        };\r\n        return extend({}, getFileUploaderBaseOptions(), fileUploaderOptions, this.config.fileUploaderOptions)\r\n    }\r\n    getItemsConfig() {\r\n        return [{\r\n            itemType: \"simple\",\r\n            dataField: \"files\",\r\n            colSpan: 11,\r\n            label: {\r\n                visible: false\r\n            },\r\n            template: () => {\r\n                var $content = $(\"<div>\");\r\n                this.module.editorInstance._createComponent($content, FileUploader, this.getFileUploaderOptions());\r\n                return $content\r\n            }\r\n        }, {\r\n            itemType: \"simple\",\r\n            colSpan: 11,\r\n            label: {\r\n                visible: false\r\n            },\r\n            editorType: \"dxCheckBox\",\r\n            editorOptions: {\r\n                value: this.useBase64,\r\n                visible: this.isBase64Editable(),\r\n                text: localizationMessage.format(DIALOG_IMAGE_ENCODE_TO_BASE64),\r\n                onValueChanged: e => {\r\n                    if (this.isBase64Editable()) {\r\n                        this.useBase64 = e.value\r\n                    }\r\n                }\r\n            }\r\n        }]\r\n    }\r\n}\r\nexport function correctSlashesInUrl(url) {\r\n    return \"/\" !== url[url.length - 1] ? url + \"/\" : url\r\n}\r\nexport function getFileUploaderBaseOptions() {\r\n    return {\r\n        value: [],\r\n        name: FILE_UPLOADER_NAME,\r\n        accept: \"image/*\",\r\n        uploadMode: \"useButtons\"\r\n    }\r\n}\r\nexport function urlUpload(quill, index, attributes) {\r\n    quill.insertEmbed(index, \"extendedImage\", attributes, USER_ACTION);\r\n    quill.setSelection(index + 1, 0, USER_ACTION)\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}